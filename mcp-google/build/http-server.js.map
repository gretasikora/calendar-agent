{
  "version": 3,
  "sources": ["../src/handlers/core/BaseToolHandler.ts", "../src/schemas/validators.ts", "../src/handlers/utils.ts", "../src/handlers/core/BatchRequestHandler.ts", "../src/handlers/core/ListEventsHandler.ts", "../src/handlers/core/FreeBusyEventHandler.ts", "../src/http-server.ts", "../src/auth/client.ts", "../src/auth/utils.ts", "../src/auth/tokenManager.ts", "../src/handlers/core/ListCalendarsHandler.ts", "../src/handlers/callTool.ts", "../src/handlers/core/SearchEventsHandler.ts", "../src/handlers/core/ListColorsHandler.ts", "../src/handlers/core/CreateEventHandler.ts", "../src/handlers/core/UpdateEventHandler.ts", "../src/handlers/core/RecurringEventHelpers.ts", "../src/handlers/core/DeleteEventHandler.ts", "../src/handlers/core/contacts/ListContactsHandler.ts", "../src/handlers/core/contacts/GetContactHandler.ts", "../src/handlers/core/contacts/CreateContactHandler.ts", "../src/handlers/core/contacts/UpdateContactHandler.ts", "../src/handlers/core/contacts/DeleteContactHandler.ts", "../src/handlers/core/gmail/ListEmailsHandler.ts", "../src/handlers/core/gmail/GetEmailHandler.ts", "../src/handlers/core/gmail/SendEmailHandler.ts", "../src/handlers/core/gmail/UpdateEmailHandler.ts", "../src/handlers/core/gmail/utils/labelMutationBuilder.ts", "../src/handlers/core/gmail/DeleteEmailHandler.ts", "../src/handlers/core/gmail/CreateDraftHandler.ts", "../src/handlers/core/gmail/UpdateDraftHandler.ts", "../src/handlers/core/gmail/SendDraftHandler.ts", "../src/handlers/core/gmail/ListLabelsHandler.ts", "../src/handlers/core/gmail/CreateLabelHandler.ts", "../src/handlers/core/gmail/UpdateLabelHandler.ts", "../src/handlers/core/gmail/DeleteLabelHandler.ts", "../src/handlers/core/gmail/BatchUpdateEmailsHandler.ts", "../src/handlers/core/gmail/utils/rateLimiter.ts"],
  "sourcesContent": ["import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { GaxiosError } from 'gaxios';\r\nimport { calendar_v3, google } from \"googleapis\";\r\n\r\n\r\nexport abstract class BaseToolHandler {\r\n    abstract runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult>;\r\n\r\n    protected handleGoogleApiError(error: unknown): void {\r\n        if (\r\n            error instanceof GaxiosError &&\r\n            error.response?.data?.error === 'invalid_grant'\r\n        ) {\r\n            throw new Error(\r\n                'Google API Error: Authentication token is invalid or expired. Please re-run the authentication process (e.g., `npm run auth`).'\r\n            );\r\n        }\r\n        throw error;\r\n    }\r\n\r\n    protected getCalendar(auth: OAuth2Client): calendar_v3.Calendar {\r\n        return google.calendar({ version: 'v3', auth });\r\n    }\r\n}\r\n", "import { z } from 'zod';\r\n\r\n// Zod schemas for input validation\r\n\r\nexport const ReminderSchema = z.object({\r\n  method: z.enum(['email', 'popup']).default('popup'),\r\n  minutes: z.number(),\r\n});\r\n\r\nexport const RemindersSchema = z.object({\r\n  useDefault: z.boolean(),\r\n  overrides: z.array(ReminderSchema).optional(),\r\n});\r\n\r\n// ISO datetime regex that requires timezone designator (Z or +/-HH:MM)\r\n// Supports optional milliseconds (e.g., .123) for compatibility with Date.toISOString()\r\nconst isoDateTimeWithTimezone = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z|[+-]\\d{2}:\\d{2})$/;\r\n\r\nexport const ListEventsArgumentsSchema = z.object({\r\n  calendarId: z.preprocess(\r\n    (val) => {\r\n      // If it's a string that looks like JSON array, try to parse it\r\n      if (typeof val === 'string' && val.startsWith('[') && val.endsWith(']')) {\r\n        try {\r\n          return JSON.parse(val);\r\n        } catch {\r\n          // If parsing fails, return as-is (will be validated as string)\r\n          return val;\r\n        }\r\n      }\r\n      return val;\r\n    },\r\n    z.union([\r\n      z.string().min(1, \"Calendar ID cannot be empty\"),\r\n      z.array(z.string().min(1, \"Calendar ID cannot be empty\"))\r\n        .min(1, \"At least one calendar ID is required\")\r\n        .max(50, \"Maximum 50 calendars allowed per request\")\r\n        .refine(\r\n          (ids) => new Set(ids).size === ids.length,\r\n          \"Duplicate calendar IDs are not allowed\"\r\n        )\r\n    ])\r\n  ).describe(\"Calendar ID(s) to fetch events from\"),\r\n  timeMin: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional()\r\n    .describe(\"Start time for event filtering\"),\r\n  timeMax: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional()\r\n    .describe(\"End time for event filtering\"),\r\n}).refine(\r\n  (data) => {\r\n    if (data.timeMin && data.timeMax) {\r\n      return new Date(data.timeMin) < new Date(data.timeMax);\r\n    }\r\n    return true;\r\n  },\r\n  {\r\n    message: \"timeMin must be before timeMax\",\r\n    path: [\"timeMax\"]\r\n  }\r\n);\r\n\r\nexport const SearchEventsArgumentsSchema = z.object({\r\n  calendarId: z.string(),\r\n  query: z.string(),\r\n  timeMin: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional(),\r\n  timeMax: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-12-31T23:59:59Z)\")\r\n    .optional(),\r\n});\r\n\r\nexport const CreateEventArgumentsSchema = z.object({\r\n  calendarId: z.string(),\r\n  summary: z.string(),\r\n  description: z.string().optional(),\r\n  start: z.string().regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\"),\r\n  end: z.string().regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\"),\r\n  timeZone: z.string(),\r\n  attendees: z\r\n    .array(\r\n      z.object({\r\n        email: z.string(),\r\n      })\r\n    )\r\n    .optional(),\r\n  location: z.string().optional(),\r\n  colorId: z.string().optional(),\r\n  reminders: RemindersSchema.optional(),\r\n  recurrence: z.array(z.string()).optional(),\r\n  conferenceData: z.object({\r\n    createRequest: z.object({\r\n      requestId: z.string().optional(),\r\n      conferenceSolutionKey: z.object({\r\n        type: z.string(),\r\n      }).optional(),\r\n    }).optional(),\r\n  }).optional(),\r\n  sendUpdates: z.enum(['all', 'externalOnly', 'none']).optional(),\r\n});\r\n\r\nexport const UpdateEventArgumentsSchema = z.object({\r\n  calendarId: z.string(),\r\n  eventId: z.string(),\r\n  summary: z.string().optional(),\r\n  description: z.string().optional(),\r\n  start: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional(),\r\n  end: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional(),\r\n  timeZone: z.string(), // Required even if start/end don't change, per API docs for patch\r\n  attendees: z\r\n    .array(\r\n      z.object({\r\n        email: z.string(),\r\n      })\r\n    )\r\n    .optional(),\r\n  location: z.string().optional(),\r\n  colorId: z.string().optional(),\r\n  reminders: RemindersSchema.optional(),\r\n  recurrence: z.array(z.string()).optional(),\r\n  // New recurring event parameters\r\n  modificationScope: z.enum(['single', 'all', 'future']).default('all'),\r\n  originalStartTime: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional(),\r\n  futureStartDate: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\")\r\n    .optional(),\r\n}).refine(\r\n  (data) => {\r\n    // Require originalStartTime when modificationScope is 'single'\r\n    if (data.modificationScope === 'single' && !data.originalStartTime) {\r\n      return false;\r\n    }\r\n    return true;\r\n  },\r\n  {\r\n    message: \"originalStartTime is required when modificationScope is 'single'\",\r\n    path: [\"originalStartTime\"]\r\n  }\r\n).refine(\r\n  (data) => {\r\n    // Require futureStartDate when modificationScope is 'future'\r\n    if (data.modificationScope === 'future' && !data.futureStartDate) {\r\n      return false;\r\n    }\r\n    return true;\r\n  },\r\n  {\r\n    message: \"futureStartDate is required when modificationScope is 'future'\",\r\n    path: [\"futureStartDate\"]\r\n  }\r\n).refine(\r\n  (data) => {\r\n    // Ensure futureStartDate is in the future when provided\r\n    if (data.futureStartDate) {\r\n      const futureDate = new Date(data.futureStartDate);\r\n      const now = new Date();\r\n      return futureDate > now;\r\n    }\r\n    return true;\r\n  },\r\n  {\r\n    message: \"futureStartDate must be in the future\",\r\n    path: [\"futureStartDate\"]\r\n  }\r\n);\r\n\r\nexport const DeleteEventArgumentsSchema = z.object({\r\n  calendarId: z.string(),\r\n  eventId: z.string(),\r\n});\r\n\r\nexport const FreeBusyEventArgumentsSchema = z.object({\r\n  timeMin: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\"),\r\n  timeMax: z.string()\r\n    .regex(isoDateTimeWithTimezone, \"Must be ISO format with timezone (e.g., 2024-01-01T00:00:00Z)\"),\r\n  timeZone: z.string().optional(),\r\n  groupExpansionMax: z.number().int().max(100).optional(),\r\n  calendarExpansionMax: z.number().int().max(50).optional(),\r\n  items: z.array(z.object({\r\n    id: z.string().email(\"Must be a valid email address\"),\r\n  })),\r\n});", "import { calendar_v3 } from \"googleapis\";\r\n\r\n/**\r\n * Formats a list of events into a user-friendly string.\r\n */\r\nexport function formatEventList(events: calendar_v3.Schema$Event[]): string {\r\n    return events\r\n        .map((event) => {\r\n            const attendeeList = event.attendees\r\n                ? `\\nAttendees: ${event.attendees\r\n                    .map((a) => `${a.email || \"no-email\"} (${a.responseStatus || \"unknown\"})`)\r\n                    .join(\", \")}`\r\n                : \"\";\r\n            const locationInfo = event.location ? `\\nLocation: ${event.location}` : \"\";\r\n            const descriptionInfo = event.description ? `\\nDescription: ${event.description}` : \"\";\r\n            const colorInfo = event.colorId ? `\\nColor ID: ${event.colorId}` : \"\";\r\n            const reminderInfo = event.reminders\r\n                ? `\\nReminders: ${event.reminders.useDefault ? 'Using default' :\r\n                    (event.reminders.overrides || []).map((r: any) => `${r.method} ${r.minutes} minutes before`).join(', ') || 'None'}`\r\n                : \"\";\r\n            return `${event.summary || \"Untitled\"} (${event.id || \"no-id\"})${locationInfo}${descriptionInfo}\\nStart: ${event.start?.dateTime || event.start?.date || \"unspecified\"}\\nEnd: ${event.end?.dateTime || event.end?.date || \"unspecified\"}${attendeeList}${colorInfo}${reminderInfo}\\n`;\r\n        })\r\n        .join(\"\\n\");\r\n}\r\n", "import { OAuth2Client } from \"google-auth-library\";\r\n\r\nexport interface BatchRequest {\r\n  method: string;\r\n  path: string;\r\n  headers?: Record<string, string>;\r\n  body?: any;\r\n}\r\n\r\nexport interface BatchResponse {\r\n  statusCode: number;\r\n  headers: Record<string, string>;\r\n  body: any;\r\n  error?: any;\r\n}\r\n\r\nexport interface BatchError {\r\n  calendarId?: string;\r\n  statusCode: number;\r\n  message: string;\r\n  details?: any;\r\n}\r\n\r\nexport class BatchRequestError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public errors: BatchError[],\r\n    public partial: boolean = false\r\n  ) {\r\n    super(message);\r\n    this.name = 'BatchRequestError';\r\n  }\r\n}\r\n\r\nexport class BatchRequestHandler {\r\n  private readonly batchEndpoint = \"https://www.googleapis.com/batch/calendar/v3\";\r\n  private readonly boundary: string;\r\n  private readonly maxRetries = 3;\r\n  private readonly baseDelay = 1000; // 1 second\r\n\r\n  constructor(private auth: OAuth2Client) {\r\n    this.boundary = \"batch_boundary_\" + Date.now();\r\n  }\r\n\r\n  async executeBatch(requests: BatchRequest[]): Promise<BatchResponse[]> {\r\n    if (requests.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    if (requests.length > 50) {\r\n      throw new Error('Batch requests cannot exceed 50 requests per batch');\r\n    }\r\n\r\n    return this.executeBatchWithRetry(requests, 0);\r\n  }\r\n\r\n  private async executeBatchWithRetry(requests: BatchRequest[], attempt: number): Promise<BatchResponse[]> {\r\n    try {\r\n      const batchBody = this.createBatchBody(requests);\r\n      const token = await this.auth.getAccessToken();\r\n      \r\n      const response = await fetch(this.batchEndpoint, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Authorization\": `Bearer ${token.token}`,\r\n          \"Content-Type\": `multipart/mixed; boundary=${this.boundary}`\r\n        },\r\n        body: batchBody\r\n      });\r\n\r\n      const responseText = await response.text();\r\n\r\n      // Handle rate limiting with retry\r\n      if (response.status === 429 && attempt < this.maxRetries) {\r\n        const retryAfter = response.headers.get('Retry-After');\r\n        const delay = retryAfter ? parseInt(retryAfter) * 1000 : this.baseDelay * Math.pow(2, attempt);\r\n        \r\n        console.warn(`Rate limited, retrying after ${delay}ms (attempt ${attempt + 1}/${this.maxRetries})`);\r\n        await this.sleep(delay);\r\n        return this.executeBatchWithRetry(requests, attempt + 1);\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new BatchRequestError(\r\n          `Batch request failed: ${response.status} ${response.statusText}`,\r\n          [{\r\n            statusCode: response.status,\r\n            message: `HTTP ${response.status}: ${response.statusText}`,\r\n            details: responseText\r\n          }]\r\n        );\r\n      }\r\n\r\n      return this.parseBatchResponse(responseText);\r\n    } catch (error) {\r\n      if (error instanceof BatchRequestError) {\r\n        throw error;\r\n      }\r\n      \r\n      // Retry on network errors\r\n      if (attempt < this.maxRetries && this.isRetryableError(error)) {\r\n        const delay = this.baseDelay * Math.pow(2, attempt);\r\n        console.warn(`Network error, retrying after ${delay}ms (attempt ${attempt + 1}/${this.maxRetries}): ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n        await this.sleep(delay);\r\n        return this.executeBatchWithRetry(requests, attempt + 1);\r\n      }\r\n      \r\n      // Handle network or auth errors\r\n      throw new BatchRequestError(\r\n        `Failed to execute batch request: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n        [{\r\n          statusCode: 0,\r\n          message: error instanceof Error ? error.message : 'Unknown error',\r\n          details: error\r\n        }]\r\n      );\r\n    }\r\n  }\r\n\r\n  private isRetryableError(error: any): boolean {\r\n    if (error instanceof Error) {\r\n      const message = error.message.toLowerCase();\r\n      return message.includes('network') || \r\n             message.includes('timeout') || \r\n             message.includes('econnreset') ||\r\n             message.includes('enotfound');\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  private createBatchBody(requests: BatchRequest[]): string {\r\n    return requests.map((req, index) => {\r\n      const parts = [\r\n        `--${this.boundary}`,\r\n        `Content-Type: application/http`,\r\n        `Content-ID: <item${index + 1}>`,\r\n        \"\",\r\n        `${req.method} ${req.path} HTTP/1.1`\r\n      ];\r\n\r\n      if (req.headers) {\r\n        Object.entries(req.headers).forEach(([key, value]) => {\r\n          parts.push(`${key}: ${value}`);\r\n        });\r\n      }\r\n\r\n      if (req.body) {\r\n        parts.push(\"Content-Type: application/json\");\r\n        parts.push(\"\");\r\n        parts.push(JSON.stringify(req.body));\r\n      }\r\n\r\n      return parts.join(\"\\r\\n\");\r\n    }).join(\"\\r\\n\\r\\n\") + `\\r\\n--${this.boundary}--`;\r\n  }\r\n\r\n  private parseBatchResponse(responseText: string): BatchResponse[] {\r\n    // First, try to find boundary from Content-Type header in the response\r\n    // Google's responses typically have boundary in the first few lines\r\n    const lines = responseText.split(/\\r?\\n/);\r\n    let boundary = null;\r\n    \r\n    // Look for Content-Type header with boundary in the first few lines\r\n    for (let i = 0; i < Math.min(10, lines.length); i++) {\r\n      const line = lines[i];\r\n      if (line.toLowerCase().includes('content-type:') && line.includes('boundary=')) {\r\n        const boundaryMatch = line.match(/boundary=([^\\s\\r\\n;]+)/);\r\n        if (boundaryMatch) {\r\n          boundary = boundaryMatch[1];\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If not found in headers, try to find boundary markers in the content\r\n    if (!boundary) {\r\n      const boundaryMatch = responseText.match(/--([a-zA-Z0-9_-]+)/);\r\n      if (boundaryMatch) {\r\n        boundary = boundaryMatch[1];\r\n      }\r\n    }\r\n    \r\n    if (!boundary) {\r\n      throw new Error('Could not find boundary in batch response');\r\n    }\r\n    \r\n    // Split by boundary markers\r\n    const parts = responseText.split(`--${boundary}`);\r\n    \r\n    const responses: BatchResponse[] = [];\r\n    \r\n    // Skip the first part (before the first boundary) and the last part (after final boundary with --)\r\n    for (let i = 1; i < parts.length; i++) {\r\n      const part = parts[i];\r\n      \r\n      // Skip empty parts or the final boundary marker\r\n      if (part.trim() === '' || part.trim() === '--' || part.trim().startsWith('--')) continue;\r\n      \r\n      const response = this.parseResponsePart(part);\r\n      if (response) {\r\n        responses.push(response);\r\n      }\r\n    }\r\n    \r\n    return responses;\r\n  }\r\n\r\n  private parseResponsePart(part: string): BatchResponse | null {\r\n    // Handle both \\r\\n and \\n line endings\r\n    const lines = part.split(/\\r?\\n/);\r\n    \r\n    // Find the HTTP response line (look for \"HTTP/1.1\")\r\n    let httpLineIndex = -1;\r\n    for (let i = 0; i < lines.length; i++) {\r\n      if (lines[i].startsWith('HTTP/1.1')) {\r\n        httpLineIndex = i;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (httpLineIndex === -1) return null;\r\n\r\n    // Parse status code from HTTP response line\r\n    const httpLine = lines[httpLineIndex];\r\n    const statusMatch = httpLine.match(/HTTP\\/1\\.1 (\\d+)/);\r\n    if (!statusMatch) return null;\r\n    \r\n    const statusCode = parseInt(statusMatch[1]);\r\n\r\n    // Parse response headers (start after HTTP line, stop at empty line)\r\n    const headers: Record<string, string> = {};\r\n    let bodyStartIndex = httpLineIndex + 1;\r\n    \r\n    for (let i = httpLineIndex + 1; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      if (line.trim() === '') {\r\n        bodyStartIndex = i + 1;\r\n        break;\r\n      }\r\n      \r\n      const colonIndex = line.indexOf(':');\r\n      if (colonIndex > 0) {\r\n        const key = line.substring(0, colonIndex).trim();\r\n        const value = line.substring(colonIndex + 1).trim();\r\n        headers[key] = value;\r\n      }\r\n    }\r\n\r\n    // Parse body - everything after the empty line following headers\r\n    let body: any = null;\r\n    if (bodyStartIndex < lines.length) {\r\n      // Collect all body lines, filtering out empty lines at the end\r\n      const bodyLines = [];\r\n      for (let i = bodyStartIndex; i < lines.length; i++) {\r\n        bodyLines.push(lines[i]);\r\n      }\r\n      \r\n      // Remove trailing empty lines\r\n      while (bodyLines.length > 0 && bodyLines[bodyLines.length - 1].trim() === '') {\r\n        bodyLines.pop();\r\n      }\r\n      \r\n      if (bodyLines.length > 0) {\r\n        const bodyText = bodyLines.join('\\n');\r\n        if (bodyText.trim()) {\r\n          try {\r\n            body = JSON.parse(bodyText);\r\n          } catch {\r\n            // If JSON parsing fails, return the raw text\r\n            body = bodyText;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      statusCode,\r\n      headers,\r\n      body\r\n    };\r\n  }\r\n} ", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { ListEventsArgumentsSchema } from \"../../schemas/validators.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { google, calendar_v3 } from 'googleapis';\r\nimport { z } from 'zod';\r\nimport { formatEventList } from \"../utils.js\";\r\nimport { BatchRequestHandler } from \"./BatchRequestHandler.js\";\r\n\r\n// Extended event type to include calendar ID for tracking source\r\ninterface ExtendedEvent extends calendar_v3.Schema$Event {\r\n  calendarId: string;\r\n}\r\n\r\ntype ListEventsArgs = z.infer<typeof ListEventsArgumentsSchema>;\r\n\r\nexport class ListEventsHandler extends BaseToolHandler {\r\n    async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const validArgs = ListEventsArgumentsSchema.parse(args);\r\n        \r\n        // Normalize calendarId to always be an array for consistent processing\r\n        const calendarIds = Array.isArray(validArgs.calendarId) \r\n            ? validArgs.calendarId \r\n            : [validArgs.calendarId];\r\n        \r\n        const allEvents = await this.fetchEvents(oauth2Client, calendarIds, {\r\n            timeMin: validArgs.timeMin,\r\n            timeMax: validArgs.timeMax\r\n        });\r\n        \r\n        return {\r\n            content: [{\r\n                type: \"text\",\r\n                text: this.formatEventList(allEvents, calendarIds),\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async fetchEvents(\r\n        client: OAuth2Client,\r\n        calendarIds: string[],\r\n        options: { timeMin?: string; timeMax?: string }\r\n    ): Promise<ExtendedEvent[]> {\r\n        if (calendarIds.length === 1) {\r\n            return this.fetchSingleCalendarEvents(client, calendarIds[0], options);\r\n        }\r\n        \r\n        return this.fetchMultipleCalendarEvents(client, calendarIds, options);\r\n    }\r\n\r\n    private async fetchSingleCalendarEvents(\r\n        client: OAuth2Client,\r\n        calendarId: string,\r\n        options: { timeMin?: string; timeMax?: string }\r\n    ): Promise<ExtendedEvent[]> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            const response = await calendar.events.list({\r\n                calendarId,\r\n                timeMin: options.timeMin,\r\n                timeMax: options.timeMax,\r\n                singleEvents: true,\r\n                orderBy: 'startTime'\r\n            });\r\n            \r\n            // Add calendarId to events for consistent interface\r\n            return (response.data.items || []).map(event => ({\r\n                ...event,\r\n                calendarId\r\n            }));\r\n        } catch (error) {\r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n\r\n    private async fetchMultipleCalendarEvents(\r\n        client: OAuth2Client,\r\n        calendarIds: string[],\r\n        options: { timeMin?: string; timeMax?: string }\r\n    ): Promise<ExtendedEvent[]> {\r\n        const batchHandler = new BatchRequestHandler(client);\r\n        \r\n        const requests = calendarIds.map(calendarId => ({\r\n            method: \"GET\" as const,\r\n            path: this.buildEventsPath(calendarId, options)\r\n        }));\r\n        \r\n        const responses = await batchHandler.executeBatch(requests);\r\n        \r\n        const { events, errors } = this.processBatchResponses(responses, calendarIds);\r\n        \r\n        if (errors.length > 0) {\r\n            console.warn(\"Some calendars had errors:\", errors.map(e => `${e.calendarId}: ${e.error}`));\r\n        }\r\n        \r\n        return this.sortEventsByStartTime(events);\r\n    }\r\n\r\n    private buildEventsPath(calendarId: string, options: { timeMin?: string; timeMax?: string }): string {\r\n        const params = new URLSearchParams({\r\n            singleEvents: \"true\",\r\n            orderBy: \"startTime\",\r\n            ...(options.timeMin && { timeMin: options.timeMin }),\r\n            ...(options.timeMax && { timeMax: options.timeMax })\r\n        });\r\n        \r\n        return `/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?${params.toString()}`;\r\n    }\r\n\r\n    private processBatchResponses(\r\n        responses: any[], \r\n        calendarIds: string[]\r\n    ): { events: ExtendedEvent[]; errors: Array<{ calendarId: string; error: string }> } {\r\n        const events: ExtendedEvent[] = [];\r\n        const errors: Array<{ calendarId: string; error: string }> = [];\r\n        \r\n        responses.forEach((response, index) => {\r\n            const calendarId = calendarIds[index];\r\n            \r\n            if (response.statusCode === 200 && response.body?.items) {\r\n                const calendarEvents: ExtendedEvent[] = response.body.items.map((event: any) => ({\r\n                    ...event,\r\n                    calendarId\r\n                }));\r\n                events.push(...calendarEvents);\r\n            } else {\r\n                const errorMessage = response.body?.error?.message || \r\n                                   response.body?.message || \r\n                                   `HTTP ${response.statusCode}`;\r\n                errors.push({ calendarId, error: errorMessage });\r\n            }\r\n        });\r\n        \r\n        return { events, errors };\r\n    }\r\n\r\n    private sortEventsByStartTime(events: ExtendedEvent[]): ExtendedEvent[] {\r\n        return events.sort((a, b) => {\r\n            const aStart = a.start?.dateTime || a.start?.date || \"\";\r\n            const bStart = b.start?.dateTime || b.start?.date || \"\";\r\n            return aStart.localeCompare(bStart);\r\n        });\r\n    }\r\n\r\n    private formatEventList(events: ExtendedEvent[], calendarIds: string[]): string {\r\n        if (events.length === 0) {\r\n            return `No events found in ${calendarIds.length} calendar(s).`;\r\n        }\r\n        \r\n        if (calendarIds.length === 1) {\r\n            return formatEventList(events);\r\n        }\r\n        \r\n        return this.formatMultiCalendarEvents(events, calendarIds);\r\n    }\r\n\r\n    private formatMultiCalendarEvents(events: ExtendedEvent[], calendarIds: string[]): string {\r\n        const grouped = this.groupEventsByCalendar(events);\r\n        \r\n        let output = `Found ${events.length} events across ${calendarIds.length} calendars:\\n\\n`;\r\n        \r\n        for (const [calendarId, calEvents] of Object.entries(grouped)) {\r\n            output += `Calendar: ${calendarId}\\n`;\r\n            output += formatEventList(calEvents);\r\n            output += '\\n';\r\n        }\r\n        \r\n        return output;\r\n    }\r\n\r\n    private groupEventsByCalendar(events: ExtendedEvent[]): Record<string, ExtendedEvent[]> {\r\n        return events.reduce((acc, event) => {\r\n            const calId = event.calendarId;\r\n            if (!acc[calId]) acc[calId] = [];\r\n            acc[calId].push(event);\r\n            return acc;\r\n        }, {} as Record<string, ExtendedEvent[]>);\r\n    }\r\n}\r\n", "import { BaseToolHandler } from './BaseToolHandler.js';\r\nimport { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { FreeBusyEventArgumentsSchema } from \"../../schemas/validators.js\";\r\nimport { z } from \"zod\";\r\nimport { FreeBusyResponse } from '../../schemas/types.js';\r\n\r\nexport class FreeBusyEventHandler extends BaseToolHandler {\r\n  async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n\r\n    const validArgs = FreeBusyEventArgumentsSchema.safeParse(args);\r\n    if (!validArgs.success) {\r\n      throw new Error(\r\n          `Invalid arguments Error: ${JSON.stringify(validArgs.error.issues)}`\r\n      );\r\n    }\r\n\r\n    if(!this.isLessThanThreeMonths(validArgs.data.timeMin,validArgs.data.timeMax)){\r\n      return {\r\n        content: [{\r\n          type: \"text\",\r\n          text: \"The time gap between timeMin and timeMax must be less than 3 months\",\r\n        }],\r\n      }\r\n    }\r\n\r\n    const result = await this.queryFreeBusy(oauth2Client, validArgs.data);\r\n    const summaryText = this.generateAvailabilitySummary(result);\r\n\r\n    return {\r\n      content: [{\r\n        type: \"text\",\r\n        text: summaryText,\r\n      }]\r\n    };\r\n  }\r\n\r\n  private async queryFreeBusy(\r\n    client: OAuth2Client,\r\n    args: z.infer<typeof FreeBusyEventArgumentsSchema>\r\n  ): Promise<FreeBusyResponse> {\r\n    try {\r\n      const calendar = this.getCalendar(client);\r\n      const response = await calendar.freebusy.query({\r\n        requestBody: {\r\n          timeMin: args.timeMin,\r\n          timeMax: args.timeMax,\r\n          timeZone: args.timeZone,\r\n          groupExpansionMax: args.groupExpansionMax,\r\n          calendarExpansionMax: args.calendarExpansionMax,\r\n          items: args.items,\r\n        },\r\n      });\r\n      return response.data as FreeBusyResponse;\r\n    } catch (error) {\r\n      throw this.handleGoogleApiError(error);\r\n    }\r\n  }\r\n\r\n  private isLessThanThreeMonths (timeMin: string, timeMax: string): boolean {\r\n    const minDate = new Date(timeMin);\r\n    const maxDate = new Date(timeMax);\r\n\r\n    const diffInMilliseconds = maxDate.getTime() - minDate.getTime();\r\n    const threeMonthsInMilliseconds = 3 * 30 * 24 * 60 * 60 * 1000;\r\n\r\n    // Check if the difference is less than or equal to 3 months\r\n    return diffInMilliseconds <= threeMonthsInMilliseconds;\r\n  };\r\n\r\n  private generateAvailabilitySummary(response: FreeBusyResponse): string {\r\n    return Object.entries(response.calendars)\r\n      .map(([email, calendarInfo]) => {\r\n        if (calendarInfo.errors?.some(error => error.reason === \"notFound\")) {\r\n          return `Cannot check availability for ${email} (account not found)\\n`;\r\n        }\r\n\r\n        if (calendarInfo.busy.length === 0) {\r\n          return `${email} is available during ${response.timeMin} to ${response.timeMax}, please schedule calendar to ${email} if you want \\n`;\r\n        }\r\n\r\n        const busyTimes = calendarInfo.busy\r\n          .map(slot => `- From ${slot.start} to ${slot.end}`)\r\n          .join(\"\\n\");\r\n        return `${email} is busy during:\\n${busyTimes}\\n`;\r\n      })\r\n      .join(\"\\n\")\r\n      .trim();\r\n  }\r\n}\r\n", "/**\r\n * HTTP Wrapper Server for MCP Google Calendar\r\n * This creates an HTTP API that wraps the MCP server functionality\r\n */\r\n\r\nimport express from 'express';\r\nimport { initializeOAuth2Client } from './auth/client.js';\r\nimport { TokenManager } from './auth/tokenManager.js';\r\nimport { handleCallTool } from './handlers/callTool.js';\r\nimport { CallToolRequestSchema } from '@modelcontextprotocol/sdk/types.js';\r\n\r\nconst app = express();\r\napp.use(express.json());\r\n\r\nlet oauth2Client: any;\r\nlet tokenManager: TokenManager;\r\n\r\n// Initialize OAuth client\r\nasync function initialize() {\r\n  try {\r\n    oauth2Client = await initializeOAuth2Client();\r\n    tokenManager = new TokenManager(oauth2Client);\r\n    // Validate and load tokens\r\n    const tokensValid = await tokenManager.validateTokens();\r\n    if (!tokensValid) {\r\n      throw new Error('Authentication required. Please run \"npm run auth\" first.');\r\n    }\r\n    console.log('OAuth client initialized');\r\n  } catch (error) {\r\n    console.error('Failed to initialize OAuth:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// Health check endpoint\r\napp.get('/health', (req, res) => {\r\n  res.json({ status: 'ok' });\r\n});\r\n\r\n// Main MCP endpoint\r\napp.post('/mcp/calendar', async (req, res) => {\r\n  try {\r\n    const { user_id, action, params } = req.body;\r\n    \r\n    // Map action to MCP tool name\r\n    const toolNameMap: Record<string, string> = {\r\n      'freebusy': 'get-freebusy',\r\n      'list-events': 'list-events',\r\n      'create-event': 'create-event',\r\n      'update-event': 'update-event',\r\n      'delete-event': 'delete-event',\r\n      'list-calendars': 'list-calendars',\r\n    };\r\n    \r\n    // Actions that need raw data returned\r\n    const actionsNeedingRawData = ['get-freebusy', 'list-events'];\r\n    \r\n    const toolName = toolNameMap[action] || action;\r\n    \r\n    // Create MCP-compatible request (matching CallToolRequestSchema)\r\n    const mcpRequest = {\r\n      method: 'tools/call' as const,\r\n      params: {\r\n        name: toolName,\r\n        arguments: params || {},\r\n      },\r\n    };\r\n    \r\n    // Handle the tool call\r\n    const result = await handleCallTool(mcpRequest, oauth2Client);\r\n    \r\n    // For freebusy, we need to also return the raw calendar data\r\n    // The handler returns text summary, but we need the actual busy slots for processing\r\n    if (toolName === 'get-freebusy' && params) {\r\n      try {\r\n        const { FreeBusyEventHandler } = await import('./handlers/core/FreeBusyEventHandler.js');\r\n        const { FreeBusyEventArgumentsSchema } = await import('./schemas/validators.js');\r\n        const handler = new FreeBusyEventHandler();\r\n        \r\n        // Validate arguments\r\n        const validArgs = FreeBusyEventArgumentsSchema.safeParse(params);\r\n        if (validArgs.success) {\r\n          // Use reflection to access the private queryFreeBusy method\r\n          // @ts-ignore - accessing private method\r\n          const rawData = await handler.queryFreeBusy(oauth2Client, validArgs.data);\r\n          \r\n          // Add raw calendar data to the response\r\n          result.raw = rawData;\r\n          // Also add busy slots directly for easier access\r\n          const allBusySlots: any[] = [];\r\n          if (rawData.calendars) {\r\n            for (const calendarId in rawData.calendars) {\r\n              const calendarInfo = rawData.calendars[calendarId];\r\n              if (calendarInfo.busy) {\r\n                allBusySlots.push(...calendarInfo.busy);\r\n              }\r\n            }\r\n          }\r\n          result.busy = allBusySlots;\r\n        }\r\n      } catch (e) {\r\n        // If we can't get raw data, just return the result as-is\r\n        console.error('Error getting raw freebusy data:', e);\r\n      }\r\n    }\r\n    \r\n    // For list-events, we need to return raw event data\r\n    if (toolName === 'list-events' && params) {\r\n      try {\r\n        const { ListEventsHandler } = await import('./handlers/core/ListEventsHandler.js');\r\n        const { ListEventsArgumentsSchema } = await import('./schemas/validators.js');\r\n        const handler = new ListEventsHandler();\r\n        \r\n        // Validate arguments\r\n        const validArgs = ListEventsArgumentsSchema.safeParse(params);\r\n        if (validArgs.success) {\r\n          // Use reflection to access the private fetchEvents method\r\n          // @ts-ignore - accessing private method\r\n          const rawEvents = await handler.fetchEvents(oauth2Client, validArgs.data.calendarId, {\r\n            timeMin: validArgs.data.timeMin,\r\n            timeMax: validArgs.data.timeMax\r\n          });\r\n          \r\n          // Add raw events data to the response\r\n          result.raw = rawEvents;\r\n          result.events = rawEvents;\r\n        }\r\n      } catch (e) {\r\n        // If we can't get raw data, just return the result as-is\r\n        console.error('Error getting raw events data:', e);\r\n      }\r\n    }\r\n    \r\n    // For create-event, we need to return raw event data\r\n    // The handleCallTool already creates the event, but we need to extract it from the response\r\n    // We'll parse the event ID from the content text and fetch the full event details\r\n    if (toolName === 'create-event' && params) {\r\n      try {\r\n        // Extract event ID from the result content\r\n        let eventId: string | null = null;\r\n        if (result.content && Array.isArray(result.content)) {\r\n          for (const item of result.content) {\r\n            if (item.type === 'text' && item.text) {\r\n              // Parse \"Event created: Meeting with Greta (event_id)\"\r\n              const match = item.text.match(/\\(([^)]+)\\)/);\r\n              if (match) {\r\n                eventId = match[1];\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // If we found an event ID, fetch the full event details\r\n        if (eventId) {\r\n          const { google } = await import('googleapis');\r\n          const calendar = google.calendar({ version: 'v3', auth: oauth2Client });\r\n          const { CreateEventArgumentsSchema } = await import('./schemas/validators.js');\r\n          const validArgs = CreateEventArgumentsSchema.safeParse(params);\r\n          \r\n          if (validArgs.success) {\r\n            try {\r\n              const eventResponse = await calendar.events.get({\r\n                calendarId: validArgs.data.calendarId,\r\n                eventId: eventId,\r\n              });\r\n              \r\n              // Type assertion: eventResponse is a GaxiosPromise that resolves to { data: Schema$Event }\r\n              const eventData = (eventResponse as any).data;\r\n              if (eventData) {\r\n                result.raw = eventData;\r\n                result.event = eventData;\r\n              }\r\n            } catch (fetchError) {\r\n              console.error('Error fetching event details:', fetchError);\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // If we can't get raw data, just return the result as-is\r\n        console.error('Error getting raw event data:', e);\r\n      }\r\n    }\r\n    \r\n    res.json(result);\r\n  } catch (error: any) {\r\n    console.error('Error handling request:', error);\r\n    res.status(500).json({ \r\n      error: error.message || 'Internal server error',\r\n      content: []\r\n    });\r\n  }\r\n});\r\n\r\n// Start server\r\nconst PORT = process.env.PORT || 3000;\r\nasync function startServer() {\r\n  await initialize();\r\n  app.listen(PORT, () => {\r\n    console.log(`MCP HTTP Server running on http://localhost:${PORT}`);\r\n    console.log(`Endpoint: http://localhost:${PORT}/mcp/calendar`);\r\n  });\r\n}\r\n\r\nstartServer().catch(console.error);\r\n\r\n", "import { OAuth2Client } from 'google-auth-library';\r\nimport * as fs from 'fs/promises';\r\nimport { getKeysFilePath, generateCredentialsErrorMessage, OAuthCredentials } from './utils.js';\r\n\r\nasync function loadCredentialsFromFile(): Promise<OAuthCredentials> {\r\n  const keysContent = await fs.readFile(getKeysFilePath(), \"utf-8\");\r\n  const keys = JSON.parse(keysContent);\r\n\r\n  if (keys.installed) {\r\n    // Standard OAuth credentials file format\r\n    const { client_id, client_secret, redirect_uris } = keys.installed;\r\n    return { client_id, client_secret, redirect_uris };\r\n  } else if (keys.client_id && keys.client_secret) {\r\n    // Direct format\r\n    return {\r\n      client_id: keys.client_id,\r\n      client_secret: keys.client_secret,\r\n      redirect_uris: keys.redirect_uris || ['http://localhost:3000/oauth2callback']\r\n    };\r\n  } else {\r\n    throw new Error('Invalid credentials file format. Expected either \"installed\" object or direct client_id/client_secret fields.');\r\n  }\r\n}\r\n\r\nasync function loadCredentialsWithFallback(): Promise<OAuthCredentials> {\r\n  // First check for direct environment variables\r\n  const clientId = process.env.GOOGLE_CLIENT_ID;\r\n  const clientSecret = process.env.GOOGLE_CLIENT_SECRET;\r\n  \r\n  if (clientId && clientSecret) {\r\n    // Use environment variables directly - no JSON file needed!\r\n    return {\r\n      client_id: clientId,\r\n      client_secret: clientSecret,\r\n      redirect_uris: ['http://localhost:3000/oauth2callback']\r\n    };\r\n  }\r\n  \r\n  // Otherwise, load credentials from file (CLI param, env var, or default path)\r\n  try {\r\n    return await loadCredentialsFromFile();\r\n  } catch (fileError) {\r\n    // Generate helpful error message\r\n    const errorMessage = generateCredentialsErrorMessage();\r\n    throw new Error(`${errorMessage}\\n\\nOriginal error: ${fileError instanceof Error ? fileError.message : fileError}`);\r\n  }\r\n}\r\n\r\nexport async function initializeOAuth2Client(): Promise<OAuth2Client> {\r\n  try {\r\n    const credentials = await loadCredentialsWithFallback();\r\n    \r\n    // Use the first redirect URI as the default for the base client\r\n    const oauth2Client = new OAuth2Client({\r\n      clientId: credentials.client_id,\r\n      clientSecret: credentials.client_secret,\r\n      redirectUri: credentials.redirect_uris[0],\r\n    });\r\n\r\n    return oauth2Client;\r\n  } catch (error) {\r\n    throw new Error(`Error loading OAuth keys: ${error instanceof Error ? error.message : error}`);\r\n  }\r\n}\r\n\r\nexport async function loadCredentials(): Promise<{ client_id: string; client_secret: string }> {\r\n  try {\r\n    const credentials = await loadCredentialsWithFallback();\r\n    \r\n    if (!credentials.client_id || !credentials.client_secret) {\r\n        throw new Error('Client ID or Client Secret missing in credentials.');\r\n    }\r\n    return {\r\n      client_id: credentials.client_id,\r\n      client_secret: credentials.client_secret\r\n    };\r\n  } catch (error) {\r\n    throw new Error(`Error loading credentials: ${error instanceof Error ? error.message : error}`);\r\n  }\r\n}", "import * as path from 'path';\r\nimport * as os from 'os';\r\nimport { fileURLToPath } from 'url';\r\n\r\n// Helper to get the project root directory reliably\r\nfunction getProjectRoot(): string {\r\n  const __dirname = path.dirname(fileURLToPath(import.meta.url));\r\n  // In build output (e.g., build/bundle.js), __dirname is .../build\r\n  // Go up ONE level to get the project root\r\n  const projectRoot = path.join(__dirname, \"..\"); // Corrected: Go up ONE level\r\n  return path.resolve(projectRoot); // Ensure absolute path\r\n}\r\n\r\n// Returns the absolute path for the saved token file.\r\n// Uses XDG Base Directory spec with fallback to home directory and legacy project root\r\nexport function getSecureTokenPath(): string {\r\n  // Check for custom token path environment variable first\r\n  const customTokenPath = process.env.GOOGLE_CALENDAR_MCP_TOKEN_PATH;\r\n  if (customTokenPath) {\r\n    return path.resolve(customTokenPath);\r\n  }\r\n\r\n  // Use XDG Base Directory spec or fallback to ~/.config\r\n  const configHome = process.env.XDG_CONFIG_HOME || \r\n    path.join(os.homedir(), '.config');\r\n  \r\n  const tokenDir = path.join(configHome, 'google-calendar-mcp');\r\n  return path.join(tokenDir, 'tokens.json');\r\n}\r\n\r\n// Returns the legacy token path for backward compatibility\r\nexport function getLegacyTokenPath(): string {\r\n  const projectRoot = getProjectRoot();\r\n  return path.join(projectRoot, \".gcp-saved-tokens.json\");\r\n}\r\n\r\n// Returns the absolute path for the GCP OAuth keys file with priority:\r\n// 1. Environment variable GOOGLE_OAUTH_CREDENTIALS (highest priority)\r\n// 2. Default file path (lowest priority)\r\nexport function getKeysFilePath(): string {\r\n  // Priority 1: Environment variable\r\n  const envCredentialsPath = process.env.GOOGLE_OAUTH_CREDENTIALS;\r\n  if (envCredentialsPath) {\r\n    return path.resolve(envCredentialsPath);\r\n  }\r\n  \r\n  // Priority 2: Default file path\r\n  const projectRoot = getProjectRoot();\r\n  const keysPath = path.join(projectRoot, \"gcp-oauth.keys.json\");\r\n  return keysPath; // Already absolute from getProjectRoot\r\n}\r\n\r\n// Interface for OAuth credentials\r\nexport interface OAuthCredentials {\r\n  client_id: string;\r\n  client_secret: string;\r\n  redirect_uris: string[];\r\n}\r\n\r\n// Generate helpful error message for missing credentials\r\nexport function generateCredentialsErrorMessage(): string {\r\n  return `\r\nOAuth credentials not found. Please provide credentials using one of these methods:\r\n\r\n1. Direct environment variables (simplest - no JSON file needed!):\r\n   Set GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET:\r\n   export GOOGLE_CLIENT_ID=\"your-client-id.apps.googleusercontent.com\"\r\n   export GOOGLE_CLIENT_SECRET=\"your-client-secret\"\r\n\r\n2. Credentials file via environment variable:\r\n   Set GOOGLE_OAUTH_CREDENTIALS to the path of your credentials file:\r\n   export GOOGLE_OAUTH_CREDENTIALS=\"/path/to/gcp-oauth.keys.json\"\r\n\r\n3. Default file path:\r\n   Place your gcp-oauth.keys.json file in the package root directory.\r\n\r\nToken storage:\r\n- Tokens are saved to: ${getSecureTokenPath()}\r\n- To use a custom token location, set GOOGLE_CALENDAR_MCP_TOKEN_PATH environment variable\r\n\r\nTo get OAuth credentials:\r\n1. Go to the Google Cloud Console (https://console.cloud.google.com/)\r\n2. Create or select a project\r\n3. Enable these APIs:\r\n   - Google Calendar API\r\n   - Google People API\r\n   - Gmail API\r\n4. Create OAuth 2.0 credentials (Desktop app type)\r\n5. Copy the Client ID and Client Secret\r\n`.trim();\r\n}", "import { OAuth2Client, Credentials } from 'google-auth-library';\r\nimport * as fs from 'fs/promises';\r\nimport * as path from 'path';\r\nimport { getSecureTokenPath, getLegacyTokenPath } from './utils.js';\r\nimport { GaxiosError } from 'gaxios';\r\n\r\nexport class TokenManager {\r\n  private oauth2Client: OAuth2Client;\r\n  private tokenPath: string;\r\n\r\n  constructor(oauth2Client: OAuth2Client) {\r\n    this.oauth2Client = oauth2Client;\r\n    this.tokenPath = getSecureTokenPath();\r\n    this.setupTokenRefresh();\r\n  }\r\n\r\n  // Method to expose the token path\r\n  public getTokenPath(): string {\r\n    return this.tokenPath;\r\n  }\r\n\r\n  private async ensureTokenDirectoryExists(): Promise<void> {\r\n    try {\r\n        const dir = path.dirname(this.tokenPath);\r\n        await fs.mkdir(dir, { recursive: true });\r\n    } catch (error: unknown) {\r\n        // Ignore errors if directory already exists, re-throw others\r\n        if (error instanceof Error && 'code' in error && error.code !== 'EEXIST') {\r\n            console.error('Failed to create token directory:', error);\r\n            throw error;\r\n        }\r\n    }\r\n  }\r\n\r\n  private setupTokenRefresh(): void {\r\n    this.oauth2Client.on(\"tokens\", async (newTokens) => {\r\n      try {\r\n        await this.ensureTokenDirectoryExists();\r\n        const currentTokens = JSON.parse(await fs.readFile(this.tokenPath, \"utf-8\"));\r\n        const updatedTokens = {\r\n          ...currentTokens,\r\n          ...newTokens,\r\n          refresh_token: newTokens.refresh_token || currentTokens.refresh_token,\r\n        };\r\n        await fs.writeFile(this.tokenPath, JSON.stringify(updatedTokens, null, 2), {\r\n          mode: 0o600,\r\n        });\r\n        console.error(\"Tokens updated and saved\");\r\n      } catch (error: unknown) {\r\n        // Handle case where currentTokens might not exist yet\r\n        if (error instanceof Error && 'code' in error && error.code === 'ENOENT') { \r\n          try {\r\n             await fs.writeFile(this.tokenPath, JSON.stringify(newTokens, null, 2), { mode: 0o600 });\r\n             console.error(\"New tokens saved\");\r\n          } catch (writeError) {\r\n            console.error(\"Error saving initial tokens:\", writeError);\r\n          }\r\n        } else {\r\n            console.error(\"Error saving updated tokens:\", error);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private async migrateLegacyTokens(): Promise<boolean> {\r\n    const legacyPath = getLegacyTokenPath();\r\n    try {\r\n      // Check if legacy tokens exist\r\n      if (!(await fs.access(legacyPath).then(() => true).catch(() => false))) {\r\n        return false; // No legacy tokens to migrate\r\n      }\r\n\r\n      // Read legacy tokens\r\n      const legacyTokens = JSON.parse(await fs.readFile(legacyPath, \"utf-8\"));\r\n      \r\n      if (!legacyTokens || typeof legacyTokens !== \"object\") {\r\n        console.error(\"Invalid legacy token format, skipping migration\");\r\n        return false;\r\n      }\r\n\r\n      // Ensure new token directory exists\r\n      await this.ensureTokenDirectoryExists();\r\n      \r\n      // Copy to new location\r\n      await fs.writeFile(this.tokenPath, JSON.stringify(legacyTokens, null, 2), {\r\n        mode: 0o600,\r\n      });\r\n      \r\n      console.error(\"Migrated tokens from legacy location:\", legacyPath, \"to:\", this.tokenPath);\r\n      \r\n      // Optionally remove legacy file after successful migration\r\n      try {\r\n        await fs.unlink(legacyPath);\r\n        console.error(\"Removed legacy token file\");\r\n      } catch (unlinkErr) {\r\n        console.error(\"Warning: Could not remove legacy token file:\", unlinkErr);\r\n      }\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Error migrating legacy tokens:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async loadSavedTokens(): Promise<boolean> {\r\n    try {\r\n      await this.ensureTokenDirectoryExists();\r\n      \r\n      // Check if current token file exists\r\n      const tokenExists = await fs.access(this.tokenPath).then(() => true).catch(() => false);\r\n      \r\n      // If no current tokens, try to migrate from legacy location\r\n      if (!tokenExists) {\r\n        const migrated = await this.migrateLegacyTokens();\r\n        if (!migrated) {\r\n          console.error(\"No token file found at:\", this.tokenPath);\r\n          return false;\r\n        }\r\n      }\r\n\r\n      const tokens = JSON.parse(await fs.readFile(this.tokenPath, \"utf-8\"));\r\n\r\n      if (!tokens || typeof tokens !== \"object\") {\r\n        console.error(\"Invalid token format in file:\", this.tokenPath);\r\n        return false;\r\n      }\r\n\r\n      this.oauth2Client.setCredentials(tokens);\r\n      return true;\r\n    } catch (error: unknown) {\r\n      console.error(\"Error loading tokens:\", error);\r\n      // Attempt to delete potentially corrupted token file\r\n      if (error instanceof Error && 'code' in error && error.code !== 'ENOENT') { \r\n          try { \r\n              await fs.unlink(this.tokenPath); \r\n              console.error(\"Removed potentially corrupted token file\") \r\n            } catch (unlinkErr) { /* ignore */ } \r\n      }\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async refreshTokensIfNeeded(): Promise<boolean> {\r\n    const expiryDate = this.oauth2Client.credentials.expiry_date;\r\n    const isExpired = expiryDate\r\n      ? Date.now() >= expiryDate - 5 * 60 * 1000 // 5 minute buffer\r\n      : !this.oauth2Client.credentials.access_token; // No token means we need one\r\n\r\n    if (isExpired && this.oauth2Client.credentials.refresh_token) {\r\n      console.error(\"Auth token expired or nearing expiry, refreshing...\");\r\n      try {\r\n        const response = await this.oauth2Client.refreshAccessToken();\r\n        const newTokens = response.credentials;\r\n\r\n        if (!newTokens.access_token) {\r\n          throw new Error(\"Received invalid tokens during refresh\");\r\n        }\r\n        // The 'tokens' event listener should handle saving\r\n        this.oauth2Client.setCredentials(newTokens);\r\n        console.error(\"Token refreshed successfully\");\r\n        return true;\r\n      } catch (refreshError) {\r\n        if (refreshError instanceof GaxiosError && refreshError.response?.data?.error === 'invalid_grant') {\r\n            console.error(\"Error refreshing auth token: Invalid grant. Token likely expired or revoked. Please re-authenticate.\");\r\n            // Optionally clear the potentially invalid tokens here\r\n            // await this.clearTokens(); \r\n            return false; // Indicate failure due to invalid grant\r\n        } else {\r\n            // Handle other refresh errors\r\n            console.error(\"Error refreshing auth token:\", refreshError);\r\n            return false;\r\n        }\r\n      }\r\n    } else if (!this.oauth2Client.credentials.access_token && !this.oauth2Client.credentials.refresh_token) {\r\n        console.error(\"No access or refresh token available. Please re-authenticate.\");\r\n        return false;\r\n    } else {\r\n        // Token is valid or no refresh token available\r\n        return true;\r\n    }\r\n  }\r\n\r\n  async validateTokens(): Promise<boolean> {\r\n    if (!this.oauth2Client.credentials || !this.oauth2Client.credentials.access_token) {\r\n        // Try loading first if no credentials set\r\n        if (!(await this.loadSavedTokens())) {\r\n            return false; // No saved tokens to load\r\n        }\r\n        // Check again after loading\r\n        if (!this.oauth2Client.credentials || !this.oauth2Client.credentials.access_token) {\r\n            return false; // Still no token after loading\r\n        }\r\n    }\r\n    return this.refreshTokensIfNeeded();\r\n  }\r\n\r\n  async saveTokens(tokens: Credentials): Promise<void> {\r\n    try {\r\n        await this.ensureTokenDirectoryExists();\r\n        await fs.writeFile(this.tokenPath, JSON.stringify(tokens, null, 2), { mode: 0o600 });\r\n        this.oauth2Client.setCredentials(tokens);\r\n        console.error(\"Tokens saved successfully to:\", this.tokenPath);\r\n    } catch (error: unknown) {\r\n        console.error(\"Error saving tokens:\", error);\r\n        throw error;\r\n    }\r\n  }\r\n\r\n  async clearTokens(): Promise<void> {\r\n    try {\r\n      this.oauth2Client.setCredentials({}); // Clear in memory\r\n      await fs.unlink(this.tokenPath);\r\n      console.error(\"Tokens cleared successfully\");\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error && 'code' in error && error.code === 'ENOENT') {\r\n        // File already gone, which is fine\r\n        console.error(\"Token file already deleted\");\r\n      } else {\r\n        console.error(\"Error clearing tokens:\", error);\r\n        // Don't re-throw, clearing is best-effort\r\n      }\r\n    }\r\n  }\r\n} ", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { calendar_v3, google } from \"googleapis\";\r\n\r\nexport class ListCalendarsHandler extends BaseToolHandler {\r\n    async runTool(_: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const calendars = await this.listCalendars(oauth2Client);\r\n        return {\r\n            content: [{\r\n                type: \"text\", // This MUST be a string literal\r\n                text: this.formatCalendarList(calendars),\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async listCalendars(client: OAuth2Client): Promise<calendar_v3.Schema$CalendarListEntry[]> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            const response = await calendar.calendarList.list();\r\n            return response.data.items || [];\r\n        } catch (error) {\r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Formats a list of calendars into a user-friendly string.\r\n     */\r\n    private formatCalendarList(calendars: calendar_v3.Schema$CalendarListEntry[]): string {\r\n        return calendars\r\n            .map((cal) => `${cal.summary || \"Untitled\"} (${cal.id || \"no-id\"})`)\r\n            .join(\"\\n\");\r\n    }\r\n\r\n}\r\n", "import { CallToolRequestSchema } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from 'google-auth-library';\r\nimport { BaseToolHandler } from \"./core/BaseToolHandler.js\";\r\nimport { ListCalendarsHandler } from \"./core/ListCalendarsHandler.js\";\r\nimport { ListEventsHandler } from \"./core/ListEventsHandler.js\";\r\nimport { SearchEventsHandler } from \"./core/SearchEventsHandler.js\";\r\nimport { ListColorsHandler } from \"./core/ListColorsHandler.js\";\r\nimport { CreateEventHandler } from \"./core/CreateEventHandler.js\";\r\nimport { UpdateEventHandler } from \"./core/UpdateEventHandler.js\";\r\nimport { DeleteEventHandler } from \"./core/DeleteEventHandler.js\";\r\nimport { FreeBusyEventHandler } from \"./core/FreeBusyEventHandler.js\";\r\nimport { ListContactsHandler } from \"./core/contacts/ListContactsHandler.js\";\r\nimport { GetContactHandler } from \"./core/contacts/GetContactHandler.js\";\r\nimport { CreateContactHandler } from \"./core/contacts/CreateContactHandler.js\";\r\nimport { UpdateContactHandler } from \"./core/contacts/UpdateContactHandler.js\";\r\nimport { DeleteContactHandler } from \"./core/contacts/DeleteContactHandler.js\";\r\nimport { ListEmailsHandler } from \"./core/gmail/ListEmailsHandler.js\";\r\nimport { GetEmailHandler } from \"./core/gmail/GetEmailHandler.js\";\r\nimport { SendEmailHandler } from \"./core/gmail/SendEmailHandler.js\";\r\nimport { UpdateEmailHandler } from \"./core/gmail/UpdateEmailHandler.js\";\r\nimport { DeleteEmailHandler } from \"./core/gmail/DeleteEmailHandler.js\";\r\nimport { CreateDraftHandler } from \"./core/gmail/CreateDraftHandler.js\";\r\nimport { UpdateDraftHandler } from \"./core/gmail/UpdateDraftHandler.js\";\r\nimport { SendDraftHandler } from \"./core/gmail/SendDraftHandler.js\";\r\nimport { ListLabelsHandler } from \"./core/gmail/ListLabelsHandler.js\";\r\nimport { CreateLabelHandler } from \"./core/gmail/CreateLabelHandler.js\";\r\nimport { UpdateLabelHandler } from \"./core/gmail/UpdateLabelHandler.js\";\r\nimport { DeleteLabelHandler } from \"./core/gmail/DeleteLabelHandler.js\";\r\nimport { BatchUpdateEmailsHandler } from \"./core/gmail/BatchUpdateEmailsHandler.js\";\r\n\r\n/**\r\n * Handles incoming tool calls, validates arguments, calls the appropriate service,\r\n * and formats the response.\r\n *\r\n * @param request The CallToolRequest containing tool name and arguments.\r\n * @param oauth2Client The authenticated OAuth2 client instance.\r\n * @returns A Promise resolving to the CallToolResponse.\r\n */\r\nexport async function handleCallTool(request: typeof CallToolRequestSchema._type, oauth2Client: OAuth2Client) {\r\n    const { name, arguments: args } = request.params;\r\n\r\n    try {\r\n        const handler = getHandler(name);\r\n        return await handler.runTool(args, oauth2Client);\r\n    } catch (error: unknown) {\r\n        console.error(`Error executing tool '${name}':`, error);\r\n        // Re-throw the error to be handled by the main server logic or error handler\r\n        throw error;\r\n    }\r\n}\r\n\r\nconst handlerMap: Record<string, BaseToolHandler> = {\r\n    // Calendar handlers\r\n    \"list-calendars\": new ListCalendarsHandler(),\r\n    \"list-events\": new ListEventsHandler(),\r\n    \"search-events\": new SearchEventsHandler(),\r\n    \"list-colors\": new ListColorsHandler(),\r\n    \"create-event\": new CreateEventHandler(),\r\n    \"update-event\": new UpdateEventHandler(),\r\n    \"delete-event\": new DeleteEventHandler(),\r\n    \"get-freebusy\": new FreeBusyEventHandler(),\r\n    // Contact handlers\r\n    \"list-contacts\": new ListContactsHandler(),\r\n    \"get-contact\": new GetContactHandler(),\r\n    \"create-contact\": new CreateContactHandler(),\r\n    \"update-contact\": new UpdateContactHandler(),\r\n    \"delete-contact\": new DeleteContactHandler(),\r\n    // Gmail handlers\r\n    \"list-emails\": new ListEmailsHandler(),\r\n    \"get-email\": new GetEmailHandler(),\r\n    \"send-email\": new SendEmailHandler(),\r\n    \"update-email\": new UpdateEmailHandler(),\r\n    \"delete-email\": new DeleteEmailHandler(),\r\n    \"create-draft\": new CreateDraftHandler(),\r\n    \"update-draft\": new UpdateDraftHandler(),\r\n    \"send-draft\": new SendDraftHandler(),\r\n    \"list-labels\": new ListLabelsHandler(),\r\n    \"create-label\": new CreateLabelHandler(),\r\n    \"update-label\": new UpdateLabelHandler(),\r\n    \"delete-label\": new DeleteLabelHandler(),\r\n    \"batch-update-emails\": new BatchUpdateEmailsHandler(),\r\n};\r\n\r\nfunction getHandler(toolName: string): BaseToolHandler {\r\n    const handler = handlerMap[toolName];\r\n    if (!handler) {\r\n        throw new Error(`Unknown tool: ${toolName}`);\r\n    }\r\n    return handler;\r\n}\r\n", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { SearchEventsArgumentsSchema } from \"../../schemas/validators.js\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { calendar_v3 } from 'googleapis';\r\nimport { z } from 'zod';\r\nimport { formatEventList } from \"../utils.js\";\r\n\r\nexport class SearchEventsHandler extends BaseToolHandler {\r\n    async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const validArgs = SearchEventsArgumentsSchema.parse(args);\r\n        const events = await this.searchEvents(oauth2Client, validArgs);\r\n        return {\r\n            content: [{\r\n                type: \"text\",\r\n                text: formatEventList(events),\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async searchEvents(\r\n        client: OAuth2Client,\r\n        args: z.infer<typeof SearchEventsArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event[]> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            const response = await calendar.events.list({\r\n                calendarId: args.calendarId,\r\n                q: args.query,\r\n                timeMin: args.timeMin,\r\n                timeMax: args.timeMax,\r\n                singleEvents: true,\r\n                orderBy: 'startTime',\r\n            });\r\n            return response.data.items || [];\r\n        } catch (error) {\r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n}\r\n", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { calendar_v3 } from \"googleapis\";\r\n\r\nexport class ListColorsHandler extends BaseToolHandler {\r\n    async runTool(_: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const colors = await this.listColors(oauth2Client);\r\n        return {\r\n            content: [{\r\n                type: \"text\",\r\n                text: `Available event colors:\\n${this.formatColorList(colors)}`,\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async listColors(client: OAuth2Client): Promise<calendar_v3.Schema$Colors> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            const response = await calendar.colors.get();\r\n            if (!response.data) throw new Error('Failed to retrieve colors');\r\n            return response.data;\r\n        } catch (error) {\r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Formats the color information into a user-friendly string.\r\n     */\r\n    private formatColorList(colors: calendar_v3.Schema$Colors): string {\r\n        const eventColors = colors.event || {};\r\n        return Object.entries(eventColors)\r\n            .map(([id, colorInfo]) => `Color ID: ${id} - ${colorInfo.background} (background) / ${colorInfo.foreground} (foreground)`)\r\n            .join(\"\\n\");\r\n    }\r\n}\r\n", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { CreateEventArgumentsSchema } from \"../../schemas/validators.js\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { calendar_v3, google } from 'googleapis';\r\nimport { z } from 'zod';\r\n\r\nexport class CreateEventHandler extends BaseToolHandler {\r\n    async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const validArgs = CreateEventArgumentsSchema.parse(args);\r\n        const event = await this.createEvent(oauth2Client, validArgs);\r\n        return {\r\n            content: [{\r\n                type: \"text\",\r\n                text: `Event created: ${event.summary} (${event.id})`,\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async createEvent(\r\n        client: OAuth2Client,\r\n        args: z.infer<typeof CreateEventArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            const requestBody: calendar_v3.Schema$Event = {\r\n                summary: args.summary,\r\n                description: args.description,\r\n                start: { dateTime: args.start, timeZone: args.timeZone },\r\n                end: { dateTime: args.end, timeZone: args.timeZone },\r\n                attendees: args.attendees,\r\n                location: args.location,\r\n                colorId: args.colorId,\r\n                reminders: args.reminders,\r\n                recurrence: args.recurrence,\r\n            };\r\n            \r\n            // Add Google Meet conference data if provided\r\n            if (args.conferenceData) {\r\n                requestBody.conferenceData = args.conferenceData as calendar_v3.Schema$ConferenceData;\r\n            } else if (args.attendees && args.attendees.length > 0) {\r\n                // Auto-add Google Meet for online meetings with attendees\r\n                // Generate a unique request ID\r\n                const requestId = `meet-${Date.now()}-${Math.random().toString(36).substring(7)}`;\r\n                requestBody.conferenceData = {\r\n                    createRequest: {\r\n                        requestId: requestId,\r\n                        conferenceSolutionKey: {\r\n                            type: 'hangoutsMeet'\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n            \r\n            // Determine if we need conference data version\r\n            const needsConferenceData = args.conferenceData || (args.attendees && args.attendees.length > 0);\r\n            \r\n            // Prepare insert options\r\n            const insertOptions: any = {\r\n                calendarId: args.calendarId,\r\n                requestBody: requestBody,\r\n            };\r\n            \r\n            // Add conference data version if needed\r\n            if (needsConferenceData) {\r\n                insertOptions.conferenceDataVersion = 1;\r\n            }\r\n            \r\n            // Add sendUpdates to send invites to attendees\r\n            if (args.attendees && args.attendees.length > 0) {\r\n                insertOptions.sendUpdates = args.sendUpdates || 'all';\r\n            }\r\n            \r\n            // Try to create the event with built-in retry logic\r\n            const response = await calendar.events.insert(insertOptions);\r\n            \r\n            if (!response.data) throw new Error('Failed to create event, no data returned');\r\n            return response.data;\r\n        } catch (error: any) {\r\n            // If it's a socket error but we get a response, check if event was created\r\n            if (error.code === 'ECONNRESET' || error.code === 'ETIMEDOUT') {\r\n                try {\r\n                    // Wait a bit and then check if the event was created\r\n                    await new Promise(resolve => setTimeout(resolve, 1000));\r\n                    \r\n                    const calendar = this.getCalendar(client);\r\n                    const now = new Date();\r\n                    const events = await calendar.events.list({\r\n                        calendarId: args.calendarId,\r\n                        timeMin: new Date(now.getTime() - 60000).toISOString(), // Last minute\r\n                        singleEvents: true,\r\n                        orderBy: 'startTime',\r\n                        maxResults: 10,\r\n                    });\r\n                    \r\n                    // Look for the event we just tried to create\r\n                    const createdEvent = events.data.items?.find(\r\n                        event => event.summary === args.summary && \r\n                                event.start?.dateTime === args.start &&\r\n                                event.end?.dateTime === args.end\r\n                    );\r\n                    \r\n                    if (createdEvent) {\r\n                        // Event was created despite the error\r\n                        return createdEvent;\r\n                    }\r\n                } catch (checkError) {\r\n                    // If check fails, throw the original error\r\n                }\r\n            }\r\n            \r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { UpdateEventArgumentsSchema } from \"../../schemas/validators.js\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { calendar_v3 } from 'googleapis';\r\nimport { z } from 'zod';\r\nimport { RecurringEventHelpers, RecurringEventError, RECURRING_EVENT_ERRORS } from './RecurringEventHelpers.js';\r\n\r\nexport class UpdateEventHandler extends BaseToolHandler {\r\n    async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const validArgs = UpdateEventArgumentsSchema.parse(args);\r\n        const event = await this.updateEventWithScope(oauth2Client, validArgs);\r\n        return {\r\n            content: [{\r\n                type: \"text\",\r\n                text: `Event updated: ${event.summary} (${event.id})`,\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async updateEventWithScope(\r\n        client: OAuth2Client,\r\n        args: z.infer<typeof UpdateEventArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            const helpers = new RecurringEventHelpers(calendar);\r\n            \r\n            // Detect event type and validate scope usage\r\n            const eventType = await helpers.detectEventType(args.eventId, args.calendarId);\r\n            \r\n            if (args.modificationScope !== 'all' && eventType !== 'recurring') {\r\n                throw new RecurringEventError(\r\n                    'Scope other than \"all\" only applies to recurring events',\r\n                    RECURRING_EVENT_ERRORS.NON_RECURRING_SCOPE\r\n                );\r\n            }\r\n            \r\n            switch (args.modificationScope) {\r\n                case 'single':\r\n                    return this.updateSingleInstance(helpers, args);\r\n                case 'all':\r\n                    return this.updateAllInstances(helpers, args);\r\n                case 'future':\r\n                    return this.updateFutureInstances(helpers, args);\r\n                default:\r\n                    throw new RecurringEventError(\r\n                        `Invalid modification scope: ${args.modificationScope}`,\r\n                        RECURRING_EVENT_ERRORS.INVALID_SCOPE\r\n                    );\r\n            }\r\n        } catch (error) {\r\n            if (error instanceof RecurringEventError) {\r\n                throw error;\r\n            }\r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n\r\n    private async updateSingleInstance(\r\n        helpers: RecurringEventHelpers,\r\n        args: z.infer<typeof UpdateEventArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event> {\r\n        if (!args.originalStartTime) {\r\n            throw new RecurringEventError(\r\n                'originalStartTime is required for single instance updates',\r\n                RECURRING_EVENT_ERRORS.MISSING_ORIGINAL_TIME\r\n            );\r\n        }\r\n\r\n        const calendar = helpers.getCalendar();\r\n        const instanceId = helpers.formatInstanceId(args.eventId, args.originalStartTime);\r\n        \r\n        const response = await calendar.events.patch({\r\n            calendarId: args.calendarId,\r\n            eventId: instanceId,\r\n            requestBody: helpers.buildUpdateRequestBody(args)\r\n        });\r\n\r\n        if (!response.data) throw new Error('Failed to update event instance');\r\n        return response.data;\r\n    }\r\n\r\n    private async updateAllInstances(\r\n        helpers: RecurringEventHelpers,\r\n        args: z.infer<typeof UpdateEventArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event> {\r\n        const calendar = helpers.getCalendar();\r\n        \r\n        const response = await calendar.events.patch({\r\n            calendarId: args.calendarId,\r\n            eventId: args.eventId,\r\n            requestBody: helpers.buildUpdateRequestBody(args)\r\n        });\r\n\r\n        if (!response.data) throw new Error('Failed to update event');\r\n        return response.data;\r\n    }\r\n\r\n    private async updateFutureInstances(\r\n        helpers: RecurringEventHelpers,\r\n        args: z.infer<typeof UpdateEventArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event> {\r\n        if (!args.futureStartDate) {\r\n            throw new RecurringEventError(\r\n                'futureStartDate is required for future instance updates',\r\n                RECURRING_EVENT_ERRORS.MISSING_FUTURE_DATE\r\n            );\r\n        }\r\n\r\n        const calendar = helpers.getCalendar();\r\n\r\n        // 1. Get original event\r\n        const originalResponse = await calendar.events.get({\r\n            calendarId: args.calendarId,\r\n            eventId: args.eventId\r\n        });\r\n        const originalEvent = originalResponse.data;\r\n\r\n        if (!originalEvent.recurrence) {\r\n            throw new Error('Event does not have recurrence rules');\r\n        }\r\n\r\n        // 2. Calculate UNTIL date and update original event\r\n        const untilDate = helpers.calculateUntilDate(args.futureStartDate);\r\n        const updatedRecurrence = helpers.updateRecurrenceWithUntil(originalEvent.recurrence, untilDate);\r\n\r\n        await calendar.events.patch({\r\n            calendarId: args.calendarId,\r\n            eventId: args.eventId,\r\n            requestBody: { recurrence: updatedRecurrence }\r\n        });\r\n\r\n        // 3. Create new recurring event starting from future date\r\n        const requestBody = helpers.buildUpdateRequestBody(args);\r\n        \r\n        // Calculate end time if start time is changing\r\n        let endTime = args.end;\r\n        if (args.start || args.futureStartDate) {\r\n            const newStartTime = args.start || args.futureStartDate;\r\n            endTime = endTime || helpers.calculateEndTime(newStartTime, originalEvent);\r\n        }\r\n\r\n        const newEvent = {\r\n            ...helpers.cleanEventForDuplication(originalEvent),\r\n            ...requestBody,\r\n            start: { \r\n                dateTime: args.start || args.futureStartDate, \r\n                timeZone: args.timeZone \r\n            },\r\n            end: { \r\n                dateTime: endTime, \r\n                timeZone: args.timeZone \r\n            }\r\n        };\r\n\r\n        const response = await calendar.events.insert({\r\n            calendarId: args.calendarId,\r\n            requestBody: newEvent\r\n        });\r\n\r\n        if (!response.data) throw new Error('Failed to create new recurring event');\r\n        return response.data;\r\n    }\r\n\r\n    // Keep the original updateEvent method for backward compatibility\r\n    private async updateEvent(\r\n        client: OAuth2Client,\r\n        args: z.infer<typeof UpdateEventArgumentsSchema>\r\n    ): Promise<calendar_v3.Schema$Event> {\r\n        // This method now just delegates to the enhanced version\r\n        return this.updateEventWithScope(client, args);\r\n    }\r\n}\r\n", "import { calendar_v3 } from 'googleapis';\r\n\r\nexport class RecurringEventHelpers {\r\n  private calendar: calendar_v3.Calendar;\r\n\r\n  constructor(calendar: calendar_v3.Calendar) {\r\n    this.calendar = calendar;\r\n  }\r\n\r\n  /**\r\n   * Get the calendar instance\r\n   */\r\n  getCalendar(): calendar_v3.Calendar {\r\n    return this.calendar;\r\n  }\r\n\r\n  /**\r\n   * Detects if an event is recurring or single\r\n   */\r\n  async detectEventType(eventId: string, calendarId: string): Promise<'recurring' | 'single'> {\r\n    const response = await this.calendar.events.get({\r\n      calendarId,\r\n      eventId\r\n    });\r\n\r\n    const event = response.data;\r\n    return event.recurrence && event.recurrence.length > 0 ? 'recurring' : 'single';\r\n  }\r\n\r\n  /**\r\n   * Formats an instance ID for single instance updates\r\n   */\r\n  formatInstanceId(eventId: string, originalStartTime: string): string {\r\n    // Convert to UTC first, then format to basic format: YYYYMMDDTHHMMSSZ\r\n    const utcDate = new Date(originalStartTime);\r\n    const basicTimeFormat = utcDate.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\r\n    \r\n    return `${eventId}_${basicTimeFormat}`;\r\n  }\r\n\r\n  /**\r\n   * Calculates the UNTIL date for future instance updates\r\n   */\r\n  calculateUntilDate(futureStartDate: string): string {\r\n    const futureDate = new Date(futureStartDate);\r\n    const untilDate = new Date(futureDate.getTime() - 86400000); // -1 day\r\n    return untilDate.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\r\n  }\r\n\r\n  /**\r\n   * Calculates end time based on original duration\r\n   */\r\n  calculateEndTime(newStartTime: string, originalEvent: calendar_v3.Schema$Event): string {\r\n    const newStart = new Date(newStartTime);\r\n    const originalStart = new Date(originalEvent.start!.dateTime!);\r\n    const originalEnd = new Date(originalEvent.end!.dateTime!);\r\n    const duration = originalEnd.getTime() - originalStart.getTime();\r\n    \r\n    return new Date(newStart.getTime() + duration).toISOString();\r\n  }\r\n\r\n  /**\r\n   * Updates recurrence rule with UNTIL clause\r\n   */\r\n  updateRecurrenceWithUntil(recurrence: string[], untilDate: string): string[] {\r\n    if (!recurrence || recurrence.length === 0) {\r\n      throw new Error('No recurrence rule found');\r\n    }\r\n\r\n    const updatedRecurrence: string[] = [];\r\n    let foundRRule = false;\r\n\r\n    for (const rule of recurrence) {\r\n      if (rule.startsWith('RRULE:')) {\r\n        foundRRule = true;\r\n        const updatedRule = rule\r\n          .replace(/;UNTIL=\\d{8}T\\d{6}Z/g, '') // Remove existing UNTIL\r\n          .replace(/;COUNT=\\d+/g, '') // Remove COUNT if present\r\n          + `;UNTIL=${untilDate}`;\r\n        updatedRecurrence.push(updatedRule);\r\n      } else {\r\n        // Preserve EXDATE, RDATE, and other rules as-is\r\n        updatedRecurrence.push(rule);\r\n      }\r\n    }\r\n\r\n    if (!foundRRule) {\r\n      throw new Error('No RRULE found in recurrence rules');\r\n    }\r\n\r\n    return updatedRecurrence;\r\n  }\r\n\r\n  /**\r\n   * Cleans event fields for new event creation\r\n   */\r\n  cleanEventForDuplication(event: calendar_v3.Schema$Event): calendar_v3.Schema$Event {\r\n    const cleanedEvent = { ...event };\r\n    \r\n    // Remove fields that shouldn't be duplicated\r\n    delete cleanedEvent.id;\r\n    delete cleanedEvent.etag;\r\n    delete cleanedEvent.iCalUID;\r\n    delete cleanedEvent.created;\r\n    delete cleanedEvent.updated;\r\n    delete cleanedEvent.htmlLink;\r\n    delete cleanedEvent.hangoutLink;\r\n    \r\n    return cleanedEvent;\r\n  }\r\n\r\n  /**\r\n   * Builds request body for event updates\r\n   */\r\n  buildUpdateRequestBody(args: any): calendar_v3.Schema$Event {\r\n    const requestBody: calendar_v3.Schema$Event = {};\r\n\r\n    if (args.summary !== undefined && args.summary !== null) requestBody.summary = args.summary;\r\n    if (args.description !== undefined && args.description !== null) requestBody.description = args.description;\r\n    if (args.location !== undefined && args.location !== null) requestBody.location = args.location;\r\n    if (args.colorId !== undefined && args.colorId !== null) requestBody.colorId = args.colorId;\r\n    if (args.attendees !== undefined && args.attendees !== null) requestBody.attendees = args.attendees;\r\n    if (args.reminders !== undefined && args.reminders !== null) requestBody.reminders = args.reminders;\r\n    if (args.recurrence !== undefined && args.recurrence !== null) requestBody.recurrence = args.recurrence;\r\n\r\n    // Handle time changes\r\n    let timeChanged = false;\r\n    if (args.start !== undefined && args.start !== null) {\r\n      requestBody.start = { dateTime: args.start, timeZone: args.timeZone };\r\n      timeChanged = true;\r\n    }\r\n    if (args.end !== undefined && args.end !== null) {\r\n      requestBody.end = { dateTime: args.end, timeZone: args.timeZone };\r\n      timeChanged = true;\r\n    }\r\n\r\n    // Only add timezone objects if there were actual time changes, OR if neither start/end provided but timezone is given\r\n    if (timeChanged || (!args.start && !args.end && args.timeZone)) {\r\n      if (!requestBody.start) requestBody.start = {};\r\n      if (!requestBody.end) requestBody.end = {};\r\n      if (!requestBody.start.timeZone) requestBody.start.timeZone = args.timeZone;\r\n      if (!requestBody.end.timeZone) requestBody.end.timeZone = args.timeZone;\r\n    }\r\n\r\n    return requestBody;\r\n  }\r\n}\r\n\r\n/**\r\n * Custom error class for recurring event errors\r\n */\r\nexport class RecurringEventError extends Error {\r\n  public code: string;\r\n\r\n  constructor(message: string, code: string) {\r\n    super(message);\r\n    this.name = 'RecurringEventError';\r\n    this.code = code;\r\n  }\r\n}\r\n\r\nexport const RECURRING_EVENT_ERRORS = {\r\n  INVALID_SCOPE: 'INVALID_MODIFICATION_SCOPE',\r\n  MISSING_ORIGINAL_TIME: 'MISSING_ORIGINAL_START_TIME',\r\n  MISSING_FUTURE_DATE: 'MISSING_FUTURE_START_DATE',\r\n  PAST_FUTURE_DATE: 'FUTURE_DATE_IN_PAST',\r\n  NON_RECURRING_SCOPE: 'SCOPE_NOT_APPLICABLE_TO_SINGLE_EVENT'\r\n}; ", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { DeleteEventArgumentsSchema } from \"../../schemas/validators.js\";\r\nimport { BaseToolHandler } from \"./BaseToolHandler.js\";\r\nimport { z } from 'zod';\r\n\r\nexport class DeleteEventHandler extends BaseToolHandler {\r\n    async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n        const validArgs = DeleteEventArgumentsSchema.parse(args);\r\n        await this.deleteEvent(oauth2Client, validArgs);\r\n        return {\r\n            content: [{\r\n                type: \"text\",\r\n                text: \"Event deleted successfully\",\r\n            }],\r\n        };\r\n    }\r\n\r\n    private async deleteEvent(\r\n        client: OAuth2Client,\r\n        args: z.infer<typeof DeleteEventArgumentsSchema>\r\n    ): Promise<void> {\r\n        try {\r\n            const calendar = this.getCalendar(client);\r\n            await calendar.events.delete({\r\n                calendarId: args.calendarId,\r\n                eventId: args.eventId,\r\n            });\r\n        } catch (error) {\r\n            throw this.handleGoogleApiError(error);\r\n        }\r\n    }\r\n}\r\n", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, people_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface ListContactsArgs {\r\n  pageSize?: number;\r\n  pageToken?: string;\r\n  personFields?: string[];\r\n  sources?: string[];\r\n  query?: string;\r\n}\r\n\r\nexport class ListContactsHandler extends BaseToolHandler {\r\n  async runTool(args: ListContactsArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const people = google.people({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Default person fields if not specified\r\n      const personFields = args.personFields && args.personFields.length > 0 \r\n        ? args.personFields.join(',')\r\n        : 'names,emailAddresses,phoneNumbers,addresses,organizations,biographies,photos';\r\n      \r\n      // Default sources if not specified\r\n      const sources = args.sources && args.sources.length > 0\r\n        ? args.sources\r\n        : ['READ_SOURCE_TYPE_CONTACT'];\r\n      \r\n      const response = await people.people.connections.list({\r\n        resourceName: 'people/me',\r\n        pageSize: args.pageSize || 100,\r\n        pageToken: args.pageToken,\r\n        personFields,\r\n        sources,\r\n        ...(args.query && { query: args.query })\r\n      });\r\n\r\n      const contacts = response.data.connections || [];\r\n      const formattedContacts = contacts.map(contact => this.formatContact(contact));\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              contacts: formattedContacts,\r\n              totalItems: response.data.totalItems || formattedContacts.length,\r\n              nextPageToken: response.data.nextPageToken || null\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatContact(contact: people_v1.Schema$Person): any {\r\n    return {\r\n      resourceName: contact.resourceName,\r\n      etag: contact.etag,\r\n      names: contact.names?.map(name => ({\r\n        displayName: name.displayName,\r\n        familyName: name.familyName,\r\n        givenName: name.givenName,\r\n        middleName: name.middleName,\r\n        honorificPrefix: name.honorificPrefix,\r\n        honorificSuffix: name.honorificSuffix\r\n      })),\r\n      emailAddresses: contact.emailAddresses?.map(email => ({\r\n        value: email.value,\r\n        type: email.type,\r\n        formattedType: email.formattedType\r\n      })),\r\n      phoneNumbers: contact.phoneNumbers?.map(phone => ({\r\n        value: phone.value,\r\n        type: phone.type,\r\n        formattedType: phone.formattedType\r\n      })),\r\n      addresses: contact.addresses?.map(address => ({\r\n        formattedValue: address.formattedValue,\r\n        type: address.type,\r\n        formattedType: address.formattedType,\r\n        streetAddress: address.streetAddress,\r\n        city: address.city,\r\n        region: address.region,\r\n        postalCode: address.postalCode,\r\n        country: address.country,\r\n        countryCode: address.countryCode\r\n      })),\r\n      organizations: contact.organizations?.map(org => ({\r\n        name: org.name,\r\n        title: org.title,\r\n        department: org.department,\r\n        type: org.type,\r\n        formattedType: org.formattedType\r\n      })),\r\n      biographies: contact.biographies?.map(bio => ({\r\n        value: bio.value,\r\n        contentType: bio.contentType\r\n      })),\r\n      photos: contact.photos?.map(photo => ({\r\n        url: photo.url,\r\n        default: photo.default\r\n      }))\r\n    };\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, people_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface GetContactArgs {\r\n  resourceName: string;\r\n  personFields?: string[];\r\n}\r\n\r\nexport class GetContactHandler extends BaseToolHandler {\r\n  async runTool(args: GetContactArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const people = google.people({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Default person fields if not specified\r\n      const personFields = args.personFields && args.personFields.length > 0 \r\n        ? args.personFields.join(',')\r\n        : 'names,emailAddresses,phoneNumbers,addresses,organizations,biographies,photos,birthdays,events,relations,urls,userDefined,memberships,metadata';\r\n      \r\n      const response = await people.people.get({\r\n        resourceName: args.resourceName,\r\n        personFields\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              contact: this.formatContact(response.data)\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatContact(contact: people_v1.Schema$Person): any {\r\n    return {\r\n      resourceName: contact.resourceName,\r\n      etag: contact.etag,\r\n      metadata: contact.metadata,\r\n      names: contact.names?.map(name => ({\r\n        displayName: name.displayName,\r\n        familyName: name.familyName,\r\n        givenName: name.givenName,\r\n        middleName: name.middleName,\r\n        honorificPrefix: name.honorificPrefix,\r\n        honorificSuffix: name.honorificSuffix,\r\n        metadata: name.metadata\r\n      })),\r\n      emailAddresses: contact.emailAddresses?.map(email => ({\r\n        value: email.value,\r\n        type: email.type,\r\n        formattedType: email.formattedType,\r\n        metadata: email.metadata\r\n      })),\r\n      phoneNumbers: contact.phoneNumbers?.map(phone => ({\r\n        value: phone.value,\r\n        type: phone.type,\r\n        formattedType: phone.formattedType,\r\n        canonicalForm: phone.canonicalForm,\r\n        metadata: phone.metadata\r\n      })),\r\n      addresses: contact.addresses?.map(address => ({\r\n        formattedValue: address.formattedValue,\r\n        type: address.type,\r\n        formattedType: address.formattedType,\r\n        streetAddress: address.streetAddress,\r\n        extendedAddress: address.extendedAddress,\r\n        poBox: address.poBox,\r\n        city: address.city,\r\n        region: address.region,\r\n        postalCode: address.postalCode,\r\n        country: address.country,\r\n        countryCode: address.countryCode,\r\n        metadata: address.metadata\r\n      })),\r\n      organizations: contact.organizations?.map(org => ({\r\n        name: org.name,\r\n        phoneticName: org.phoneticName,\r\n        title: org.title,\r\n        department: org.department,\r\n        symbol: org.symbol,\r\n        location: org.location,\r\n        type: org.type,\r\n        formattedType: org.formattedType,\r\n        startDate: org.startDate,\r\n        endDate: org.endDate,\r\n        current: org.current,\r\n        metadata: org.metadata\r\n      })),\r\n      biographies: contact.biographies?.map(bio => ({\r\n        value: bio.value,\r\n        contentType: bio.contentType,\r\n        metadata: bio.metadata\r\n      })),\r\n      birthdays: contact.birthdays?.map(birthday => ({\r\n        date: birthday.date,\r\n        text: birthday.text,\r\n        metadata: birthday.metadata\r\n      })),\r\n      events: contact.events?.map(event => ({\r\n        date: event.date,\r\n        type: event.type,\r\n        formattedType: event.formattedType,\r\n        metadata: event.metadata\r\n      })),\r\n      relations: contact.relations?.map(relation => ({\r\n        person: relation.person,\r\n        type: relation.type,\r\n        formattedType: relation.formattedType,\r\n        metadata: relation.metadata\r\n      })),\r\n      urls: contact.urls?.map(url => ({\r\n        value: url.value,\r\n        type: url.type,\r\n        formattedType: url.formattedType,\r\n        metadata: url.metadata\r\n      })),\r\n      memberships: contact.memberships?.map(membership => ({\r\n        contactGroupMembership: membership.contactGroupMembership,\r\n        domainMembership: membership.domainMembership,\r\n        metadata: membership.metadata\r\n      })),\r\n      photos: contact.photos?.map(photo => ({\r\n        url: photo.url,\r\n        default: photo.default,\r\n        metadata: photo.metadata\r\n      }))\r\n    };\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, people_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface CreateContactArgs {\r\n  givenName?: string;\r\n  familyName?: string;\r\n  middleName?: string;\r\n  displayName?: string;\r\n  emailAddresses?: Array<{\r\n    value: string;\r\n    type?: string;\r\n  }>;\r\n  phoneNumbers?: Array<{\r\n    value: string;\r\n    type?: string;\r\n  }>;\r\n  addresses?: Array<{\r\n    streetAddress?: string;\r\n    city?: string;\r\n    region?: string;\r\n    postalCode?: string;\r\n    country?: string;\r\n    type?: string;\r\n  }>;\r\n  organizations?: Array<{\r\n    name?: string;\r\n    title?: string;\r\n    department?: string;\r\n    type?: string;\r\n  }>;\r\n  biographies?: Array<{\r\n    value: string;\r\n    contentType?: string;\r\n  }>;\r\n  notes?: string;\r\n}\r\n\r\nexport class CreateContactHandler extends BaseToolHandler {\r\n  async runTool(args: CreateContactArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const people = google.people({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Build the person object\r\n      const person: people_v1.Schema$Person = {};\r\n      \r\n      // Names\r\n      if (args.givenName || args.familyName || args.middleName || args.displayName) {\r\n        person.names = [{\r\n          givenName: args.givenName,\r\n          familyName: args.familyName,\r\n          middleName: args.middleName,\r\n          displayName: args.displayName || `${args.givenName || ''} ${args.familyName || ''}`.trim()\r\n        }];\r\n      }\r\n      \r\n      // Email addresses\r\n      if (args.emailAddresses && args.emailAddresses.length > 0) {\r\n        person.emailAddresses = args.emailAddresses.map(email => ({\r\n          value: email.value,\r\n          type: email.type || 'home'\r\n        }));\r\n      }\r\n      \r\n      // Phone numbers\r\n      if (args.phoneNumbers && args.phoneNumbers.length > 0) {\r\n        person.phoneNumbers = args.phoneNumbers.map(phone => ({\r\n          value: phone.value,\r\n          type: phone.type || 'home'\r\n        }));\r\n      }\r\n      \r\n      // Addresses\r\n      if (args.addresses && args.addresses.length > 0) {\r\n        person.addresses = args.addresses.map(address => ({\r\n          streetAddress: address.streetAddress,\r\n          city: address.city,\r\n          region: address.region,\r\n          postalCode: address.postalCode,\r\n          country: address.country,\r\n          type: address.type || 'home'\r\n        }));\r\n      }\r\n      \r\n      // Organizations\r\n      if (args.organizations && args.organizations.length > 0) {\r\n        person.organizations = args.organizations.map(org => ({\r\n          name: org.name,\r\n          title: org.title,\r\n          department: org.department,\r\n          type: org.type || 'work'\r\n        }));\r\n      }\r\n      \r\n      // Biographies\r\n      if (args.biographies && args.biographies.length > 0) {\r\n        person.biographies = args.biographies;\r\n      } else if (args.notes) {\r\n        // Use notes as a biography if no biographies provided\r\n        person.biographies = [{\r\n          value: args.notes,\r\n          contentType: 'TEXT_PLAIN'\r\n        }];\r\n      }\r\n      \r\n      const response = await people.people.createContact({\r\n        requestBody: person,\r\n        personFields: 'names,emailAddresses,phoneNumbers,addresses,organizations,biographies'\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              contact: {\r\n                resourceName: response.data.resourceName,\r\n                etag: response.data.etag,\r\n                ...this.formatContactResponse(response.data)\r\n              }\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatContactResponse(contact: people_v1.Schema$Person): any {\r\n    return {\r\n      names: contact.names,\r\n      emailAddresses: contact.emailAddresses,\r\n      phoneNumbers: contact.phoneNumbers,\r\n      addresses: contact.addresses,\r\n      organizations: contact.organizations,\r\n      biographies: contact.biographies\r\n    };\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, people_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface UpdateContactArgs {\r\n  resourceName: string;\r\n  updatePersonFields: string[];\r\n  givenName?: string;\r\n  familyName?: string;\r\n  middleName?: string;\r\n  displayName?: string;\r\n  emailAddresses?: Array<{\r\n    value: string;\r\n    type?: string;\r\n  }>;\r\n  phoneNumbers?: Array<{\r\n    value: string;\r\n    type?: string;\r\n  }>;\r\n  addresses?: Array<{\r\n    streetAddress?: string;\r\n    city?: string;\r\n    region?: string;\r\n    postalCode?: string;\r\n    country?: string;\r\n    type?: string;\r\n  }>;\r\n  organizations?: Array<{\r\n    name?: string;\r\n    title?: string;\r\n    department?: string;\r\n    type?: string;\r\n  }>;\r\n  biographies?: Array<{\r\n    value: string;\r\n    contentType?: string;\r\n  }>;\r\n}\r\n\r\nexport class UpdateContactHandler extends BaseToolHandler {\r\n  async runTool(args: UpdateContactArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const people = google.people({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // First, get the existing contact to get the etag\r\n      const existingContact = await people.people.get({\r\n        resourceName: args.resourceName,\r\n        personFields: 'names'\r\n      });\r\n      \r\n      // Build the person object with updates\r\n      const person: people_v1.Schema$Person = {\r\n        etag: existingContact.data.etag,\r\n        resourceName: args.resourceName\r\n      };\r\n      \r\n      // Names\r\n      if (args.updatePersonFields.includes('names')) {\r\n        person.names = [{\r\n          givenName: args.givenName,\r\n          familyName: args.familyName,\r\n          middleName: args.middleName,\r\n          displayName: args.displayName || `${args.givenName || ''} ${args.familyName || ''}`.trim()\r\n        }];\r\n      }\r\n      \r\n      // Email addresses\r\n      if (args.updatePersonFields.includes('emailAddresses') && args.emailAddresses) {\r\n        person.emailAddresses = args.emailAddresses.map(email => ({\r\n          value: email.value,\r\n          type: email.type || 'home'\r\n        }));\r\n      }\r\n      \r\n      // Phone numbers\r\n      if (args.updatePersonFields.includes('phoneNumbers') && args.phoneNumbers) {\r\n        person.phoneNumbers = args.phoneNumbers.map(phone => ({\r\n          value: phone.value,\r\n          type: phone.type || 'home'\r\n        }));\r\n      }\r\n      \r\n      // Addresses\r\n      if (args.updatePersonFields.includes('addresses') && args.addresses) {\r\n        person.addresses = args.addresses.map(address => ({\r\n          streetAddress: address.streetAddress,\r\n          city: address.city,\r\n          region: address.region,\r\n          postalCode: address.postalCode,\r\n          country: address.country,\r\n          type: address.type || 'home'\r\n        }));\r\n      }\r\n      \r\n      // Organizations\r\n      if (args.updatePersonFields.includes('organizations') && args.organizations) {\r\n        person.organizations = args.organizations.map(org => ({\r\n          name: org.name,\r\n          title: org.title,\r\n          department: org.department,\r\n          type: org.type || 'work'\r\n        }));\r\n      }\r\n      \r\n      // Biographies\r\n      if (args.updatePersonFields.includes('biographies') && args.biographies) {\r\n        person.biographies = args.biographies;\r\n      }\r\n      \r\n      const response = await people.people.updateContact({\r\n        resourceName: args.resourceName,\r\n        updatePersonFields: args.updatePersonFields.join(','),\r\n        requestBody: person,\r\n        personFields: 'names,emailAddresses,phoneNumbers,addresses,organizations,biographies'\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              contact: {\r\n                resourceName: response.data.resourceName,\r\n                etag: response.data.etag,\r\n                ...this.formatContactResponse(response.data)\r\n              }\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatContactResponse(contact: people_v1.Schema$Person): any {\r\n    return {\r\n      names: contact.names,\r\n      emailAddresses: contact.emailAddresses,\r\n      phoneNumbers: contact.phoneNumbers,\r\n      addresses: contact.addresses,\r\n      organizations: contact.organizations,\r\n      biographies: contact.biographies\r\n    };\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface DeleteContactArgs {\r\n  resourceName: string;\r\n}\r\n\r\nexport class DeleteContactHandler extends BaseToolHandler {\r\n  async runTool(args: DeleteContactArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const people = google.people({ version: 'v1', auth: oauth2Client });\r\n      \r\n      await people.people.deleteContact({\r\n        resourceName: args.resourceName\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              message: `Contact ${args.resourceName} deleted successfully`\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface ListEmailsArgs {\r\n  query?: string;\r\n  maxResults?: number;\r\n  pageToken?: string;\r\n  includeSpamTrash?: boolean;\r\n  labelIds?: string[];\r\n}\r\n\r\nexport class ListEmailsHandler extends BaseToolHandler {\r\n  async runTool(args: ListEmailsArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Build the request parameters\r\n      const params: gmail_v1.Params$Resource$Users$Messages$List = {\r\n        userId: 'me',\r\n        maxResults: args.maxResults || 20,\r\n        includeSpamTrash: args.includeSpamTrash || false,\r\n      };\r\n      \r\n      // Add optional parameters\r\n      if (args.query) {\r\n        params.q = args.query;\r\n      }\r\n      \r\n      if (args.pageToken) {\r\n        params.pageToken = args.pageToken;\r\n      }\r\n      \r\n      if (args.labelIds && args.labelIds.length > 0) {\r\n        params.labelIds = args.labelIds;\r\n      }\r\n      \r\n      // List messages\r\n      const response = await gmail.users.messages.list(params);\r\n      \r\n      const messages = response.data.messages || [];\r\n      \r\n      // Fetch basic info for each message\r\n      const messageDetails = await Promise.all(\r\n        messages.slice(0, 10).map(async (message) => {\r\n          try {\r\n            const details = await gmail.users.messages.get({\r\n              userId: 'me',\r\n              id: message.id!,\r\n              format: 'metadata',\r\n              metadataHeaders: ['From', 'To', 'Subject', 'Date']\r\n            });\r\n            \r\n            return this.formatMessageMetadata(details.data);\r\n          } catch (error) {\r\n            console.error(`Error fetching message ${message.id}:`, error);\r\n            return { id: message.id, error: 'Failed to fetch details' };\r\n          }\r\n        })\r\n      );\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              messages: messageDetails,\r\n              resultSizeEstimate: response.data.resultSizeEstimate,\r\n              nextPageToken: response.data.nextPageToken || null,\r\n              totalMessages: messages.length\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatMessageMetadata(message: gmail_v1.Schema$Message): any {\r\n    const headers = message.payload?.headers || [];\r\n    const getHeader = (name: string) => headers.find(h => h.name === name)?.value || '';\r\n    \r\n    return {\r\n      id: message.id,\r\n      threadId: message.threadId,\r\n      subject: getHeader('Subject'),\r\n      from: getHeader('From'),\r\n      to: getHeader('To'),\r\n      date: getHeader('Date'),\r\n      snippet: message.snippet,\r\n      labelIds: message.labelIds || [],\r\n      isUnread: message.labelIds?.includes('UNREAD') || false,\r\n      isImportant: message.labelIds?.includes('IMPORTANT') || false,\r\n      isStarred: message.labelIds?.includes('STARRED') || false,\r\n      hasAttachments: this.hasAttachments(message.payload)\r\n    };\r\n  }\r\n  \r\n  private hasAttachments(payload?: gmail_v1.Schema$MessagePart): boolean {\r\n    if (!payload) return false;\r\n    \r\n    // Check if this part is an attachment\r\n    if (payload.filename && payload.filename.length > 0) {\r\n      return true;\r\n    }\r\n    \r\n    // Recursively check parts\r\n    if (payload.parts) {\r\n      return payload.parts.some(part => this.hasAttachments(part));\r\n    }\r\n    \r\n    return false;\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface GetEmailArgs {\r\n  messageId: string;\r\n  markAsRead?: boolean;\r\n  format?: 'full' | 'metadata' | 'minimal';\r\n}\r\n\r\nexport class GetEmailHandler extends BaseToolHandler {\r\n  async runTool(args: GetEmailArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Get the message\r\n      const response = await gmail.users.messages.get({\r\n        userId: 'me',\r\n        id: args.messageId,\r\n        format: args.format || 'full'\r\n      });\r\n      \r\n      const message = response.data;\r\n      \r\n      // Mark as read if requested (default true unless explicitly false)\r\n      if (args.markAsRead !== false && message.labelIds?.includes('UNREAD')) {\r\n        await gmail.users.messages.modify({\r\n          userId: 'me',\r\n          id: args.messageId,\r\n          requestBody: {\r\n            removeLabelIds: ['UNREAD']\r\n          }\r\n        });\r\n      }\r\n      \r\n      // Format the message based on format type\r\n      const formattedMessage = args.format === 'metadata' \r\n        ? this.formatMessageMetadata(message)\r\n        : this.formatFullMessage(message);\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify(formattedMessage, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatMessageMetadata(message: gmail_v1.Schema$Message): any {\r\n    const headers = message.payload?.headers || [];\r\n    const getHeader = (name: string) => headers.find(h => h.name === name)?.value || '';\r\n    \r\n    return {\r\n      id: message.id,\r\n      threadId: message.threadId,\r\n      subject: getHeader('Subject'),\r\n      from: getHeader('From'),\r\n      to: getHeader('To'),\r\n      cc: getHeader('Cc'),\r\n      bcc: getHeader('Bcc'),\r\n      date: getHeader('Date'),\r\n      snippet: message.snippet,\r\n      labelIds: message.labelIds || [],\r\n      sizeEstimate: message.sizeEstimate,\r\n      historyId: message.historyId\r\n    };\r\n  }\r\n\r\n  private formatFullMessage(message: gmail_v1.Schema$Message): any {\r\n    const headers = message.payload?.headers || [];\r\n    const getHeader = (name: string) => headers.find(h => h.name === name)?.value || '';\r\n    \r\n    return {\r\n      id: message.id,\r\n      threadId: message.threadId,\r\n      labelIds: message.labelIds || [],\r\n      snippet: message.snippet,\r\n      historyId: message.historyId,\r\n      internalDate: message.internalDate,\r\n      sizeEstimate: message.sizeEstimate,\r\n      headers: {\r\n        subject: getHeader('Subject'),\r\n        from: getHeader('From'),\r\n        to: getHeader('To'),\r\n        cc: getHeader('Cc'),\r\n        bcc: getHeader('Bcc'),\r\n        date: getHeader('Date'),\r\n        messageId: getHeader('Message-ID'),\r\n        inReplyTo: getHeader('In-Reply-To'),\r\n        references: getHeader('References')\r\n      },\r\n      body: this.extractBody(message.payload),\r\n      attachments: this.extractAttachments(message.payload),\r\n      isUnread: message.labelIds?.includes('UNREAD') || false,\r\n      isImportant: message.labelIds?.includes('IMPORTANT') || false,\r\n      isStarred: message.labelIds?.includes('STARRED') || false,\r\n      isDraft: message.labelIds?.includes('DRAFT') || false\r\n    };\r\n  }\r\n\r\n  private extractBody(payload?: gmail_v1.Schema$MessagePart): { text?: string; html?: string } {\r\n    if (!payload) return {};\r\n    \r\n    const result: { text?: string; html?: string } = {};\r\n    \r\n    // Direct body\r\n    if (payload.body?.data) {\r\n      const decoded = Buffer.from(payload.body.data, 'base64').toString('utf-8');\r\n      if (payload.mimeType === 'text/plain') {\r\n        result.text = decoded;\r\n      } else if (payload.mimeType === 'text/html') {\r\n        result.html = decoded;\r\n      }\r\n    }\r\n    \r\n    // Process parts\r\n    if (payload.parts) {\r\n      for (const part of payload.parts) {\r\n        if (part.mimeType === 'text/plain' && part.body?.data) {\r\n          result.text = Buffer.from(part.body.data, 'base64').toString('utf-8');\r\n        } else if (part.mimeType === 'text/html' && part.body?.data) {\r\n          result.html = Buffer.from(part.body.data, 'base64').toString('utf-8');\r\n        } else if (part.mimeType?.startsWith('multipart/')) {\r\n          // Recursively process multipart\r\n          const nestedBody = this.extractBody(part);\r\n          if (nestedBody.text) result.text = nestedBody.text;\r\n          if (nestedBody.html) result.html = nestedBody.html;\r\n        }\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }\r\n\r\n  private extractAttachments(payload?: gmail_v1.Schema$MessagePart): any[] {\r\n    if (!payload) return [];\r\n    \r\n    const attachments: any[] = [];\r\n    \r\n    const processPartForAttachments = (part: gmail_v1.Schema$MessagePart) => {\r\n      if (part.filename && part.filename.length > 0) {\r\n        attachments.push({\r\n          filename: part.filename,\r\n          mimeType: part.mimeType,\r\n          size: part.body?.size || 0,\r\n          attachmentId: part.body?.attachmentId\r\n        });\r\n      }\r\n      \r\n      if (part.parts) {\r\n        part.parts.forEach(processPartForAttachments);\r\n      }\r\n    };\r\n    \r\n    processPartForAttachments(payload);\r\n    return attachments;\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface SendEmailArgs {\r\n  to: string | string[];\r\n  subject: string;\r\n  body: string;\r\n  cc?: string | string[];\r\n  bcc?: string | string[];\r\n  isHtml?: boolean;\r\n  replyToMessageId?: string;\r\n  threadId?: string;\r\n}\r\n\r\nexport class SendEmailHandler extends BaseToolHandler {\r\n  async runTool(args: SendEmailArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Get user's email address\r\n      const profile = await gmail.users.getProfile({ userId: 'me' });\r\n      const userEmail = profile.data.emailAddress;\r\n      \r\n      // Create the email message\r\n      const message = this.createMessage(\r\n        userEmail!,\r\n        args.to,\r\n        args.subject,\r\n        args.body,\r\n        args.cc,\r\n        args.bcc,\r\n        args.isHtml || false,\r\n        args.replyToMessageId\r\n      );\r\n      \r\n      // Create the request body\r\n      const requestBody: gmail_v1.Schema$Message = {\r\n        raw: message\r\n      };\r\n      \r\n      // If replying to a thread, include the threadId\r\n      if (args.threadId) {\r\n        requestBody.threadId = args.threadId;\r\n      }\r\n      \r\n      // Send the message\r\n      const response = await gmail.users.messages.send({\r\n        userId: 'me',\r\n        requestBody\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              messageId: response.data.id,\r\n              threadId: response.data.threadId,\r\n              labelIds: response.data.labelIds\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private createMessage(\r\n    from: string,\r\n    to: string | string[],\r\n    subject: string,\r\n    body: string,\r\n    cc?: string | string[],\r\n    bcc?: string | string[],\r\n    isHtml: boolean = false,\r\n    replyToMessageId?: string\r\n  ): string {\r\n    const boundary = \"boundary_\" + Date.now();\r\n    const toAddresses = Array.isArray(to) ? to.join(', ') : to;\r\n    \r\n    let messageParts = [\r\n      `From: ${from}`,\r\n      `To: ${toAddresses}`,\r\n      `Subject: ${subject}`,\r\n      'MIME-Version: 1.0'\r\n    ];\r\n    \r\n    // Add CC if provided\r\n    if (cc) {\r\n      const ccAddresses = Array.isArray(cc) ? cc.join(', ') : cc;\r\n      messageParts.push(`Cc: ${ccAddresses}`);\r\n    }\r\n    \r\n    // Add BCC if provided\r\n    if (bcc) {\r\n      const bccAddresses = Array.isArray(bcc) ? bcc.join(', ') : bcc;\r\n      messageParts.push(`Bcc: ${bccAddresses}`);\r\n    }\r\n    \r\n    // Add In-Reply-To header if replying\r\n    if (replyToMessageId) {\r\n      messageParts.push(`In-Reply-To: ${replyToMessageId}`);\r\n      messageParts.push(`References: ${replyToMessageId}`);\r\n    }\r\n    \r\n    // Set content type\r\n    if (isHtml) {\r\n      messageParts.push(`Content-Type: multipart/alternative; boundary=\"${boundary}\"`);\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}`);\r\n      messageParts.push('Content-Type: text/plain; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(this.htmlToText(body));\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}`);\r\n      messageParts.push('Content-Type: text/html; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(body);\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}--`);\r\n    } else {\r\n      messageParts.push('Content-Type: text/plain; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(body);\r\n    }\r\n    \r\n    const message = messageParts.join('\\r\\n');\r\n    \r\n    // Encode in base64\r\n    const encodedMessage = Buffer.from(message)\r\n      .toString('base64')\r\n      .replace(/\\+/g, '-')\r\n      .replace(/\\//g, '_')\r\n      .replace(/=+$/, '');\r\n    \r\n    return encodedMessage;\r\n  }\r\n  \r\n  private htmlToText(html: string): string {\r\n    // Simple HTML to text conversion\r\n    return html\r\n      .replace(/<br\\s*\\/?>/gi, '\\n')\r\n      .replace(/<\\/p>/gi, '\\n\\n')\r\n      .replace(/<[^>]+>/g, '')\r\n      .replace(/&nbsp;/g, ' ')\r\n      .replace(/&amp;/g, '&')\r\n      .replace(/&lt;/g, '<')\r\n      .replace(/&gt;/g, '>')\r\n      .replace(/&quot;/g, '\"')\r\n      .replace(/&#39;/g, \"'\")\r\n      .trim();\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\nimport { LabelMutationBuilder, LabelMutationFlags } from \"./utils/labelMutationBuilder.js\";\r\n\r\ninterface UpdateEmailArgs extends LabelMutationFlags {\r\n  messageId: string;\r\n  moveToTrash?: boolean;\r\n  removeFromTrash?: boolean;\r\n}\r\n\r\nexport class UpdateEmailHandler extends BaseToolHandler {\r\n  async runTool(args: UpdateEmailArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Handle trash operations separately\r\n      if (args.moveToTrash) {\r\n        await gmail.users.messages.trash({\r\n          userId: 'me',\r\n          id: args.messageId\r\n        });\r\n        \r\n        return {\r\n          content: [\r\n            {\r\n              type: \"text\",\r\n              text: JSON.stringify({\r\n                success: true,\r\n                messageId: args.messageId,\r\n                action: 'moved_to_trash'\r\n              }, null, 2)\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      \r\n      if (args.removeFromTrash) {\r\n        await gmail.users.messages.untrash({\r\n          userId: 'me',\r\n          id: args.messageId\r\n        });\r\n        \r\n        return {\r\n          content: [\r\n            {\r\n              type: \"text\",\r\n              text: JSON.stringify({\r\n                success: true,\r\n                messageId: args.messageId,\r\n                action: 'removed_from_trash'\r\n              }, null, 2)\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      \r\n      // Build label mutations with validation\r\n      const mutation = LabelMutationBuilder.build(args);\r\n      \r\n      // Check if there are any changes to make\r\n      if (mutation.addLabelIds.length === 0 && mutation.removeLabelIds.length === 0) {\r\n        return {\r\n          content: [\r\n            {\r\n              type: \"text\",\r\n              text: JSON.stringify({\r\n                success: true,\r\n                messageId: args.messageId,\r\n                message: 'No changes were made'\r\n              }, null, 2)\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      \r\n      // Check if message can be modified (TRASH/SPAM restrictions)\r\n      const preCheck = await gmail.users.messages.get({\r\n        userId: 'me',\r\n        id: args.messageId,\r\n        format: 'minimal'\r\n      });\r\n      \r\n      const currentLabels = preCheck.data.labelIds || [];\r\n      \r\n      if (!LabelMutationBuilder.canModifyLabels(currentLabels, mutation)) {\r\n        return {\r\n          content: [\r\n            {\r\n              type: \"text\",\r\n              text: JSON.stringify({\r\n                success: false,\r\n                messageId: args.messageId,\r\n                error: 'Cannot modify labels on messages in TRASH or SPAM folders',\r\n                currentLabels: currentLabels\r\n              }, null, 2)\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      \r\n      console.log('UpdateEmail - Calling modify with:', {\r\n        messageId: args.messageId,\r\n        addLabelIds: mutation.addLabelIds,\r\n        removeLabelIds: mutation.removeLabelIds\r\n      });\r\n      \r\n      const response = await gmail.users.messages.modify({\r\n        userId: 'me',\r\n        id: args.messageId,\r\n        requestBody: {\r\n          addLabelIds: mutation.addLabelIds,\r\n          removeLabelIds: mutation.removeLabelIds\r\n        }\r\n      });\r\n      \r\n      console.log('UpdateEmail - API response:', response.status, response.statusText);\r\n      \r\n      // Verify the change took effect\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n      \r\n      const postCheck = await gmail.users.messages.get({\r\n        userId: 'me',\r\n        id: args.messageId,\r\n        format: 'minimal'\r\n      });\r\n      \r\n      const finalLabels = postCheck.data.labelIds || [];\r\n      \r\n      // Verify changes were applied\r\n      const expectedAdded = mutation.addLabelIds.every(label => \r\n        finalLabels.includes(label)\r\n      );\r\n      const expectedRemoved = mutation.removeLabelIds.every(label => \r\n        !finalLabels.includes(label)\r\n      );\r\n      \r\n      const verified = expectedAdded && expectedRemoved;\r\n      \r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: verified,\r\n              messageId: response.data.id,\r\n              threadId: response.data.threadId,\r\n              labelIds: finalLabels,\r\n              addedLabels: mutation.addLabelIds,\r\n              removedLabels: mutation.removeLabelIds,\r\n              verified: verified,\r\n              warning: verified ? undefined : 'Changes may not have been fully applied'\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error: any) {\r\n      console.error('UpdateEmail - Error details:', {\r\n        message: error.message,\r\n        code: error.code,\r\n        errors: error.errors,\r\n        response: error.response?.data\r\n      });\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "/**\r\n * Shared utility for building label mutations from convenience flags\r\n */\r\n\r\nexport interface LabelMutationFlags {\r\n  addLabelIds?: string[];\r\n  removeLabelIds?: string[];\r\n  markAsRead?: boolean;\r\n  markAsUnread?: boolean;\r\n  star?: boolean;\r\n  unstar?: boolean;\r\n  markAsImportant?: boolean;\r\n  markAsNotImportant?: boolean;\r\n  archive?: boolean;\r\n  unarchive?: boolean;\r\n}\r\n\r\nexport interface LabelMutation {\r\n  addLabelIds: string[];\r\n  removeLabelIds: string[];\r\n}\r\n\r\nexport class LabelMutationBuilder {\r\n  /**\r\n   * Validates mutually exclusive flags\r\n   */\r\n  static validate(flags: LabelMutationFlags): void {\r\n    const conflicts: Array<[string, string]> = [\r\n      ['markAsRead', 'markAsUnread'],\r\n      ['star', 'unstar'],\r\n      ['markAsImportant', 'markAsNotImportant'],\r\n      ['archive', 'unarchive']\r\n    ];\r\n\r\n    for (const [flag1, flag2] of conflicts) {\r\n      if (flags[flag1 as keyof LabelMutationFlags] && flags[flag2 as keyof LabelMutationFlags]) {\r\n        throw new Error(`Conflicting flags: cannot set both ${flag1} and ${flag2}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Builds label mutations from convenience flags\r\n   */\r\n  static build(flags: LabelMutationFlags): LabelMutation {\r\n    // Validate first\r\n    this.validate(flags);\r\n\r\n    const addLabelIds: string[] = [...(flags.addLabelIds || [])];\r\n    const removeLabelIds: string[] = [...(flags.removeLabelIds || [])];\r\n\r\n    // Handle convenience flags\r\n    if (flags.markAsRead) {\r\n      removeLabelIds.push('UNREAD');\r\n    }\r\n    if (flags.markAsUnread) {\r\n      addLabelIds.push('UNREAD');\r\n    }\r\n    if (flags.star) {\r\n      addLabelIds.push('STARRED');\r\n    }\r\n    if (flags.unstar) {\r\n      removeLabelIds.push('STARRED');\r\n    }\r\n    if (flags.markAsImportant) {\r\n      addLabelIds.push('IMPORTANT');\r\n    }\r\n    if (flags.markAsNotImportant) {\r\n      removeLabelIds.push('IMPORTANT');\r\n    }\r\n    if (flags.archive) {\r\n      removeLabelIds.push('INBOX');\r\n    }\r\n    if (flags.unarchive) {\r\n      addLabelIds.push('INBOX');\r\n    }\r\n\r\n    // Remove duplicates\r\n    const uniqueAddLabelIds = [...new Set(addLabelIds)];\r\n    const uniqueRemoveLabelIds = [...new Set(removeLabelIds)];\r\n\r\n    // Remove any labels that appear in both lists\r\n    const finalAddLabelIds = uniqueAddLabelIds.filter(id => !uniqueRemoveLabelIds.includes(id));\r\n    const finalRemoveLabelIds = uniqueRemoveLabelIds.filter(id => !uniqueAddLabelIds.includes(id));\r\n\r\n    return {\r\n      addLabelIds: finalAddLabelIds,\r\n      removeLabelIds: finalRemoveLabelIds\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Checks if a message can have its labels modified based on its current labels\r\n   * Gmail blocks most label operations on TRASH/SPAM messages\r\n   */\r\n  static canModifyLabels(currentLabels: string[], mutation: LabelMutation): boolean {\r\n    const isInTrash = currentLabels.includes('TRASH');\r\n    const isInSpam = currentLabels.includes('SPAM');\r\n    \r\n    // If in TRASH or SPAM, only untrash/unspam operations are allowed\r\n    if (isInTrash || isInSpam) {\r\n      // Check if trying to remove TRASH or SPAM (untrash/unspam)\r\n      const removingTrash = mutation.removeLabelIds.includes('TRASH');\r\n      const removingSpam = mutation.removeLabelIds.includes('SPAM');\r\n      \r\n      // If only removing TRASH/SPAM, that's allowed\r\n      if (removingTrash || removingSpam) {\r\n        return true;\r\n      }\r\n      \r\n      // Any other label operation on TRASH/SPAM is blocked\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface DeleteEmailArgs {\r\n  messageId: string;\r\n  permanent?: boolean;\r\n}\r\n\r\nexport class DeleteEmailHandler extends BaseToolHandler {\r\n  async runTool(args: DeleteEmailArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      if (args.permanent) {\r\n        // Permanently delete the message\r\n        await gmail.users.messages.delete({\r\n          userId: 'me',\r\n          id: args.messageId\r\n        });\r\n        \r\n        return {\r\n          content: [\r\n            {\r\n              type: \"text\",\r\n              text: JSON.stringify({\r\n                success: true,\r\n                messageId: args.messageId,\r\n                action: 'permanently_deleted',\r\n                warning: 'This action cannot be undone'\r\n              }, null, 2)\r\n            }\r\n          ]\r\n        };\r\n      } else {\r\n        // Move to trash (default behavior)\r\n        await gmail.users.messages.trash({\r\n          userId: 'me',\r\n          id: args.messageId\r\n        });\r\n        \r\n        return {\r\n          content: [\r\n            {\r\n              type: \"text\",\r\n              text: JSON.stringify({\r\n                success: true,\r\n                messageId: args.messageId,\r\n                action: 'moved_to_trash',\r\n                note: 'Email moved to trash. Use permanent=true to permanently delete.'\r\n              }, null, 2)\r\n            }\r\n          ]\r\n        };\r\n      }\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface CreateDraftArgs {\r\n  to: string | string[];\r\n  subject: string;\r\n  body: string;\r\n  cc?: string | string[];\r\n  bcc?: string | string[];\r\n  isHtml?: boolean;\r\n  replyToMessageId?: string;\r\n  threadId?: string;\r\n}\r\n\r\nexport class CreateDraftHandler extends BaseToolHandler {\r\n  async runTool(args: CreateDraftArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Get user's email address\r\n      const profile = await gmail.users.getProfile({ userId: 'me' });\r\n      const userEmail = profile.data.emailAddress;\r\n      \r\n      // Create the email message\r\n      const message = this.createMessage(\r\n        userEmail!,\r\n        args.to,\r\n        args.subject,\r\n        args.body,\r\n        args.cc,\r\n        args.bcc,\r\n        args.isHtml || false,\r\n        args.replyToMessageId\r\n      );\r\n      \r\n      // Create the draft\r\n      const requestBody: gmail_v1.Schema$Draft = {\r\n        message: {\r\n          raw: message,\r\n          threadId: args.threadId\r\n        }\r\n      };\r\n      \r\n      const response = await gmail.users.drafts.create({\r\n        userId: 'me',\r\n        requestBody\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              draftId: response.data.id,\r\n              messageId: response.data.message?.id,\r\n              threadId: response.data.message?.threadId\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private createMessage(\r\n    from: string,\r\n    to: string | string[],\r\n    subject: string,\r\n    body: string,\r\n    cc?: string | string[],\r\n    bcc?: string | string[],\r\n    isHtml: boolean = false,\r\n    replyToMessageId?: string\r\n  ): string {\r\n    const boundary = \"boundary_\" + Date.now();\r\n    const toAddresses = Array.isArray(to) ? to.join(', ') : to;\r\n    \r\n    let messageParts = [\r\n      `From: ${from}`,\r\n      `To: ${toAddresses}`,\r\n      `Subject: ${subject}`,\r\n      'MIME-Version: 1.0'\r\n    ];\r\n    \r\n    // Add CC if provided\r\n    if (cc) {\r\n      const ccAddresses = Array.isArray(cc) ? cc.join(', ') : cc;\r\n      messageParts.push(`Cc: ${ccAddresses}`);\r\n    }\r\n    \r\n    // Add BCC if provided\r\n    if (bcc) {\r\n      const bccAddresses = Array.isArray(bcc) ? bcc.join(', ') : bcc;\r\n      messageParts.push(`Bcc: ${bccAddresses}`);\r\n    }\r\n    \r\n    // Add In-Reply-To header if replying\r\n    if (replyToMessageId) {\r\n      messageParts.push(`In-Reply-To: ${replyToMessageId}`);\r\n      messageParts.push(`References: ${replyToMessageId}`);\r\n    }\r\n    \r\n    // Set content type\r\n    if (isHtml) {\r\n      messageParts.push(`Content-Type: multipart/alternative; boundary=\"${boundary}\"`);\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}`);\r\n      messageParts.push('Content-Type: text/plain; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(this.htmlToText(body));\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}`);\r\n      messageParts.push('Content-Type: text/html; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(body);\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}--`);\r\n    } else {\r\n      messageParts.push('Content-Type: text/plain; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(body);\r\n    }\r\n    \r\n    const message = messageParts.join('\\r\\n');\r\n    \r\n    // Encode in base64\r\n    const encodedMessage = Buffer.from(message)\r\n      .toString('base64')\r\n      .replace(/\\+/g, '-')\r\n      .replace(/\\//g, '_')\r\n      .replace(/=+$/, '');\r\n    \r\n    return encodedMessage;\r\n  }\r\n  \r\n  private htmlToText(html: string): string {\r\n    // Simple HTML to text conversion\r\n    return html\r\n      .replace(/<br\\s*\\/?>/gi, '\\n')\r\n      .replace(/<\\/p>/gi, '\\n\\n')\r\n      .replace(/<[^>]+>/g, '')\r\n      .replace(/&nbsp;/g, ' ')\r\n      .replace(/&amp;/g, '&')\r\n      .replace(/&lt;/g, '<')\r\n      .replace(/&gt;/g, '>')\r\n      .replace(/&quot;/g, '\"')\r\n      .replace(/&#39;/g, \"'\")\r\n      .trim();\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface UpdateDraftArgs {\r\n  draftId: string;\r\n  to: string | string[];\r\n  subject: string;\r\n  body: string;\r\n  cc?: string | string[];\r\n  bcc?: string | string[];\r\n  isHtml?: boolean;\r\n  replyToMessageId?: string;\r\n  threadId?: string;\r\n}\r\n\r\nexport class UpdateDraftHandler extends BaseToolHandler {\r\n  async runTool(args: UpdateDraftArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Get user's email address\r\n      const profile = await gmail.users.getProfile({ userId: 'me' });\r\n      const userEmail = profile.data.emailAddress;\r\n      \r\n      // Create the updated email message\r\n      const message = this.createMessage(\r\n        userEmail!,\r\n        args.to,\r\n        args.subject,\r\n        args.body,\r\n        args.cc,\r\n        args.bcc,\r\n        args.isHtml || false,\r\n        args.replyToMessageId\r\n      );\r\n      \r\n      // Update the draft\r\n      const requestBody: gmail_v1.Schema$Draft = {\r\n        message: {\r\n          raw: message,\r\n          threadId: args.threadId\r\n        }\r\n      };\r\n      \r\n      const response = await gmail.users.drafts.update({\r\n        userId: 'me',\r\n        id: args.draftId,\r\n        requestBody\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              draftId: response.data.id,\r\n              messageId: response.data.message?.id,\r\n              threadId: response.data.message?.threadId\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private createMessage(\r\n    from: string,\r\n    to: string | string[],\r\n    subject: string,\r\n    body: string,\r\n    cc?: string | string[],\r\n    bcc?: string | string[],\r\n    isHtml: boolean = false,\r\n    replyToMessageId?: string\r\n  ): string {\r\n    const boundary = \"boundary_\" + Date.now();\r\n    const toAddresses = Array.isArray(to) ? to.join(', ') : to;\r\n    \r\n    let messageParts = [\r\n      `From: ${from}`,\r\n      `To: ${toAddresses}`,\r\n      `Subject: ${subject}`,\r\n      'MIME-Version: 1.0'\r\n    ];\r\n    \r\n    // Add CC if provided\r\n    if (cc) {\r\n      const ccAddresses = Array.isArray(cc) ? cc.join(', ') : cc;\r\n      messageParts.push(`Cc: ${ccAddresses}`);\r\n    }\r\n    \r\n    // Add BCC if provided\r\n    if (bcc) {\r\n      const bccAddresses = Array.isArray(bcc) ? bcc.join(', ') : bcc;\r\n      messageParts.push(`Bcc: ${bccAddresses}`);\r\n    }\r\n    \r\n    // Add In-Reply-To header if replying\r\n    if (replyToMessageId) {\r\n      messageParts.push(`In-Reply-To: ${replyToMessageId}`);\r\n      messageParts.push(`References: ${replyToMessageId}`);\r\n    }\r\n    \r\n    // Set content type\r\n    if (isHtml) {\r\n      messageParts.push(`Content-Type: multipart/alternative; boundary=\"${boundary}\"`);\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}`);\r\n      messageParts.push('Content-Type: text/plain; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(this.htmlToText(body));\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}`);\r\n      messageParts.push('Content-Type: text/html; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(body);\r\n      messageParts.push('');\r\n      messageParts.push(`--${boundary}--`);\r\n    } else {\r\n      messageParts.push('Content-Type: text/plain; charset=UTF-8');\r\n      messageParts.push('');\r\n      messageParts.push(body);\r\n    }\r\n    \r\n    const message = messageParts.join('\\r\\n');\r\n    \r\n    // Encode in base64\r\n    const encodedMessage = Buffer.from(message)\r\n      .toString('base64')\r\n      .replace(/\\+/g, '-')\r\n      .replace(/\\//g, '_')\r\n      .replace(/=+$/, '');\r\n    \r\n    return encodedMessage;\r\n  }\r\n  \r\n  private htmlToText(html: string): string {\r\n    // Simple HTML to text conversion\r\n    return html\r\n      .replace(/<br\\s*\\/?>/gi, '\\n')\r\n      .replace(/<\\/p>/gi, '\\n\\n')\r\n      .replace(/<[^>]+>/g, '')\r\n      .replace(/&nbsp;/g, ' ')\r\n      .replace(/&amp;/g, '&')\r\n      .replace(/&lt;/g, '<')\r\n      .replace(/&gt;/g, '>')\r\n      .replace(/&quot;/g, '\"')\r\n      .replace(/&#39;/g, \"'\")\r\n      .trim();\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface SendDraftArgs {\r\n  draftId: string;\r\n}\r\n\r\nexport class SendDraftHandler extends BaseToolHandler {\r\n  async runTool(args: SendDraftArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Send the draft\r\n      const response = await gmail.users.drafts.send({\r\n        userId: 'me',\r\n        requestBody: {\r\n          id: args.draftId\r\n        }\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              messageId: response.data.id,\r\n              threadId: response.data.threadId,\r\n              labelIds: response.data.labelIds\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\nexport class ListLabelsHandler extends BaseToolHandler {\r\n  async runTool(args: any, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // List all labels\r\n      const response = await gmail.users.labels.list({\r\n        userId: 'me'\r\n      });\r\n      \r\n      const labels = response.data.labels || [];\r\n      \r\n      // Separate system and user labels\r\n      const systemLabels = labels.filter(label => label.type === 'system');\r\n      const userLabels = labels.filter(label => label.type === 'user');\r\n      \r\n      // Format labels for better readability\r\n      const formattedLabels = {\r\n        systemLabels: systemLabels.map(this.formatLabel),\r\n        userLabels: userLabels.map(this.formatLabel),\r\n        totalCount: labels.length,\r\n        systemCount: systemLabels.length,\r\n        userCount: userLabels.length\r\n      };\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify(formattedLabels, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatLabel(label: any): any {\r\n    return {\r\n      id: label.id,\r\n      name: label.name,\r\n      type: label.type,\r\n      messageListVisibility: label.messageListVisibility,\r\n      labelListVisibility: label.labelListVisibility,\r\n      color: label.color ? {\r\n        textColor: label.color.textColor,\r\n        backgroundColor: label.color.backgroundColor\r\n      } : undefined,\r\n      messagesTotal: label.messagesTotal,\r\n      messagesUnread: label.messagesUnread,\r\n      threadsTotal: label.threadsTotal,\r\n      threadsUnread: label.threadsUnread\r\n    };\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface CreateLabelArgs {\r\n  name: string;\r\n  messageListVisibility?: 'show' | 'hide';\r\n  labelListVisibility?: 'labelShow' | 'labelShowIfUnread' | 'labelHide';\r\n  backgroundColor?: string;\r\n  textColor?: string;\r\n}\r\n\r\nexport class CreateLabelHandler extends BaseToolHandler {\r\n  async runTool(args: CreateLabelArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Build the label object\r\n      const requestBody: gmail_v1.Schema$Label = {\r\n        name: args.name,\r\n        messageListVisibility: args.messageListVisibility || 'show',\r\n        labelListVisibility: args.labelListVisibility || 'labelShow'\r\n      };\r\n      \r\n      // Add color if provided\r\n      if (args.backgroundColor || args.textColor) {\r\n        requestBody.color = {\r\n          backgroundColor: args.backgroundColor,\r\n          textColor: args.textColor\r\n        };\r\n      }\r\n      \r\n      // Create the label\r\n      const response = await gmail.users.labels.create({\r\n        userId: 'me',\r\n        requestBody\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              label: {\r\n                id: response.data.id,\r\n                name: response.data.name,\r\n                type: response.data.type,\r\n                messageListVisibility: response.data.messageListVisibility,\r\n                labelListVisibility: response.data.labelListVisibility,\r\n                color: response.data.color\r\n              }\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface UpdateLabelArgs {\r\n  labelId: string;\r\n  name?: string;\r\n  messageListVisibility?: 'show' | 'hide';\r\n  labelListVisibility?: 'labelShow' | 'labelShowIfUnread' | 'labelHide';\r\n  backgroundColor?: string;\r\n  textColor?: string;\r\n}\r\n\r\nexport class UpdateLabelHandler extends BaseToolHandler {\r\n  async runTool(args: UpdateLabelArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Build the update object\r\n      const requestBody: gmail_v1.Schema$Label = {};\r\n      \r\n      if (args.name) {\r\n        requestBody.name = args.name;\r\n      }\r\n      \r\n      if (args.messageListVisibility) {\r\n        requestBody.messageListVisibility = args.messageListVisibility;\r\n      }\r\n      \r\n      if (args.labelListVisibility) {\r\n        requestBody.labelListVisibility = args.labelListVisibility;\r\n      }\r\n      \r\n      // Add color if provided\r\n      if (args.backgroundColor || args.textColor) {\r\n        requestBody.color = {\r\n          backgroundColor: args.backgroundColor,\r\n          textColor: args.textColor\r\n        };\r\n      }\r\n      \r\n      // Update the label (using patch for partial updates)\r\n      const response = await gmail.users.labels.patch({\r\n        userId: 'me',\r\n        id: args.labelId,\r\n        requestBody\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              label: {\r\n                id: response.data.id,\r\n                name: response.data.name,\r\n                type: response.data.type,\r\n                messageListVisibility: response.data.messageListVisibility,\r\n                labelListVisibility: response.data.labelListVisibility,\r\n                color: response.data.color,\r\n                messagesTotal: response.data.messagesTotal,\r\n                messagesUnread: response.data.messagesUnread,\r\n                threadsTotal: response.data.threadsTotal,\r\n                threadsUnread: response.data.threadsUnread\r\n              }\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\n\r\ninterface DeleteLabelArgs {\r\n  labelId: string;\r\n}\r\n\r\nexport class DeleteLabelHandler extends BaseToolHandler {\r\n  async runTool(args: DeleteLabelArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Delete the label\r\n      await gmail.users.labels.delete({\r\n        userId: 'me',\r\n        id: args.labelId\r\n      });\r\n\r\n      return {\r\n        content: [\r\n          {\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              message: `Label ${args.labelId} deleted successfully`,\r\n              warning: 'This action removed the label from all messages and threads'\r\n            }, null, 2)\r\n          }\r\n        ]\r\n      };\r\n    } catch (error) {\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n}", "import { CallToolResult } from \"@modelcontextprotocol/sdk/types.js\";\r\nimport { OAuth2Client } from \"google-auth-library\";\r\nimport { google, gmail_v1 } from \"googleapis\";\r\nimport { BaseToolHandler } from \"../BaseToolHandler.js\";\r\nimport { LabelMutationBuilder, LabelMutationFlags } from \"./utils/labelMutationBuilder.js\";\r\nimport { GmailRateLimiter } from \"./utils/rateLimiter.js\";\r\n\r\ninterface BatchUpdateEmailsArgs extends LabelMutationFlags {\r\n  messageIds: string[];\r\n  moveToTrash?: boolean;\r\n}\r\n\r\ninterface MessageVerification {\r\n  id: string;\r\n  success: boolean;\r\n  preLabels?: string[];\r\n  postLabels?: string[];\r\n  error?: string;\r\n  skippedReason?: string;\r\n}\r\n\r\nexport class BatchUpdateEmailsHandler extends BaseToolHandler {\r\n  private static readonly CHUNK_SIZE = 50; // Gmail recommends max 50 for batch operations\r\n  private static readonly PARALLEL_VERIFY_LIMIT = 20; // Concurrent verification requests\r\n  \r\n  async runTool(args: BatchUpdateEmailsArgs, oauth2Client: OAuth2Client): Promise<CallToolResult> {\r\n    try {\r\n      // Early validation: empty array\r\n      if (!args.messageIds || args.messageIds.length === 0) {\r\n        return {\r\n          content: [{\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              message: 'No message IDs provided',\r\n              messageCount: 0\r\n            }, null, 2)\r\n          }]\r\n        };\r\n      }\r\n\r\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\r\n      \r\n      // Handle trash operation separately (uses batchDelete)\r\n      if (args.moveToTrash) {\r\n        return this.handleBatchTrash(gmail, args.messageIds);\r\n      }\r\n      \r\n      // Build label mutations with validation\r\n      const mutation = LabelMutationBuilder.build(args);\r\n      \r\n      // Check if there are any changes to make\r\n      if (mutation.addLabelIds.length === 0 && mutation.removeLabelIds.length === 0) {\r\n        return {\r\n          content: [{\r\n            type: \"text\",\r\n            text: JSON.stringify({\r\n              success: true,\r\n              message: 'No label changes requested',\r\n              messageCount: args.messageIds.length\r\n            }, null, 2)\r\n          }]\r\n        };\r\n      }\r\n\r\n      console.log('BatchUpdateEmails - Starting operation:', {\r\n        totalMessages: args.messageIds.length,\r\n        addLabelIds: mutation.addLabelIds,\r\n        removeLabelIds: mutation.removeLabelIds\r\n      });\r\n      \r\n      // Process messages with verification and retry\r\n      const results = await this.processMessagesWithVerification(\r\n        gmail,\r\n        args.messageIds,\r\n        mutation\r\n      );\r\n      \r\n      // Calculate final statistics\r\n      const successful = results.filter(r => r.success);\r\n      const failed = results.filter(r => !r.success);\r\n      \r\n      console.log('BatchUpdateEmails - Final summary:', {\r\n        total: args.messageIds.length,\r\n        successful: successful.length,\r\n        failed: failed.length\r\n      });\r\n      \r\n      return {\r\n        content: [{\r\n          type: \"text\",\r\n          text: JSON.stringify({\r\n            success: failed.length === 0,\r\n            action: 'batch_modified',\r\n            summary: {\r\n              total: args.messageIds.length,\r\n              successful: successful.length,\r\n              failed: failed.length\r\n            },\r\n            details: {\r\n              successfulIds: successful.map(r => r.id),\r\n              failedOperations: failed.map(r => ({\r\n                id: r.id,\r\n                reason: r.error || r.skippedReason || 'Unknown error'\r\n              })),\r\n              addedLabels: mutation.addLabelIds,\r\n              removedLabels: mutation.removeLabelIds\r\n            }\r\n          }, null, 2)\r\n        }]\r\n      };\r\n    } catch (error: any) {\r\n      console.error('BatchUpdateEmails - Fatal error:', {\r\n        message: error.message,\r\n        code: error.code,\r\n        errors: error.errors,\r\n        response: error.response?.data\r\n      });\r\n      this.handleGoogleApiError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async handleBatchTrash(\r\n    gmail: gmail_v1.Gmail,\r\n    messageIds: string[]\r\n  ): Promise<CallToolResult> {\r\n    try {\r\n      // Process in chunks for batchDelete\r\n      const chunks = this.chunkArray(messageIds, 1000); // batchDelete supports up to 1000\r\n      \r\n      for (const chunk of chunks) {\r\n        await gmail.users.messages.batchDelete({\r\n          userId: 'me',\r\n          requestBody: {\r\n            ids: chunk\r\n          }\r\n        });\r\n      }\r\n      \r\n      return {\r\n        content: [{\r\n          type: \"text\",\r\n          text: JSON.stringify({\r\n            success: true,\r\n            action: 'batch_moved_to_trash',\r\n            messageCount: messageIds.length,\r\n            messageIds: messageIds\r\n          }, null, 2)\r\n        }]\r\n      };\r\n    } catch (error: any) {\r\n      // batchDelete might partially succeed\r\n      console.error('BatchUpdateEmails - Trash operation failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async processMessagesWithVerification(\r\n    gmail: gmail_v1.Gmail,\r\n    messageIds: string[],\r\n    mutation: { addLabelIds: string[]; removeLabelIds: string[] }\r\n  ): Promise<MessageVerification[]> {\r\n    const rateLimiter = new GmailRateLimiter();\r\n    const chunks = this.chunkArray(messageIds, BatchUpdateEmailsHandler.CHUNK_SIZE);\r\n    const allResults: MessageVerification[] = [];\r\n    \r\n    for (let i = 0; i < chunks.length; i++) {\r\n      const chunk = chunks[i];\r\n      const chunkIndex = i + 1;\r\n      const totalChunks = chunks.length;\r\n      \r\n      console.log(`BatchUpdateEmails - Processing chunk ${chunkIndex}/${totalChunks} (${chunk.length} messages)`);\r\n      \r\n      // Add delay based on rate limiting\r\n      if (i > 0) {\r\n        await rateLimiter.wait();\r\n      }\r\n      \r\n      try {\r\n        // Execute batch modify\r\n        const response = await gmail.users.messages.batchModify({\r\n          userId: 'me',\r\n          requestBody: {\r\n            ids: chunk,\r\n            addLabelIds: mutation.addLabelIds,\r\n            removeLabelIds: mutation.removeLabelIds\r\n          }\r\n        });\r\n        \r\n        // Extract and use rate limit info\r\n        const rateLimitInfo = GmailRateLimiter.extractRateLimitInfo(response.headers);\r\n        console.log('BatchUpdateEmails - Rate limit info:', rateLimitInfo);\r\n        rateLimiter.calculateDelay(rateLimitInfo);\r\n        \r\n        // Verify the batch operation results\r\n        const chunkResults = await this.verifyBatchResults(gmail, chunk, mutation);\r\n        allResults.push(...chunkResults);\r\n        \r\n        // Retry failures individually\r\n        const failures = chunkResults.filter(r => !r.success);\r\n        if (failures.length > 0) {\r\n          console.log(`BatchUpdateEmails - Retrying ${failures.length} failed messages individually`);\r\n          \r\n          for (const failed of failures) {\r\n            const retryResult = await this.retryIndividualMessage(\r\n              gmail,\r\n              failed.id,\r\n              mutation,\r\n              rateLimiter\r\n            );\r\n            \r\n            // Update the result\r\n            const index = allResults.findIndex(r => r.id === failed.id);\r\n            if (index !== -1) {\r\n              allResults[index] = retryResult;\r\n            }\r\n          }\r\n        }\r\n        \r\n      } catch (error: any) {\r\n        console.error(`BatchUpdateEmails - Chunk ${chunkIndex} failed:`, error);\r\n        \r\n        // Handle rate limiting\r\n        if (error.code === 429) {\r\n          const retryAfter = error.response?.headers?.['retry-after'];\r\n          const delay = rateLimiter.handle429(retryAfter);\r\n          console.log(`BatchUpdateEmails - Rate limited, waiting ${delay}ms`);\r\n          await rateLimiter.wait();\r\n          \r\n          // Retry the chunk\r\n          i--; // Retry this chunk\r\n          continue;\r\n        }\r\n        \r\n        // Mark all messages in chunk as failed\r\n        chunk.forEach(id => {\r\n          allResults.push({\r\n            id,\r\n            success: false,\r\n            error: error.message || 'Batch operation failed'\r\n          });\r\n        });\r\n      }\r\n    }\r\n    \r\n    return allResults;\r\n  }\r\n\r\n  private async verifyBatchResults(\r\n    gmail: gmail_v1.Gmail,\r\n    messageIds: string[],\r\n    mutation: { addLabelIds: string[]; removeLabelIds: string[] }\r\n  ): Promise<MessageVerification[]> {\r\n    // Verify in parallel with concurrency limit\r\n    const verifyPromises = messageIds.map(id => \r\n      this.createThrottledVerification(gmail, id, mutation)\r\n    );\r\n    \r\n    // Process with limited concurrency\r\n    const results: MessageVerification[] = [];\r\n    const limit = BatchUpdateEmailsHandler.PARALLEL_VERIFY_LIMIT;\r\n    \r\n    for (let i = 0; i < verifyPromises.length; i += limit) {\r\n      const batch = verifyPromises.slice(i, i + limit);\r\n      const batchResults = await Promise.all(batch);\r\n      results.push(...batchResults);\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  private async createThrottledVerification(\r\n    gmail: gmail_v1.Gmail,\r\n    messageId: string,\r\n    mutation: { addLabelIds: string[]; removeLabelIds: string[] }\r\n  ): Promise<MessageVerification> {\r\n    try {\r\n      const message = await gmail.users.messages.get({\r\n        userId: 'me',\r\n        id: messageId,\r\n        format: 'minimal'\r\n      });\r\n      \r\n      const currentLabels = message.data.labelIds || [];\r\n      \r\n      // Check if changes were applied\r\n      const expectedAdded = mutation.addLabelIds.every(label => \r\n        currentLabels.includes(label)\r\n      );\r\n      const expectedRemoved = mutation.removeLabelIds.every(label => \r\n        !currentLabels.includes(label)\r\n      );\r\n      \r\n      const success = expectedAdded && expectedRemoved;\r\n      \r\n      return {\r\n        id: messageId,\r\n        success,\r\n        postLabels: currentLabels,\r\n        error: success ? undefined : 'Labels not updated as expected'\r\n      };\r\n    } catch (error: any) {\r\n      return {\r\n        id: messageId,\r\n        success: false,\r\n        error: `Verification failed: ${error.message}`\r\n      };\r\n    }\r\n  }\r\n\r\n  private async retryIndividualMessage(\r\n    gmail: gmail_v1.Gmail,\r\n    messageId: string,\r\n    mutation: { addLabelIds: string[]; removeLabelIds: string[] },\r\n    rateLimiter: GmailRateLimiter\r\n  ): Promise<MessageVerification> {\r\n    try {\r\n      // First check if the message can be modified\r\n      const preCheck = await gmail.users.messages.get({\r\n        userId: 'me',\r\n        id: messageId,\r\n        format: 'minimal'\r\n      });\r\n      \r\n      const currentLabels = preCheck.data.labelIds || [];\r\n      \r\n      // Check if labels can be modified (TRASH/SPAM restrictions)\r\n      if (!LabelMutationBuilder.canModifyLabels(currentLabels, mutation)) {\r\n        return {\r\n          id: messageId,\r\n          success: false,\r\n          preLabels: currentLabels,\r\n          skippedReason: 'Message in TRASH/SPAM - label modifications not allowed'\r\n        };\r\n      }\r\n      \r\n      // Attempt the modification\r\n      await gmail.users.messages.modify({\r\n        userId: 'me',\r\n        id: messageId,\r\n        requestBody: {\r\n          addLabelIds: mutation.addLabelIds,\r\n          removeLabelIds: mutation.removeLabelIds\r\n        }\r\n      });\r\n      \r\n      // Wait a bit for consistency\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n      \r\n      // Verify the change actually took effect\r\n      const postCheck = await gmail.users.messages.get({\r\n        userId: 'me',\r\n        id: messageId,\r\n        format: 'minimal'\r\n      });\r\n      \r\n      const finalLabels = postCheck.data.labelIds || [];\r\n      \r\n      // Verify changes were applied\r\n      const expectedAdded = mutation.addLabelIds.every(label => \r\n        finalLabels.includes(label)\r\n      );\r\n      const expectedRemoved = mutation.removeLabelIds.every(label => \r\n        !finalLabels.includes(label)\r\n      );\r\n      \r\n      const success = expectedAdded && expectedRemoved;\r\n      \r\n      return {\r\n        id: messageId,\r\n        success,\r\n        preLabels: currentLabels,\r\n        postLabels: finalLabels,\r\n        error: success ? undefined : 'Retry succeeded but verification failed'\r\n      };\r\n      \r\n    } catch (error: any) {\r\n      // Check for rate limiting\r\n      if (error.code === 429) {\r\n        const retryAfter = error.response?.headers?.['retry-after'];\r\n        rateLimiter.handle429(retryAfter);\r\n      }\r\n      \r\n      return {\r\n        id: messageId,\r\n        success: false,\r\n        error: `Individual retry failed: ${error.message}`\r\n      };\r\n    }\r\n  }\r\n\r\n  private chunkArray<T>(array: T[], size: number): T[][] {\r\n    const chunks: T[][] = [];\r\n    for (let i = 0; i < array.length; i += size) {\r\n      chunks.push(array.slice(i, i + size));\r\n    }\r\n    return chunks;\r\n  }\r\n}", "/**\r\n * Rate limiter with exponential backoff based on Gmail API rate limit headers\r\n */\r\n\r\nexport interface RateLimitInfo {\r\n  limit?: number;\r\n  remaining?: number;\r\n  reset?: number;\r\n}\r\n\r\nexport class GmailRateLimiter {\r\n  private static readonly MIN_DELAY = 100; // 100ms\r\n  private static readonly MAX_DELAY = 60000; // 60s\r\n  private static readonly BACKOFF_MULTIPLIER = 2;\r\n  private static readonly LOW_QUOTA_THRESHOLD = 0.1; // 10% remaining\r\n  \r\n  private currentDelay = GmailRateLimiter.MIN_DELAY;\r\n  private consecutiveErrors = 0;\r\n\r\n  /**\r\n   * Extract rate limit info from response headers\r\n   * Headers can be in various cases: x-ratelimit-limit, X-RateLimit-Limit, etc.\r\n   */\r\n  static extractRateLimitInfo(headers: any): RateLimitInfo {\r\n    const info: RateLimitInfo = {};\r\n    \r\n    if (!headers) return info;\r\n    \r\n    // Normalize header access\r\n    const getHeader = (name: string): string | undefined => {\r\n      // Try lowercase first (most common)\r\n      const lowercase = name.toLowerCase();\r\n      if (headers[lowercase]) return headers[lowercase];\r\n      \r\n      // Try exact case\r\n      if (headers[name]) return headers[name];\r\n      \r\n      // Try case-insensitive search\r\n      for (const key in headers) {\r\n        if (key.toLowerCase() === lowercase) {\r\n          return headers[key];\r\n        }\r\n      }\r\n      \r\n      return undefined;\r\n    };\r\n    \r\n    const limit = getHeader('x-ratelimit-limit');\r\n    const remaining = getHeader('x-ratelimit-remaining');\r\n    const reset = getHeader('x-ratelimit-reset');\r\n    \r\n    if (limit) info.limit = parseInt(limit);\r\n    if (remaining) info.remaining = parseInt(remaining);\r\n    if (reset) info.reset = parseInt(reset);\r\n    \r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * Calculate delay based on rate limit info and error status\r\n   */\r\n  calculateDelay(rateLimitInfo: RateLimitInfo, isError: boolean = false): number {\r\n    if (isError) {\r\n      this.consecutiveErrors++;\r\n      // Exponential backoff on errors\r\n      this.currentDelay = Math.min(\r\n        this.currentDelay * Math.pow(GmailRateLimiter.BACKOFF_MULTIPLIER, this.consecutiveErrors),\r\n        GmailRateLimiter.MAX_DELAY\r\n      );\r\n      return this.currentDelay;\r\n    }\r\n    \r\n    // Reset on success\r\n    this.consecutiveErrors = 0;\r\n    \r\n    // If we have rate limit info, use it\r\n    if (rateLimitInfo.limit && rateLimitInfo.remaining !== undefined) {\r\n      const quotaUsedRatio = 1 - (rateLimitInfo.remaining / rateLimitInfo.limit);\r\n      \r\n      // If quota is running low, increase delay\r\n      if (quotaUsedRatio > (1 - GmailRateLimiter.LOW_QUOTA_THRESHOLD)) {\r\n        // Scale delay based on how close we are to the limit\r\n        const scaleFactor = 1 + (quotaUsedRatio - 0.9) * 10; // 1x to 2x scaling\r\n        this.currentDelay = Math.min(\r\n          GmailRateLimiter.MIN_DELAY * scaleFactor * 10,\r\n          GmailRateLimiter.MAX_DELAY\r\n        );\r\n      } else {\r\n        // Normal operation\r\n        this.currentDelay = GmailRateLimiter.MIN_DELAY;\r\n      }\r\n    }\r\n    \r\n    return this.currentDelay;\r\n  }\r\n\r\n  /**\r\n   * Wait for the calculated delay\r\n   */\r\n  async wait(): Promise<void> {\r\n    if (this.currentDelay > 0) {\r\n      await new Promise(resolve => setTimeout(resolve, this.currentDelay));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle 429 rate limit error with retry-after header\r\n   */\r\n  handle429(retryAfter?: string): number {\r\n    if (retryAfter) {\r\n      // Retry-After can be seconds or HTTP date\r\n      const seconds = parseInt(retryAfter);\r\n      if (!isNaN(seconds)) {\r\n        this.currentDelay = seconds * 1000;\r\n      } else {\r\n        // Try parsing as date\r\n        const retryDate = new Date(retryAfter).getTime();\r\n        if (!isNaN(retryDate)) {\r\n          this.currentDelay = Math.max(0, retryDate - Date.now());\r\n        }\r\n      }\r\n    } else {\r\n      // No retry-after, use exponential backoff\r\n      this.consecutiveErrors++;\r\n      this.currentDelay = Math.min(\r\n        1000 * Math.pow(GmailRateLimiter.BACKOFF_MULTIPLIER, this.consecutiveErrors),\r\n        GmailRateLimiter.MAX_DELAY\r\n      );\r\n    }\r\n    \r\n    return this.currentDelay;\r\n  }\r\n}"],
  "mappings": ";;;;;;;;;;;AAEA,SAAS,eAAAA,oBAAmB;AAC5B,SAAsB,cAAc;AAHpC,IAMsB;AANtB;AAAA;AAAA;AAMO,IAAe,kBAAf,MAA+B;AAAA,MAGxB,qBAAqB,OAAsB;AACjD,YACI,iBAAiBA,gBACjB,MAAM,UAAU,MAAM,UAAU,iBAClC;AACE,gBAAM,IAAI;AAAA,YACN;AAAA,UACJ;AAAA,QACJ;AACA,cAAM;AAAA,MACV;AAAA,MAEU,YAAY,MAA0C;AAC5D,eAAO,OAAO,SAAS,EAAE,SAAS,MAAM,KAAK,CAAC;AAAA,MAClD;AAAA,IACJ;AAAA;AAAA;;;ACxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAS,SAAS;AAAlB,IAIa,gBAKA,iBAOP,yBAEO,2BA8CA,6BAWA,4BA6BA,4BAuEA,4BAKA;AApLb;AAAA;AAAA;AAIO,IAAM,iBAAiB,EAAE,OAAO;AAAA,MACrC,QAAQ,EAAE,KAAK,CAAC,SAAS,OAAO,CAAC,EAAE,QAAQ,OAAO;AAAA,MAClD,SAAS,EAAE,OAAO;AAAA,IACpB,CAAC;AAEM,IAAM,kBAAkB,EAAE,OAAO;AAAA,MACtC,YAAY,EAAE,QAAQ;AAAA,MACtB,WAAW,EAAE,MAAM,cAAc,EAAE,SAAS;AAAA,IAC9C,CAAC;AAID,IAAM,0BAA0B;AAEzB,IAAM,4BAA4B,EAAE,OAAO;AAAA,MAChD,YAAY,EAAE;AAAA,QACZ,CAAC,QAAQ;AAEP,cAAI,OAAO,QAAQ,YAAY,IAAI,WAAW,GAAG,KAAK,IAAI,SAAS,GAAG,GAAG;AACvE,gBAAI;AACF,qBAAO,KAAK,MAAM,GAAG;AAAA,YACvB,QAAQ;AAEN,qBAAO;AAAA,YACT;AAAA,UACF;AACA,iBAAO;AAAA,QACT;AAAA,QACA,EAAE,MAAM;AAAA,UACN,EAAE,OAAO,EAAE,IAAI,GAAG,6BAA6B;AAAA,UAC/C,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,GAAG,6BAA6B,CAAC,EACrD,IAAI,GAAG,sCAAsC,EAC7C,IAAI,IAAI,0CAA0C,EAClD;AAAA,YACC,CAAC,QAAQ,IAAI,IAAI,GAAG,EAAE,SAAS,IAAI;AAAA,YACnC;AAAA,UACF;AAAA,QACJ,CAAC;AAAA,MACH,EAAE,SAAS,qCAAqC;AAAA,MAChD,SAAS,EAAE,OAAO,EACf,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS,EACT,SAAS,gCAAgC;AAAA,MAC5C,SAAS,EAAE,OAAO,EACf,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS,EACT,SAAS,8BAA8B;AAAA,IAC5C,CAAC,EAAE;AAAA,MACD,CAAC,SAAS;AACR,YAAI,KAAK,WAAW,KAAK,SAAS;AAChC,iBAAO,IAAI,KAAK,KAAK,OAAO,IAAI,IAAI,KAAK,KAAK,OAAO;AAAA,QACvD;AACA,eAAO;AAAA,MACT;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,MAAM,CAAC,SAAS;AAAA,MAClB;AAAA,IACF;AAEO,IAAM,8BAA8B,EAAE,OAAO;AAAA,MAClD,YAAY,EAAE,OAAO;AAAA,MACrB,OAAO,EAAE,OAAO;AAAA,MAChB,SAAS,EAAE,OAAO,EACf,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS;AAAA,MACZ,SAAS,EAAE,OAAO,EACf,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS;AAAA,IACd,CAAC;AAEM,IAAM,6BAA6B,EAAE,OAAO;AAAA,MACjD,YAAY,EAAE,OAAO;AAAA,MACrB,SAAS,EAAE,OAAO;AAAA,MAClB,aAAa,EAAE,OAAO,EAAE,SAAS;AAAA,MACjC,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,+DAA+D;AAAA,MAChH,KAAK,EAAE,OAAO,EAAE,MAAM,yBAAyB,+DAA+D;AAAA,MAC9G,UAAU,EAAE,OAAO;AAAA,MACnB,WAAW,EACR;AAAA,QACC,EAAE,OAAO;AAAA,UACP,OAAO,EAAE,OAAO;AAAA,QAClB,CAAC;AAAA,MACH,EACC,SAAS;AAAA,MACZ,UAAU,EAAE,OAAO,EAAE,SAAS;AAAA,MAC9B,SAAS,EAAE,OAAO,EAAE,SAAS;AAAA,MAC7B,WAAW,gBAAgB,SAAS;AAAA,MACpC,YAAY,EAAE,MAAM,EAAE,OAAO,CAAC,EAAE,SAAS;AAAA,MACzC,gBAAgB,EAAE,OAAO;AAAA,QACvB,eAAe,EAAE,OAAO;AAAA,UACtB,WAAW,EAAE,OAAO,EAAE,SAAS;AAAA,UAC/B,uBAAuB,EAAE,OAAO;AAAA,YAC9B,MAAM,EAAE,OAAO;AAAA,UACjB,CAAC,EAAE,SAAS;AAAA,QACd,CAAC,EAAE,SAAS;AAAA,MACd,CAAC,EAAE,SAAS;AAAA,MACZ,aAAa,EAAE,KAAK,CAAC,OAAO,gBAAgB,MAAM,CAAC,EAAE,SAAS;AAAA,IAChE,CAAC;AAEM,IAAM,6BAA6B,EAAE,OAAO;AAAA,MACjD,YAAY,EAAE,OAAO;AAAA,MACrB,SAAS,EAAE,OAAO;AAAA,MAClB,SAAS,EAAE,OAAO,EAAE,SAAS;AAAA,MAC7B,aAAa,EAAE,OAAO,EAAE,SAAS;AAAA,MACjC,OAAO,EAAE,OAAO,EACb,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS;AAAA,MACZ,KAAK,EAAE,OAAO,EACX,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS;AAAA,MACZ,UAAU,EAAE,OAAO;AAAA;AAAA,MACnB,WAAW,EACR;AAAA,QACC,EAAE,OAAO;AAAA,UACP,OAAO,EAAE,OAAO;AAAA,QAClB,CAAC;AAAA,MACH,EACC,SAAS;AAAA,MACZ,UAAU,EAAE,OAAO,EAAE,SAAS;AAAA,MAC9B,SAAS,EAAE,OAAO,EAAE,SAAS;AAAA,MAC7B,WAAW,gBAAgB,SAAS;AAAA,MACpC,YAAY,EAAE,MAAM,EAAE,OAAO,CAAC,EAAE,SAAS;AAAA;AAAA,MAEzC,mBAAmB,EAAE,KAAK,CAAC,UAAU,OAAO,QAAQ,CAAC,EAAE,QAAQ,KAAK;AAAA,MACpE,mBAAmB,EAAE,OAAO,EACzB,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS;AAAA,MACZ,iBAAiB,EAAE,OAAO,EACvB,MAAM,yBAAyB,+DAA+D,EAC9F,SAAS;AAAA,IACd,CAAC,EAAE;AAAA,MACD,CAAC,SAAS;AAER,YAAI,KAAK,sBAAsB,YAAY,CAAC,KAAK,mBAAmB;AAClE,iBAAO;AAAA,QACT;AACA,eAAO;AAAA,MACT;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,MAAM,CAAC,mBAAmB;AAAA,MAC5B;AAAA,IACF,EAAE;AAAA,MACA,CAAC,SAAS;AAER,YAAI,KAAK,sBAAsB,YAAY,CAAC,KAAK,iBAAiB;AAChE,iBAAO;AAAA,QACT;AACA,eAAO;AAAA,MACT;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,MAAM,CAAC,iBAAiB;AAAA,MAC1B;AAAA,IACF,EAAE;AAAA,MACA,CAAC,SAAS;AAER,YAAI,KAAK,iBAAiB;AACxB,gBAAM,aAAa,IAAI,KAAK,KAAK,eAAe;AAChD,gBAAM,MAAM,oBAAI,KAAK;AACrB,iBAAO,aAAa;AAAA,QACtB;AACA,eAAO;AAAA,MACT;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,MAAM,CAAC,iBAAiB;AAAA,MAC1B;AAAA,IACF;AAEO,IAAM,6BAA6B,EAAE,OAAO;AAAA,MACjD,YAAY,EAAE,OAAO;AAAA,MACrB,SAAS,EAAE,OAAO;AAAA,IACpB,CAAC;AAEM,IAAM,+BAA+B,EAAE,OAAO;AAAA,MACnD,SAAS,EAAE,OAAO,EACf,MAAM,yBAAyB,+DAA+D;AAAA,MACjG,SAAS,EAAE,OAAO,EACf,MAAM,yBAAyB,+DAA+D;AAAA,MACjG,UAAU,EAAE,OAAO,EAAE,SAAS;AAAA,MAC9B,mBAAmB,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,GAAG,EAAE,SAAS;AAAA,MACtD,sBAAsB,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,SAAS;AAAA,MACxD,OAAO,EAAE,MAAM,EAAE,OAAO;AAAA,QACtB,IAAI,EAAE,OAAO,EAAE,MAAM,+BAA+B;AAAA,MACtD,CAAC,CAAC;AAAA,IACJ,CAAC;AAAA;AAAA;;;AC1LM,SAAS,gBAAgB,QAA4C;AACxE,SAAO,OACF,IAAI,CAAC,UAAU;AACZ,UAAM,eAAe,MAAM,YACrB;AAAA,aAAgB,MAAM,UACnB,IAAI,CAAC,MAAM,GAAG,EAAE,SAAS,UAAU,KAAK,EAAE,kBAAkB,SAAS,GAAG,EACxE,KAAK,IAAI,CAAC,KACb;AACN,UAAM,eAAe,MAAM,WAAW;AAAA,YAAe,MAAM,QAAQ,KAAK;AACxE,UAAM,kBAAkB,MAAM,cAAc;AAAA,eAAkB,MAAM,WAAW,KAAK;AACpF,UAAM,YAAY,MAAM,UAAU;AAAA,YAAe,MAAM,OAAO,KAAK;AACnE,UAAM,eAAe,MAAM,YACrB;AAAA,aAAgB,MAAM,UAAU,aAAa,mBAC1C,MAAM,UAAU,aAAa,CAAC,GAAG,IAAI,CAAC,MAAW,GAAG,EAAE,MAAM,IAAI,EAAE,OAAO,iBAAiB,EAAE,KAAK,IAAI,KAAK,MAAM,KACnH;AACN,WAAO,GAAG,MAAM,WAAW,UAAU,KAAK,MAAM,MAAM,OAAO,IAAI,YAAY,GAAG,eAAe;AAAA,SAAY,MAAM,OAAO,YAAY,MAAM,OAAO,QAAQ,aAAa;AAAA,OAAU,MAAM,KAAK,YAAY,MAAM,KAAK,QAAQ,aAAa,GAAG,YAAY,GAAG,SAAS,GAAG,YAAY;AAAA;AAAA,EACrR,CAAC,EACA,KAAK,IAAI;AAClB;AAvBA;AAAA;AAAA;AAAA;AAAA;;;ACAA,IAuBa,mBAWA;AAlCb;AAAA;AAAA;AAuBO,IAAM,oBAAN,cAAgC,MAAM;AAAA,MAC3C,YACE,SACO,QACA,UAAmB,OAC1B;AACA,cAAM,OAAO;AAHN;AACA;AAGP,aAAK,OAAO;AAAA,MACd;AAAA,IACF;AAEO,IAAM,sBAAN,MAA0B;AAAA;AAAA,MAM/B,YAAoB,MAAoB;AAApB;AAClB,aAAK,WAAW,oBAAoB,KAAK,IAAI;AAAA,MAC/C;AAAA,MAPiB,gBAAgB;AAAA,MAChB;AAAA,MACA,aAAa;AAAA,MACb,YAAY;AAAA,MAM7B,MAAM,aAAa,UAAoD;AACrE,YAAI,SAAS,WAAW,GAAG;AACzB,iBAAO,CAAC;AAAA,QACV;AAEA,YAAI,SAAS,SAAS,IAAI;AACxB,gBAAM,IAAI,MAAM,oDAAoD;AAAA,QACtE;AAEA,eAAO,KAAK,sBAAsB,UAAU,CAAC;AAAA,MAC/C;AAAA,MAEA,MAAc,sBAAsB,UAA0B,SAA2C;AACvG,YAAI;AACF,gBAAM,YAAY,KAAK,gBAAgB,QAAQ;AAC/C,gBAAM,QAAQ,MAAM,KAAK,KAAK,eAAe;AAE7C,gBAAM,WAAW,MAAM,MAAM,KAAK,eAAe;AAAA,YAC/C,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,iBAAiB,UAAU,MAAM,KAAK;AAAA,cACtC,gBAAgB,6BAA6B,KAAK,QAAQ;AAAA,YAC5D;AAAA,YACA,MAAM;AAAA,UACR,CAAC;AAED,gBAAM,eAAe,MAAM,SAAS,KAAK;AAGzC,cAAI,SAAS,WAAW,OAAO,UAAU,KAAK,YAAY;AACxD,kBAAM,aAAa,SAAS,QAAQ,IAAI,aAAa;AACrD,kBAAM,QAAQ,aAAa,SAAS,UAAU,IAAI,MAAO,KAAK,YAAY,KAAK,IAAI,GAAG,OAAO;AAE7F,oBAAQ,KAAK,gCAAgC,KAAK,eAAe,UAAU,CAAC,IAAI,KAAK,UAAU,GAAG;AAClG,kBAAM,KAAK,MAAM,KAAK;AACtB,mBAAO,KAAK,sBAAsB,UAAU,UAAU,CAAC;AAAA,UACzD;AAEA,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,yBAAyB,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,cAC/D,CAAC;AAAA,gBACC,YAAY,SAAS;AAAA,gBACrB,SAAS,QAAQ,SAAS,MAAM,KAAK,SAAS,UAAU;AAAA,gBACxD,SAAS;AAAA,cACX,CAAC;AAAA,YACH;AAAA,UACF;AAEA,iBAAO,KAAK,mBAAmB,YAAY;AAAA,QAC7C,SAAS,OAAO;AACd,cAAI,iBAAiB,mBAAmB;AACtC,kBAAM;AAAA,UACR;AAGA,cAAI,UAAU,KAAK,cAAc,KAAK,iBAAiB,KAAK,GAAG;AAC7D,kBAAM,QAAQ,KAAK,YAAY,KAAK,IAAI,GAAG,OAAO;AAClD,oBAAQ,KAAK,iCAAiC,KAAK,eAAe,UAAU,CAAC,IAAI,KAAK,UAAU,MAAM,iBAAiB,QAAQ,MAAM,UAAU,eAAe,EAAE;AAChK,kBAAM,KAAK,MAAM,KAAK;AACtB,mBAAO,KAAK,sBAAsB,UAAU,UAAU,CAAC;AAAA,UACzD;AAGA,gBAAM,IAAI;AAAA,YACR,oCAAoC,iBAAiB,QAAQ,MAAM,UAAU,eAAe;AAAA,YAC5F,CAAC;AAAA,cACC,YAAY;AAAA,cACZ,SAAS,iBAAiB,QAAQ,MAAM,UAAU;AAAA,cAClD,SAAS;AAAA,YACX,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,MAEQ,iBAAiB,OAAqB;AAC5C,YAAI,iBAAiB,OAAO;AAC1B,gBAAM,UAAU,MAAM,QAAQ,YAAY;AAC1C,iBAAO,QAAQ,SAAS,SAAS,KAC1B,QAAQ,SAAS,SAAS,KAC1B,QAAQ,SAAS,YAAY,KAC7B,QAAQ,SAAS,WAAW;AAAA,QACrC;AACA,eAAO;AAAA,MACT;AAAA,MAEQ,MAAM,IAA2B;AACvC,eAAO,IAAI,QAAQ,CAAAC,aAAW,WAAWA,UAAS,EAAE,CAAC;AAAA,MACvD;AAAA,MAEQ,gBAAgB,UAAkC;AACxD,eAAO,SAAS,IAAI,CAAC,KAAK,UAAU;AAClC,gBAAM,QAAQ;AAAA,YACZ,KAAK,KAAK,QAAQ;AAAA,YAClB;AAAA,YACA,oBAAoB,QAAQ,CAAC;AAAA,YAC7B;AAAA,YACA,GAAG,IAAI,MAAM,IAAI,IAAI,IAAI;AAAA,UAC3B;AAEA,cAAI,IAAI,SAAS;AACf,mBAAO,QAAQ,IAAI,OAAO,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACpD,oBAAM,KAAK,GAAG,GAAG,KAAK,KAAK,EAAE;AAAA,YAC/B,CAAC;AAAA,UACH;AAEA,cAAI,IAAI,MAAM;AACZ,kBAAM,KAAK,gCAAgC;AAC3C,kBAAM,KAAK,EAAE;AACb,kBAAM,KAAK,KAAK,UAAU,IAAI,IAAI,CAAC;AAAA,UACrC;AAEA,iBAAO,MAAM,KAAK,MAAM;AAAA,QAC1B,CAAC,EAAE,KAAK,UAAU,IAAI;AAAA,IAAS,KAAK,QAAQ;AAAA,MAC9C;AAAA,MAEQ,mBAAmB,cAAuC;AAGhE,cAAM,QAAQ,aAAa,MAAM,OAAO;AACxC,YAAI,WAAW;AAGf,iBAAS,IAAI,GAAG,IAAI,KAAK,IAAI,IAAI,MAAM,MAAM,GAAG,KAAK;AACnD,gBAAM,OAAO,MAAM,CAAC;AACpB,cAAI,KAAK,YAAY,EAAE,SAAS,eAAe,KAAK,KAAK,SAAS,WAAW,GAAG;AAC9E,kBAAM,gBAAgB,KAAK,MAAM,wBAAwB;AACzD,gBAAI,eAAe;AACjB,yBAAW,cAAc,CAAC;AAC1B;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAGA,YAAI,CAAC,UAAU;AACb,gBAAM,gBAAgB,aAAa,MAAM,oBAAoB;AAC7D,cAAI,eAAe;AACjB,uBAAW,cAAc,CAAC;AAAA,UAC5B;AAAA,QACF;AAEA,YAAI,CAAC,UAAU;AACb,gBAAM,IAAI,MAAM,2CAA2C;AAAA,QAC7D;AAGA,cAAM,QAAQ,aAAa,MAAM,KAAK,QAAQ,EAAE;AAEhD,cAAM,YAA6B,CAAC;AAGpC,iBAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,gBAAM,OAAO,MAAM,CAAC;AAGpB,cAAI,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,MAAM,QAAQ,KAAK,KAAK,EAAE,WAAW,IAAI,EAAG;AAEhF,gBAAM,WAAW,KAAK,kBAAkB,IAAI;AAC5C,cAAI,UAAU;AACZ,sBAAU,KAAK,QAAQ;AAAA,UACzB;AAAA,QACF;AAEA,eAAO;AAAA,MACT;AAAA,MAEQ,kBAAkB,MAAoC;AAE5D,cAAM,QAAQ,KAAK,MAAM,OAAO;AAGhC,YAAI,gBAAgB;AACpB,iBAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,cAAI,MAAM,CAAC,EAAE,WAAW,UAAU,GAAG;AACnC,4BAAgB;AAChB;AAAA,UACF;AAAA,QACF;AAEA,YAAI,kBAAkB,GAAI,QAAO;AAGjC,cAAM,WAAW,MAAM,aAAa;AACpC,cAAM,cAAc,SAAS,MAAM,kBAAkB;AACrD,YAAI,CAAC,YAAa,QAAO;AAEzB,cAAM,aAAa,SAAS,YAAY,CAAC,CAAC;AAG1C,cAAM,UAAkC,CAAC;AACzC,YAAI,iBAAiB,gBAAgB;AAErC,iBAAS,IAAI,gBAAgB,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrD,gBAAM,OAAO,MAAM,CAAC;AACpB,cAAI,KAAK,KAAK,MAAM,IAAI;AACtB,6BAAiB,IAAI;AACrB;AAAA,UACF;AAEA,gBAAM,aAAa,KAAK,QAAQ,GAAG;AACnC,cAAI,aAAa,GAAG;AAClB,kBAAM,MAAM,KAAK,UAAU,GAAG,UAAU,EAAE,KAAK;AAC/C,kBAAM,QAAQ,KAAK,UAAU,aAAa,CAAC,EAAE,KAAK;AAClD,oBAAQ,GAAG,IAAI;AAAA,UACjB;AAAA,QACF;AAGA,YAAI,OAAY;AAChB,YAAI,iBAAiB,MAAM,QAAQ;AAEjC,gBAAM,YAAY,CAAC;AACnB,mBAAS,IAAI,gBAAgB,IAAI,MAAM,QAAQ,KAAK;AAClD,sBAAU,KAAK,MAAM,CAAC,CAAC;AAAA,UACzB;AAGA,iBAAO,UAAU,SAAS,KAAK,UAAU,UAAU,SAAS,CAAC,EAAE,KAAK,MAAM,IAAI;AAC5E,sBAAU,IAAI;AAAA,UAChB;AAEA,cAAI,UAAU,SAAS,GAAG;AACxB,kBAAM,WAAW,UAAU,KAAK,IAAI;AACpC,gBAAI,SAAS,KAAK,GAAG;AACnB,kBAAI;AACF,uBAAO,KAAK,MAAM,QAAQ;AAAA,cAC5B,QAAQ;AAEN,uBAAO;AAAA,cACT;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAEA,eAAO;AAAA,UACL;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA;AAAA;;;AC7RA;AAAA;AAAA;AAAA;AAAA,IAgBa;AAhBb;AAAA;AAAA;AACA;AAEA;AAGA;AACA;AASO,IAAM,oBAAN,cAAgC,gBAAgB;AAAA,MACnD,MAAM,QAAQ,MAAWC,eAAqD;AAC1E,cAAM,YAAY,0BAA0B,MAAM,IAAI;AAGtD,cAAM,cAAc,MAAM,QAAQ,UAAU,UAAU,IAChD,UAAU,aACV,CAAC,UAAU,UAAU;AAE3B,cAAM,YAAY,MAAM,KAAK,YAAYA,eAAc,aAAa;AAAA,UAChE,SAAS,UAAU;AAAA,UACnB,SAAS,UAAU;AAAA,QACvB,CAAC;AAED,eAAO;AAAA,UACH,SAAS,CAAC;AAAA,YACN,MAAM;AAAA,YACN,MAAM,KAAK,gBAAgB,WAAW,WAAW;AAAA,UACrD,CAAC;AAAA,QACL;AAAA,MACJ;AAAA,MAEA,MAAc,YACV,QACA,aACA,SACwB;AACxB,YAAI,YAAY,WAAW,GAAG;AAC1B,iBAAO,KAAK,0BAA0B,QAAQ,YAAY,CAAC,GAAG,OAAO;AAAA,QACzE;AAEA,eAAO,KAAK,4BAA4B,QAAQ,aAAa,OAAO;AAAA,MACxE;AAAA,MAEA,MAAc,0BACV,QACA,YACA,SACwB;AACxB,YAAI;AACA,gBAAM,WAAW,KAAK,YAAY,MAAM;AACxC,gBAAM,WAAW,MAAM,SAAS,OAAO,KAAK;AAAA,YACxC;AAAA,YACA,SAAS,QAAQ;AAAA,YACjB,SAAS,QAAQ;AAAA,YACjB,cAAc;AAAA,YACd,SAAS;AAAA,UACb,CAAC;AAGD,kBAAQ,SAAS,KAAK,SAAS,CAAC,GAAG,IAAI,YAAU;AAAA,YAC7C,GAAG;AAAA,YACH;AAAA,UACJ,EAAE;AAAA,QACN,SAAS,OAAO;AACZ,gBAAM,KAAK,qBAAqB,KAAK;AAAA,QACzC;AAAA,MACJ;AAAA,MAEA,MAAc,4BACV,QACA,aACA,SACwB;AACxB,cAAM,eAAe,IAAI,oBAAoB,MAAM;AAEnD,cAAM,WAAW,YAAY,IAAI,iBAAe;AAAA,UAC5C,QAAQ;AAAA,UACR,MAAM,KAAK,gBAAgB,YAAY,OAAO;AAAA,QAClD,EAAE;AAEF,cAAM,YAAY,MAAM,aAAa,aAAa,QAAQ;AAE1D,cAAM,EAAE,QAAQ,OAAO,IAAI,KAAK,sBAAsB,WAAW,WAAW;AAE5E,YAAI,OAAO,SAAS,GAAG;AACnB,kBAAQ,KAAK,8BAA8B,OAAO,IAAI,OAAK,GAAG,EAAE,UAAU,KAAK,EAAE,KAAK,EAAE,CAAC;AAAA,QAC7F;AAEA,eAAO,KAAK,sBAAsB,MAAM;AAAA,MAC5C;AAAA,MAEQ,gBAAgB,YAAoB,SAAyD;AACjG,cAAM,SAAS,IAAI,gBAAgB;AAAA,UAC/B,cAAc;AAAA,UACd,SAAS;AAAA,UACT,GAAI,QAAQ,WAAW,EAAE,SAAS,QAAQ,QAAQ;AAAA,UAClD,GAAI,QAAQ,WAAW,EAAE,SAAS,QAAQ,QAAQ;AAAA,QACtD,CAAC;AAED,eAAO,0BAA0B,mBAAmB,UAAU,CAAC,WAAW,OAAO,SAAS,CAAC;AAAA,MAC/F;AAAA,MAEQ,sBACJ,WACA,aACiF;AACjF,cAAM,SAA0B,CAAC;AACjC,cAAM,SAAuD,CAAC;AAE9D,kBAAU,QAAQ,CAAC,UAAU,UAAU;AACnC,gBAAM,aAAa,YAAY,KAAK;AAEpC,cAAI,SAAS,eAAe,OAAO,SAAS,MAAM,OAAO;AACrD,kBAAM,iBAAkC,SAAS,KAAK,MAAM,IAAI,CAAC,WAAgB;AAAA,cAC7E,GAAG;AAAA,cACH;AAAA,YACJ,EAAE;AACF,mBAAO,KAAK,GAAG,cAAc;AAAA,UACjC,OAAO;AACH,kBAAM,eAAe,SAAS,MAAM,OAAO,WACxB,SAAS,MAAM,WACf,QAAQ,SAAS,UAAU;AAC9C,mBAAO,KAAK,EAAE,YAAY,OAAO,aAAa,CAAC;AAAA,UACnD;AAAA,QACJ,CAAC;AAED,eAAO,EAAE,QAAQ,OAAO;AAAA,MAC5B;AAAA,MAEQ,sBAAsB,QAA0C;AACpE,eAAO,OAAO,KAAK,CAAC,GAAG,MAAM;AACzB,gBAAM,SAAS,EAAE,OAAO,YAAY,EAAE,OAAO,QAAQ;AACrD,gBAAM,SAAS,EAAE,OAAO,YAAY,EAAE,OAAO,QAAQ;AACrD,iBAAO,OAAO,cAAc,MAAM;AAAA,QACtC,CAAC;AAAA,MACL;AAAA,MAEQ,gBAAgB,QAAyB,aAA+B;AAC5E,YAAI,OAAO,WAAW,GAAG;AACrB,iBAAO,sBAAsB,YAAY,MAAM;AAAA,QACnD;AAEA,YAAI,YAAY,WAAW,GAAG;AAC1B,iBAAO,gBAAgB,MAAM;AAAA,QACjC;AAEA,eAAO,KAAK,0BAA0B,QAAQ,WAAW;AAAA,MAC7D;AAAA,MAEQ,0BAA0B,QAAyB,aAA+B;AACtF,cAAM,UAAU,KAAK,sBAAsB,MAAM;AAEjD,YAAI,SAAS,SAAS,OAAO,MAAM,kBAAkB,YAAY,MAAM;AAAA;AAAA;AAEvE,mBAAW,CAAC,YAAY,SAAS,KAAK,OAAO,QAAQ,OAAO,GAAG;AAC3D,oBAAU,aAAa,UAAU;AAAA;AACjC,oBAAU,gBAAgB,SAAS;AACnC,oBAAU;AAAA,QACd;AAEA,eAAO;AAAA,MACX;AAAA,MAEQ,sBAAsB,QAA0D;AACpF,eAAO,OAAO,OAAO,CAAC,KAAK,UAAU;AACjC,gBAAM,QAAQ,MAAM;AACpB,cAAI,CAAC,IAAI,KAAK,EAAG,KAAI,KAAK,IAAI,CAAC;AAC/B,cAAI,KAAK,EAAE,KAAK,KAAK;AACrB,iBAAO;AAAA,QACX,GAAG,CAAC,CAAoC;AAAA,MAC5C;AAAA,IACJ;AAAA;AAAA;;;AClLA;AAAA;AAAA;AAAA;AAAA,IAOa;AAPb;AAAA;AAAA;AAAA;AAGA;AAIO,IAAM,uBAAN,cAAmC,gBAAgB;AAAA,MACxD,MAAM,QAAQ,MAAWC,eAAqD;AAE5E,cAAM,YAAY,6BAA6B,UAAU,IAAI;AAC7D,YAAI,CAAC,UAAU,SAAS;AACtB,gBAAM,IAAI;AAAA,YACN,4BAA4B,KAAK,UAAU,UAAU,MAAM,MAAM,CAAC;AAAA,UACtE;AAAA,QACF;AAEA,YAAG,CAAC,KAAK,sBAAsB,UAAU,KAAK,SAAQ,UAAU,KAAK,OAAO,GAAE;AAC5E,iBAAO;AAAA,YACL,SAAS,CAAC;AAAA,cACR,MAAM;AAAA,cACN,MAAM;AAAA,YACR,CAAC;AAAA,UACH;AAAA,QACF;AAEA,cAAM,SAAS,MAAM,KAAK,cAAcA,eAAc,UAAU,IAAI;AACpE,cAAM,cAAc,KAAK,4BAA4B,MAAM;AAE3D,eAAO;AAAA,UACL,SAAS,CAAC;AAAA,YACR,MAAM;AAAA,YACN,MAAM;AAAA,UACR,CAAC;AAAA,QACH;AAAA,MACF;AAAA,MAEA,MAAc,cACZ,QACA,MAC2B;AAC3B,YAAI;AACF,gBAAM,WAAW,KAAK,YAAY,MAAM;AACxC,gBAAM,WAAW,MAAM,SAAS,SAAS,MAAM;AAAA,YAC7C,aAAa;AAAA,cACX,SAAS,KAAK;AAAA,cACd,SAAS,KAAK;AAAA,cACd,UAAU,KAAK;AAAA,cACf,mBAAmB,KAAK;AAAA,cACxB,sBAAsB,KAAK;AAAA,cAC3B,OAAO,KAAK;AAAA,YACd;AAAA,UACF,CAAC;AACD,iBAAO,SAAS;AAAA,QAClB,SAAS,OAAO;AACd,gBAAM,KAAK,qBAAqB,KAAK;AAAA,QACvC;AAAA,MACF;AAAA,MAEQ,sBAAuB,SAAiB,SAA0B;AACxE,cAAM,UAAU,IAAI,KAAK,OAAO;AAChC,cAAM,UAAU,IAAI,KAAK,OAAO;AAEhC,cAAM,qBAAqB,QAAQ,QAAQ,IAAI,QAAQ,QAAQ;AAC/D,cAAM,4BAA4B,IAAI,KAAK,KAAK,KAAK,KAAK;AAG1D,eAAO,sBAAsB;AAAA,MAC/B;AAAA,MAEQ,4BAA4B,UAAoC;AACtE,eAAO,OAAO,QAAQ,SAAS,SAAS,EACrC,IAAI,CAAC,CAAC,OAAO,YAAY,MAAM;AAC9B,cAAI,aAAa,QAAQ,KAAK,WAAS,MAAM,WAAW,UAAU,GAAG;AACnE,mBAAO,iCAAiC,KAAK;AAAA;AAAA,UAC/C;AAEA,cAAI,aAAa,KAAK,WAAW,GAAG;AAClC,mBAAO,GAAG,KAAK,wBAAwB,SAAS,OAAO,OAAO,SAAS,OAAO,iCAAiC,KAAK;AAAA;AAAA,UACtH;AAEA,gBAAM,YAAY,aAAa,KAC5B,IAAI,UAAQ,UAAU,KAAK,KAAK,OAAO,KAAK,GAAG,EAAE,EACjD,KAAK,IAAI;AACZ,iBAAO,GAAG,KAAK;AAAA,EAAqB,SAAS;AAAA;AAAA,QAC/C,CAAC,EACA,KAAK,IAAI,EACT,KAAK;AAAA,MACV;AAAA,IACF;AAAA;AAAA;;;ACpFA,OAAO,aAAa;;;ACLpB,SAAS,oBAAoB;AAC7B,YAAY,QAAQ;;;ACDpB,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB,SAAS,qBAAqB;AAG9B,SAAS,iBAAyB;AAChC,QAAM,YAAiB,aAAQ,cAAc,YAAY,GAAG,CAAC;AAG7D,QAAM,cAAmB,UAAK,WAAW,IAAI;AAC7C,SAAY,aAAQ,WAAW;AACjC;AAIO,SAAS,qBAA6B;AAE3C,QAAM,kBAAkB,QAAQ,IAAI;AACpC,MAAI,iBAAiB;AACnB,WAAY,aAAQ,eAAe;AAAA,EACrC;AAGA,QAAM,aAAa,QAAQ,IAAI,mBACxB,UAAQ,WAAQ,GAAG,SAAS;AAEnC,QAAM,WAAgB,UAAK,YAAY,qBAAqB;AAC5D,SAAY,UAAK,UAAU,aAAa;AAC1C;AAGO,SAAS,qBAA6B;AAC3C,QAAM,cAAc,eAAe;AACnC,SAAY,UAAK,aAAa,wBAAwB;AACxD;AAKO,SAAS,kBAA0B;AAExC,QAAM,qBAAqB,QAAQ,IAAI;AACvC,MAAI,oBAAoB;AACtB,WAAY,aAAQ,kBAAkB;AAAA,EACxC;AAGA,QAAM,cAAc,eAAe;AACnC,QAAM,WAAgB,UAAK,aAAa,qBAAqB;AAC7D,SAAO;AACT;AAUO,SAAS,kCAA0C;AACxD,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAgBgB,mBAAmB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAY3C,KAAK;AACP;;;ADtFA,eAAe,0BAAqD;AAClE,QAAM,cAAc,MAAS,YAAS,gBAAgB,GAAG,OAAO;AAChE,QAAM,OAAO,KAAK,MAAM,WAAW;AAEnC,MAAI,KAAK,WAAW;AAElB,UAAM,EAAE,WAAW,eAAe,cAAc,IAAI,KAAK;AACzD,WAAO,EAAE,WAAW,eAAe,cAAc;AAAA,EACnD,WAAW,KAAK,aAAa,KAAK,eAAe;AAE/C,WAAO;AAAA,MACL,WAAW,KAAK;AAAA,MAChB,eAAe,KAAK;AAAA,MACpB,eAAe,KAAK,iBAAiB,CAAC,sCAAsC;AAAA,IAC9E;AAAA,EACF,OAAO;AACL,UAAM,IAAI,MAAM,+GAA+G;AAAA,EACjI;AACF;AAEA,eAAe,8BAAyD;AAEtE,QAAM,WAAW,QAAQ,IAAI;AAC7B,QAAM,eAAe,QAAQ,IAAI;AAEjC,MAAI,YAAY,cAAc;AAE5B,WAAO;AAAA,MACL,WAAW;AAAA,MACX,eAAe;AAAA,MACf,eAAe,CAAC,sCAAsC;AAAA,IACxD;AAAA,EACF;AAGA,MAAI;AACF,WAAO,MAAM,wBAAwB;AAAA,EACvC,SAAS,WAAW;AAElB,UAAM,eAAe,gCAAgC;AACrD,UAAM,IAAI,MAAM,GAAG,YAAY;AAAA;AAAA,kBAAuB,qBAAqB,QAAQ,UAAU,UAAU,SAAS,EAAE;AAAA,EACpH;AACF;AAEA,eAAsB,yBAAgD;AACpE,MAAI;AACF,UAAM,cAAc,MAAM,4BAA4B;AAGtD,UAAMC,gBAAe,IAAI,aAAa;AAAA,MACpC,UAAU,YAAY;AAAA,MACtB,cAAc,YAAY;AAAA,MAC1B,aAAa,YAAY,cAAc,CAAC;AAAA,IAC1C,CAAC;AAED,WAAOA;AAAA,EACT,SAAS,OAAO;AACd,UAAM,IAAI,MAAM,6BAA6B,iBAAiB,QAAQ,MAAM,UAAU,KAAK,EAAE;AAAA,EAC/F;AACF;;;AE9DA,YAAYC,SAAQ;AACpB,YAAYC,WAAU;AAEtB,SAAS,mBAAmB;AAErB,IAAM,eAAN,MAAmB;AAAA,EAChB;AAAA,EACA;AAAA,EAER,YAAYC,eAA4B;AACtC,SAAK,eAAeA;AACpB,SAAK,YAAY,mBAAmB;AACpC,SAAK,kBAAkB;AAAA,EACzB;AAAA;AAAA,EAGO,eAAuB;AAC5B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,MAAc,6BAA4C;AACxD,QAAI;AACA,YAAM,MAAW,cAAQ,KAAK,SAAS;AACvC,YAAS,UAAM,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,IAC3C,SAAS,OAAgB;AAErB,UAAI,iBAAiB,SAAS,UAAU,SAAS,MAAM,SAAS,UAAU;AACtE,gBAAQ,MAAM,qCAAqC,KAAK;AACxD,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACF;AAAA,EAEQ,oBAA0B;AAChC,SAAK,aAAa,GAAG,UAAU,OAAO,cAAc;AAClD,UAAI;AACF,cAAM,KAAK,2BAA2B;AACtC,cAAM,gBAAgB,KAAK,MAAM,MAAS,aAAS,KAAK,WAAW,OAAO,CAAC;AAC3E,cAAM,gBAAgB;AAAA,UACpB,GAAG;AAAA,UACH,GAAG;AAAA,UACH,eAAe,UAAU,iBAAiB,cAAc;AAAA,QAC1D;AACA,cAAS,cAAU,KAAK,WAAW,KAAK,UAAU,eAAe,MAAM,CAAC,GAAG;AAAA,UACzE,MAAM;AAAA,QACR,CAAC;AACD,gBAAQ,MAAM,0BAA0B;AAAA,MAC1C,SAAS,OAAgB;AAEvB,YAAI,iBAAiB,SAAS,UAAU,SAAS,MAAM,SAAS,UAAU;AACxE,cAAI;AACD,kBAAS,cAAU,KAAK,WAAW,KAAK,UAAU,WAAW,MAAM,CAAC,GAAG,EAAE,MAAM,IAAM,CAAC;AACtF,oBAAQ,MAAM,kBAAkB;AAAA,UACnC,SAAS,YAAY;AACnB,oBAAQ,MAAM,gCAAgC,UAAU;AAAA,UAC1D;AAAA,QACF,OAAO;AACH,kBAAQ,MAAM,gCAAgC,KAAK;AAAA,QACvD;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,sBAAwC;AACpD,UAAM,aAAa,mBAAmB;AACtC,QAAI;AAEF,UAAI,CAAE,MAAS,WAAO,UAAU,EAAE,KAAK,MAAM,IAAI,EAAE,MAAM,MAAM,KAAK,GAAI;AACtE,eAAO;AAAA,MACT;AAGA,YAAM,eAAe,KAAK,MAAM,MAAS,aAAS,YAAY,OAAO,CAAC;AAEtE,UAAI,CAAC,gBAAgB,OAAO,iBAAiB,UAAU;AACrD,gBAAQ,MAAM,iDAAiD;AAC/D,eAAO;AAAA,MACT;AAGA,YAAM,KAAK,2BAA2B;AAGtC,YAAS,cAAU,KAAK,WAAW,KAAK,UAAU,cAAc,MAAM,CAAC,GAAG;AAAA,QACxE,MAAM;AAAA,MACR,CAAC;AAED,cAAQ,MAAM,yCAAyC,YAAY,OAAO,KAAK,SAAS;AAGxF,UAAI;AACF,cAAS,WAAO,UAAU;AAC1B,gBAAQ,MAAM,2BAA2B;AAAA,MAC3C,SAAS,WAAW;AAClB,gBAAQ,MAAM,gDAAgD,SAAS;AAAA,MACzE;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,MAAM,kCAAkC,KAAK;AACrD,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,MAAM,kBAAoC;AACxC,QAAI;AACF,YAAM,KAAK,2BAA2B;AAGtC,YAAM,cAAc,MAAS,WAAO,KAAK,SAAS,EAAE,KAAK,MAAM,IAAI,EAAE,MAAM,MAAM,KAAK;AAGtF,UAAI,CAAC,aAAa;AAChB,cAAM,WAAW,MAAM,KAAK,oBAAoB;AAChD,YAAI,CAAC,UAAU;AACb,kBAAQ,MAAM,2BAA2B,KAAK,SAAS;AACvD,iBAAO;AAAA,QACT;AAAA,MACF;AAEA,YAAM,SAAS,KAAK,MAAM,MAAS,aAAS,KAAK,WAAW,OAAO,CAAC;AAEpE,UAAI,CAAC,UAAU,OAAO,WAAW,UAAU;AACzC,gBAAQ,MAAM,iCAAiC,KAAK,SAAS;AAC7D,eAAO;AAAA,MACT;AAEA,WAAK,aAAa,eAAe,MAAM;AACvC,aAAO;AAAA,IACT,SAAS,OAAgB;AACvB,cAAQ,MAAM,yBAAyB,KAAK;AAE5C,UAAI,iBAAiB,SAAS,UAAU,SAAS,MAAM,SAAS,UAAU;AACtE,YAAI;AACA,gBAAS,WAAO,KAAK,SAAS;AAC9B,kBAAQ,MAAM,0CAA0C;AAAA,QAC1D,SAAS,WAAW;AAAA,QAAe;AAAA,MACzC;AACA,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,MAAM,wBAA0C;AAC9C,UAAM,aAAa,KAAK,aAAa,YAAY;AACjD,UAAM,YAAY,aACd,KAAK,IAAI,KAAK,aAAa,IAAI,KAAK,MACpC,CAAC,KAAK,aAAa,YAAY;AAEnC,QAAI,aAAa,KAAK,aAAa,YAAY,eAAe;AAC5D,cAAQ,MAAM,qDAAqD;AACnE,UAAI;AACF,cAAM,WAAW,MAAM,KAAK,aAAa,mBAAmB;AAC5D,cAAM,YAAY,SAAS;AAE3B,YAAI,CAAC,UAAU,cAAc;AAC3B,gBAAM,IAAI,MAAM,wCAAwC;AAAA,QAC1D;AAEA,aAAK,aAAa,eAAe,SAAS;AAC1C,gBAAQ,MAAM,8BAA8B;AAC5C,eAAO;AAAA,MACT,SAAS,cAAc;AACrB,YAAI,wBAAwB,eAAe,aAAa,UAAU,MAAM,UAAU,iBAAiB;AAC/F,kBAAQ,MAAM,sGAAsG;AAGpH,iBAAO;AAAA,QACX,OAAO;AAEH,kBAAQ,MAAM,gCAAgC,YAAY;AAC1D,iBAAO;AAAA,QACX;AAAA,MACF;AAAA,IACF,WAAW,CAAC,KAAK,aAAa,YAAY,gBAAgB,CAAC,KAAK,aAAa,YAAY,eAAe;AACpG,cAAQ,MAAM,+DAA+D;AAC7E,aAAO;AAAA,IACX,OAAO;AAEH,aAAO;AAAA,IACX;AAAA,EACF;AAAA,EAEA,MAAM,iBAAmC;AACvC,QAAI,CAAC,KAAK,aAAa,eAAe,CAAC,KAAK,aAAa,YAAY,cAAc;AAE/E,UAAI,CAAE,MAAM,KAAK,gBAAgB,GAAI;AACjC,eAAO;AAAA,MACX;AAEA,UAAI,CAAC,KAAK,aAAa,eAAe,CAAC,KAAK,aAAa,YAAY,cAAc;AAC/E,eAAO;AAAA,MACX;AAAA,IACJ;AACA,WAAO,KAAK,sBAAsB;AAAA,EACpC;AAAA,EAEA,MAAM,WAAW,QAAoC;AACnD,QAAI;AACA,YAAM,KAAK,2BAA2B;AACtC,YAAS,cAAU,KAAK,WAAW,KAAK,UAAU,QAAQ,MAAM,CAAC,GAAG,EAAE,MAAM,IAAM,CAAC;AACnF,WAAK,aAAa,eAAe,MAAM;AACvC,cAAQ,MAAM,iCAAiC,KAAK,SAAS;AAAA,IACjE,SAAS,OAAgB;AACrB,cAAQ,MAAM,wBAAwB,KAAK;AAC3C,YAAM;AAAA,IACV;AAAA,EACF;AAAA,EAEA,MAAM,cAA6B;AACjC,QAAI;AACF,WAAK,aAAa,eAAe,CAAC,CAAC;AACnC,YAAS,WAAO,KAAK,SAAS;AAC9B,cAAQ,MAAM,6BAA6B;AAAA,IAC7C,SAAS,OAAgB;AACvB,UAAI,iBAAiB,SAAS,UAAU,SAAS,MAAM,SAAS,UAAU;AAExE,gBAAQ,MAAM,4BAA4B;AAAA,MAC5C,OAAO;AACL,gBAAQ,MAAM,0BAA0B,KAAK;AAAA,MAE/C;AAAA,IACF;AAAA,EACF;AACF;;;AC9NA;AAGO,IAAM,uBAAN,cAAmC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,GAAQC,eAAqD;AACvE,UAAM,YAAY,MAAM,KAAK,cAAcA,aAAY;AACvD,WAAO;AAAA,MACH,SAAS,CAAC;AAAA,QACN,MAAM;AAAA;AAAA,QACN,MAAM,KAAK,mBAAmB,SAAS;AAAA,MAC3C,CAAC;AAAA,IACL;AAAA,EACJ;AAAA,EAEA,MAAc,cAAc,QAAuE;AAC/F,QAAI;AACA,YAAM,WAAW,KAAK,YAAY,MAAM;AACxC,YAAM,WAAW,MAAM,SAAS,aAAa,KAAK;AAClD,aAAO,SAAS,KAAK,SAAS,CAAC;AAAA,IACnC,SAAS,OAAO;AACZ,YAAM,KAAK,qBAAqB,KAAK;AAAA,IACzC;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAMQ,mBAAmB,WAA2D;AAClF,WAAO,UACF,IAAI,CAAC,QAAQ,GAAG,IAAI,WAAW,UAAU,KAAK,IAAI,MAAM,OAAO,GAAG,EAClE,KAAK,IAAI;AAAA,EAClB;AAEJ;;;AChCA;;;ACFA;AACA;AAGA;AAEO,IAAM,sBAAN,cAAkC,gBAAgB;AAAA,EACrD,MAAM,QAAQ,MAAWC,eAAqD;AAC1E,UAAM,YAAY,4BAA4B,MAAM,IAAI;AACxD,UAAM,SAAS,MAAM,KAAK,aAAaA,eAAc,SAAS;AAC9D,WAAO;AAAA,MACH,SAAS,CAAC;AAAA,QACN,MAAM;AAAA,QACN,MAAM,gBAAgB,MAAM;AAAA,MAChC,CAAC;AAAA,IACL;AAAA,EACJ;AAAA,EAEA,MAAc,aACV,QACA,MACmC;AACnC,QAAI;AACA,YAAM,WAAW,KAAK,YAAY,MAAM;AACxC,YAAM,WAAW,MAAM,SAAS,OAAO,KAAK;AAAA,QACxC,YAAY,KAAK;AAAA,QACjB,GAAG,KAAK;AAAA,QACR,SAAS,KAAK;AAAA,QACd,SAAS,KAAK;AAAA,QACd,cAAc;AAAA,QACd,SAAS;AAAA,MACb,CAAC;AACD,aAAO,SAAS,KAAK,SAAS,CAAC;AAAA,IACnC,SAAS,OAAO;AACZ,YAAM,KAAK,qBAAqB,KAAK;AAAA,IACzC;AAAA,EACJ;AACJ;;;ACrCA;AAGO,IAAM,oBAAN,cAAgC,gBAAgB;AAAA,EACnD,MAAM,QAAQ,GAAQC,eAAqD;AACvE,UAAM,SAAS,MAAM,KAAK,WAAWA,aAAY;AACjD,WAAO;AAAA,MACH,SAAS,CAAC;AAAA,QACN,MAAM;AAAA,QACN,MAAM;AAAA,EAA4B,KAAK,gBAAgB,MAAM,CAAC;AAAA,MAClE,CAAC;AAAA,IACL;AAAA,EACJ;AAAA,EAEA,MAAc,WAAW,QAA0D;AAC/E,QAAI;AACA,YAAM,WAAW,KAAK,YAAY,MAAM;AACxC,YAAM,WAAW,MAAM,SAAS,OAAO,IAAI;AAC3C,UAAI,CAAC,SAAS,KAAM,OAAM,IAAI,MAAM,2BAA2B;AAC/D,aAAO,SAAS;AAAA,IACpB,SAAS,OAAO;AACZ,YAAM,KAAK,qBAAqB,KAAK;AAAA,IACzC;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,QAA2C;AAC/D,UAAM,cAAc,OAAO,SAAS,CAAC;AACrC,WAAO,OAAO,QAAQ,WAAW,EAC5B,IAAI,CAAC,CAAC,IAAI,SAAS,MAAM,aAAa,EAAE,MAAM,UAAU,UAAU,mBAAmB,UAAU,UAAU,eAAe,EACxH,KAAK,IAAI;AAAA,EAClB;AACJ;;;AClCA;AACA;AAIO,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACpD,MAAM,QAAQ,MAAWC,eAAqD;AAC1E,UAAM,YAAY,2BAA2B,MAAM,IAAI;AACvD,UAAM,QAAQ,MAAM,KAAK,YAAYA,eAAc,SAAS;AAC5D,WAAO;AAAA,MACH,SAAS,CAAC;AAAA,QACN,MAAM;AAAA,QACN,MAAM,kBAAkB,MAAM,OAAO,KAAK,MAAM,EAAE;AAAA,MACtD,CAAC;AAAA,IACL;AAAA,EACJ;AAAA,EAEA,MAAc,YACV,QACA,MACiC;AACjC,QAAI;AACA,YAAM,WAAW,KAAK,YAAY,MAAM;AACxC,YAAM,cAAwC;AAAA,QAC1C,SAAS,KAAK;AAAA,QACd,aAAa,KAAK;AAAA,QAClB,OAAO,EAAE,UAAU,KAAK,OAAO,UAAU,KAAK,SAAS;AAAA,QACvD,KAAK,EAAE,UAAU,KAAK,KAAK,UAAU,KAAK,SAAS;AAAA,QACnD,WAAW,KAAK;AAAA,QAChB,UAAU,KAAK;AAAA,QACf,SAAS,KAAK;AAAA,QACd,WAAW,KAAK;AAAA,QAChB,YAAY,KAAK;AAAA,MACrB;AAGA,UAAI,KAAK,gBAAgB;AACrB,oBAAY,iBAAiB,KAAK;AAAA,MACtC,WAAW,KAAK,aAAa,KAAK,UAAU,SAAS,GAAG;AAGpD,cAAM,YAAY,QAAQ,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,UAAU,CAAC,CAAC;AAC/E,oBAAY,iBAAiB;AAAA,UACzB,eAAe;AAAA,YACX;AAAA,YACA,uBAAuB;AAAA,cACnB,MAAM;AAAA,YACV;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAGA,YAAM,sBAAsB,KAAK,kBAAmB,KAAK,aAAa,KAAK,UAAU,SAAS;AAG9F,YAAM,gBAAqB;AAAA,QACvB,YAAY,KAAK;AAAA,QACjB;AAAA,MACJ;AAGA,UAAI,qBAAqB;AACrB,sBAAc,wBAAwB;AAAA,MAC1C;AAGA,UAAI,KAAK,aAAa,KAAK,UAAU,SAAS,GAAG;AAC7C,sBAAc,cAAc,KAAK,eAAe;AAAA,MACpD;AAGA,YAAM,WAAW,MAAM,SAAS,OAAO,OAAO,aAAa;AAE3D,UAAI,CAAC,SAAS,KAAM,OAAM,IAAI,MAAM,0CAA0C;AAC9E,aAAO,SAAS;AAAA,IACpB,SAAS,OAAY;AAEjB,UAAI,MAAM,SAAS,gBAAgB,MAAM,SAAS,aAAa;AAC3D,YAAI;AAEA,gBAAM,IAAI,QAAQ,CAAAC,aAAW,WAAWA,UAAS,GAAI,CAAC;AAEtD,gBAAM,WAAW,KAAK,YAAY,MAAM;AACxC,gBAAM,MAAM,oBAAI,KAAK;AACrB,gBAAM,SAAS,MAAM,SAAS,OAAO,KAAK;AAAA,YACtC,YAAY,KAAK;AAAA,YACjB,SAAS,IAAI,KAAK,IAAI,QAAQ,IAAI,GAAK,EAAE,YAAY;AAAA;AAAA,YACrD,cAAc;AAAA,YACd,SAAS;AAAA,YACT,YAAY;AAAA,UAChB,CAAC;AAGD,gBAAM,eAAe,OAAO,KAAK,OAAO;AAAA,YACpC,WAAS,MAAM,YAAY,KAAK,WACxB,MAAM,OAAO,aAAa,KAAK,SAC/B,MAAM,KAAK,aAAa,KAAK;AAAA,UACzC;AAEA,cAAI,cAAc;AAEd,mBAAO;AAAA,UACX;AAAA,QACJ,SAAS,YAAY;AAAA,QAErB;AAAA,MACJ;AAEA,YAAM,KAAK,qBAAqB,KAAK;AAAA,IACzC;AAAA,EACJ;AACJ;;;AChHA;AACA;;;ACDO,IAAM,wBAAN,MAA4B;AAAA,EACzB;AAAA,EAER,YAAY,UAAgC;AAC1C,SAAK,WAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAoC;AAClC,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAAgB,SAAiB,YAAqD;AAC1F,UAAM,WAAW,MAAM,KAAK,SAAS,OAAO,IAAI;AAAA,MAC9C;AAAA,MACA;AAAA,IACF,CAAC;AAED,UAAM,QAAQ,SAAS;AACvB,WAAO,MAAM,cAAc,MAAM,WAAW,SAAS,IAAI,cAAc;AAAA,EACzE;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,SAAiB,mBAAmC;AAEnE,UAAM,UAAU,IAAI,KAAK,iBAAiB;AAC1C,UAAM,kBAAkB,QAAQ,YAAY,EAAE,QAAQ,SAAS,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC,IAAI;AAEnF,WAAO,GAAG,OAAO,IAAI,eAAe;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,iBAAiC;AAClD,UAAM,aAAa,IAAI,KAAK,eAAe;AAC3C,UAAM,YAAY,IAAI,KAAK,WAAW,QAAQ,IAAI,KAAQ;AAC1D,WAAO,UAAU,YAAY,EAAE,QAAQ,SAAS,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC,IAAI;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,cAAsB,eAAiD;AACtF,UAAM,WAAW,IAAI,KAAK,YAAY;AACtC,UAAM,gBAAgB,IAAI,KAAK,cAAc,MAAO,QAAS;AAC7D,UAAM,cAAc,IAAI,KAAK,cAAc,IAAK,QAAS;AACzD,UAAM,WAAW,YAAY,QAAQ,IAAI,cAAc,QAAQ;AAE/D,WAAO,IAAI,KAAK,SAAS,QAAQ,IAAI,QAAQ,EAAE,YAAY;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,0BAA0B,YAAsB,WAA6B;AAC3E,QAAI,CAAC,cAAc,WAAW,WAAW,GAAG;AAC1C,YAAM,IAAI,MAAM,0BAA0B;AAAA,IAC5C;AAEA,UAAM,oBAA8B,CAAC;AACrC,QAAI,aAAa;AAEjB,eAAW,QAAQ,YAAY;AAC7B,UAAI,KAAK,WAAW,QAAQ,GAAG;AAC7B,qBAAa;AACb,cAAM,cAAc,KACjB,QAAQ,wBAAwB,EAAE,EAClC,QAAQ,eAAe,EAAE,IACxB,UAAU,SAAS;AACvB,0BAAkB,KAAK,WAAW;AAAA,MACpC,OAAO;AAEL,0BAAkB,KAAK,IAAI;AAAA,MAC7B;AAAA,IACF;AAEA,QAAI,CAAC,YAAY;AACf,YAAM,IAAI,MAAM,oCAAoC;AAAA,IACtD;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAyB,OAA2D;AAClF,UAAM,eAAe,EAAE,GAAG,MAAM;AAGhC,WAAO,aAAa;AACpB,WAAO,aAAa;AACpB,WAAO,aAAa;AACpB,WAAO,aAAa;AACpB,WAAO,aAAa;AACpB,WAAO,aAAa;AACpB,WAAO,aAAa;AAEpB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAuB,MAAqC;AAC1D,UAAM,cAAwC,CAAC;AAE/C,QAAI,KAAK,YAAY,UAAa,KAAK,YAAY,KAAM,aAAY,UAAU,KAAK;AACpF,QAAI,KAAK,gBAAgB,UAAa,KAAK,gBAAgB,KAAM,aAAY,cAAc,KAAK;AAChG,QAAI,KAAK,aAAa,UAAa,KAAK,aAAa,KAAM,aAAY,WAAW,KAAK;AACvF,QAAI,KAAK,YAAY,UAAa,KAAK,YAAY,KAAM,aAAY,UAAU,KAAK;AACpF,QAAI,KAAK,cAAc,UAAa,KAAK,cAAc,KAAM,aAAY,YAAY,KAAK;AAC1F,QAAI,KAAK,cAAc,UAAa,KAAK,cAAc,KAAM,aAAY,YAAY,KAAK;AAC1F,QAAI,KAAK,eAAe,UAAa,KAAK,eAAe,KAAM,aAAY,aAAa,KAAK;AAG7F,QAAI,cAAc;AAClB,QAAI,KAAK,UAAU,UAAa,KAAK,UAAU,MAAM;AACnD,kBAAY,QAAQ,EAAE,UAAU,KAAK,OAAO,UAAU,KAAK,SAAS;AACpE,oBAAc;AAAA,IAChB;AACA,QAAI,KAAK,QAAQ,UAAa,KAAK,QAAQ,MAAM;AAC/C,kBAAY,MAAM,EAAE,UAAU,KAAK,KAAK,UAAU,KAAK,SAAS;AAChE,oBAAc;AAAA,IAChB;AAGA,QAAI,eAAgB,CAAC,KAAK,SAAS,CAAC,KAAK,OAAO,KAAK,UAAW;AAC9D,UAAI,CAAC,YAAY,MAAO,aAAY,QAAQ,CAAC;AAC7C,UAAI,CAAC,YAAY,IAAK,aAAY,MAAM,CAAC;AACzC,UAAI,CAAC,YAAY,MAAM,SAAU,aAAY,MAAM,WAAW,KAAK;AACnE,UAAI,CAAC,YAAY,IAAI,SAAU,aAAY,IAAI,WAAW,KAAK;AAAA,IACjE;AAEA,WAAO;AAAA,EACT;AACF;AAKO,IAAM,sBAAN,cAAkC,MAAM;AAAA,EACtC;AAAA,EAEP,YAAY,SAAiB,MAAc;AACzC,UAAM,OAAO;AACb,SAAK,OAAO;AACZ,SAAK,OAAO;AAAA,EACd;AACF;AAEO,IAAM,yBAAyB;AAAA,EACpC,eAAe;AAAA,EACf,uBAAuB;AAAA,EACvB,qBAAqB;AAAA,EACrB,kBAAkB;AAAA,EAClB,qBAAqB;AACvB;;;AD/JO,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACpD,MAAM,QAAQ,MAAWC,eAAqD;AAC1E,UAAM,YAAY,2BAA2B,MAAM,IAAI;AACvD,UAAM,QAAQ,MAAM,KAAK,qBAAqBA,eAAc,SAAS;AACrE,WAAO;AAAA,MACH,SAAS,CAAC;AAAA,QACN,MAAM;AAAA,QACN,MAAM,kBAAkB,MAAM,OAAO,KAAK,MAAM,EAAE;AAAA,MACtD,CAAC;AAAA,IACL;AAAA,EACJ;AAAA,EAEA,MAAc,qBACV,QACA,MACiC;AACjC,QAAI;AACA,YAAM,WAAW,KAAK,YAAY,MAAM;AACxC,YAAM,UAAU,IAAI,sBAAsB,QAAQ;AAGlD,YAAM,YAAY,MAAM,QAAQ,gBAAgB,KAAK,SAAS,KAAK,UAAU;AAE7E,UAAI,KAAK,sBAAsB,SAAS,cAAc,aAAa;AAC/D,cAAM,IAAI;AAAA,UACN;AAAA,UACA,uBAAuB;AAAA,QAC3B;AAAA,MACJ;AAEA,cAAQ,KAAK,mBAAmB;AAAA,QAC5B,KAAK;AACD,iBAAO,KAAK,qBAAqB,SAAS,IAAI;AAAA,QAClD,KAAK;AACD,iBAAO,KAAK,mBAAmB,SAAS,IAAI;AAAA,QAChD,KAAK;AACD,iBAAO,KAAK,sBAAsB,SAAS,IAAI;AAAA,QACnD;AACI,gBAAM,IAAI;AAAA,YACN,+BAA+B,KAAK,iBAAiB;AAAA,YACrD,uBAAuB;AAAA,UAC3B;AAAA,MACR;AAAA,IACJ,SAAS,OAAO;AACZ,UAAI,iBAAiB,qBAAqB;AACtC,cAAM;AAAA,MACV;AACA,YAAM,KAAK,qBAAqB,KAAK;AAAA,IACzC;AAAA,EACJ;AAAA,EAEA,MAAc,qBACV,SACA,MACiC;AACjC,QAAI,CAAC,KAAK,mBAAmB;AACzB,YAAM,IAAI;AAAA,QACN;AAAA,QACA,uBAAuB;AAAA,MAC3B;AAAA,IACJ;AAEA,UAAM,WAAW,QAAQ,YAAY;AACrC,UAAM,aAAa,QAAQ,iBAAiB,KAAK,SAAS,KAAK,iBAAiB;AAEhF,UAAM,WAAW,MAAM,SAAS,OAAO,MAAM;AAAA,MACzC,YAAY,KAAK;AAAA,MACjB,SAAS;AAAA,MACT,aAAa,QAAQ,uBAAuB,IAAI;AAAA,IACpD,CAAC;AAED,QAAI,CAAC,SAAS,KAAM,OAAM,IAAI,MAAM,iCAAiC;AACrE,WAAO,SAAS;AAAA,EACpB;AAAA,EAEA,MAAc,mBACV,SACA,MACiC;AACjC,UAAM,WAAW,QAAQ,YAAY;AAErC,UAAM,WAAW,MAAM,SAAS,OAAO,MAAM;AAAA,MACzC,YAAY,KAAK;AAAA,MACjB,SAAS,KAAK;AAAA,MACd,aAAa,QAAQ,uBAAuB,IAAI;AAAA,IACpD,CAAC;AAED,QAAI,CAAC,SAAS,KAAM,OAAM,IAAI,MAAM,wBAAwB;AAC5D,WAAO,SAAS;AAAA,EACpB;AAAA,EAEA,MAAc,sBACV,SACA,MACiC;AACjC,QAAI,CAAC,KAAK,iBAAiB;AACvB,YAAM,IAAI;AAAA,QACN;AAAA,QACA,uBAAuB;AAAA,MAC3B;AAAA,IACJ;AAEA,UAAM,WAAW,QAAQ,YAAY;AAGrC,UAAM,mBAAmB,MAAM,SAAS,OAAO,IAAI;AAAA,MAC/C,YAAY,KAAK;AAAA,MACjB,SAAS,KAAK;AAAA,IAClB,CAAC;AACD,UAAM,gBAAgB,iBAAiB;AAEvC,QAAI,CAAC,cAAc,YAAY;AAC3B,YAAM,IAAI,MAAM,sCAAsC;AAAA,IAC1D;AAGA,UAAM,YAAY,QAAQ,mBAAmB,KAAK,eAAe;AACjE,UAAM,oBAAoB,QAAQ,0BAA0B,cAAc,YAAY,SAAS;AAE/F,UAAM,SAAS,OAAO,MAAM;AAAA,MACxB,YAAY,KAAK;AAAA,MACjB,SAAS,KAAK;AAAA,MACd,aAAa,EAAE,YAAY,kBAAkB;AAAA,IACjD,CAAC;AAGD,UAAM,cAAc,QAAQ,uBAAuB,IAAI;AAGvD,QAAI,UAAU,KAAK;AACnB,QAAI,KAAK,SAAS,KAAK,iBAAiB;AACpC,YAAM,eAAe,KAAK,SAAS,KAAK;AACxC,gBAAU,WAAW,QAAQ,iBAAiB,cAAc,aAAa;AAAA,IAC7E;AAEA,UAAM,WAAW;AAAA,MACb,GAAG,QAAQ,yBAAyB,aAAa;AAAA,MACjD,GAAG;AAAA,MACH,OAAO;AAAA,QACH,UAAU,KAAK,SAAS,KAAK;AAAA,QAC7B,UAAU,KAAK;AAAA,MACnB;AAAA,MACA,KAAK;AAAA,QACD,UAAU;AAAA,QACV,UAAU,KAAK;AAAA,MACnB;AAAA,IACJ;AAEA,UAAM,WAAW,MAAM,SAAS,OAAO,OAAO;AAAA,MAC1C,YAAY,KAAK;AAAA,MACjB,aAAa;AAAA,IACjB,CAAC;AAED,QAAI,CAAC,SAAS,KAAM,OAAM,IAAI,MAAM,sCAAsC;AAC1E,WAAO,SAAS;AAAA,EACpB;AAAA;AAAA,EAGA,MAAc,YACV,QACA,MACiC;AAEjC,WAAO,KAAK,qBAAqB,QAAQ,IAAI;AAAA,EACjD;AACJ;;;AE3KA;AACA;AAGO,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACpD,MAAM,QAAQ,MAAWC,eAAqD;AAC1E,UAAM,YAAY,2BAA2B,MAAM,IAAI;AACvD,UAAM,KAAK,YAAYA,eAAc,SAAS;AAC9C,WAAO;AAAA,MACH,SAAS,CAAC;AAAA,QACN,MAAM;AAAA,QACN,MAAM;AAAA,MACV,CAAC;AAAA,IACL;AAAA,EACJ;AAAA,EAEA,MAAc,YACV,QACA,MACa;AACb,QAAI;AACA,YAAM,WAAW,KAAK,YAAY,MAAM;AACxC,YAAM,SAAS,OAAO,OAAO;AAAA,QACzB,YAAY,KAAK;AAAA,QACjB,SAAS,KAAK;AAAA,MAClB,CAAC;AAAA,IACL,SAAS,OAAO;AACZ,YAAM,KAAK,qBAAqB,KAAK;AAAA,IACzC;AAAA,EACJ;AACJ;;;ANtBA;;;AOPA;AADA,SAAS,UAAAC,eAAyB;AAW3B,IAAM,sBAAN,cAAkC,gBAAgB;AAAA,EACvD,MAAM,QAAQ,MAAwBC,eAAqD;AACzF,QAAI;AACF,YAAM,SAASD,QAAO,OAAO,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGlE,YAAM,eAAe,KAAK,gBAAgB,KAAK,aAAa,SAAS,IACjE,KAAK,aAAa,KAAK,GAAG,IAC1B;AAGJ,YAAM,UAAU,KAAK,WAAW,KAAK,QAAQ,SAAS,IAClD,KAAK,UACL,CAAC,0BAA0B;AAE/B,YAAM,WAAW,MAAM,OAAO,OAAO,YAAY,KAAK;AAAA,QACpD,cAAc;AAAA,QACd,UAAU,KAAK,YAAY;AAAA,QAC3B,WAAW,KAAK;AAAA,QAChB;AAAA,QACA;AAAA,QACA,GAAI,KAAK,SAAS,EAAE,OAAO,KAAK,MAAM;AAAA,MACxC,CAAC;AAED,YAAM,WAAW,SAAS,KAAK,eAAe,CAAC;AAC/C,YAAM,oBAAoB,SAAS,IAAI,aAAW,KAAK,cAAc,OAAO,CAAC;AAE7E,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,UAAU;AAAA,cACV,YAAY,SAAS,KAAK,cAAc,kBAAkB;AAAA,cAC1D,eAAe,SAAS,KAAK,iBAAiB;AAAA,YAChD,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,cAAc,SAAuC;AAC3D,WAAO;AAAA,MACL,cAAc,QAAQ;AAAA,MACtB,MAAM,QAAQ;AAAA,MACd,OAAO,QAAQ,OAAO,IAAI,WAAS;AAAA,QACjC,aAAa,KAAK;AAAA,QAClB,YAAY,KAAK;AAAA,QACjB,WAAW,KAAK;AAAA,QAChB,YAAY,KAAK;AAAA,QACjB,iBAAiB,KAAK;AAAA,QACtB,iBAAiB,KAAK;AAAA,MACxB,EAAE;AAAA,MACF,gBAAgB,QAAQ,gBAAgB,IAAI,YAAU;AAAA,QACpD,OAAO,MAAM;AAAA,QACb,MAAM,MAAM;AAAA,QACZ,eAAe,MAAM;AAAA,MACvB,EAAE;AAAA,MACF,cAAc,QAAQ,cAAc,IAAI,YAAU;AAAA,QAChD,OAAO,MAAM;AAAA,QACb,MAAM,MAAM;AAAA,QACZ,eAAe,MAAM;AAAA,MACvB,EAAE;AAAA,MACF,WAAW,QAAQ,WAAW,IAAI,cAAY;AAAA,QAC5C,gBAAgB,QAAQ;AAAA,QACxB,MAAM,QAAQ;AAAA,QACd,eAAe,QAAQ;AAAA,QACvB,eAAe,QAAQ;AAAA,QACvB,MAAM,QAAQ;AAAA,QACd,QAAQ,QAAQ;AAAA,QAChB,YAAY,QAAQ;AAAA,QACpB,SAAS,QAAQ;AAAA,QACjB,aAAa,QAAQ;AAAA,MACvB,EAAE;AAAA,MACF,eAAe,QAAQ,eAAe,IAAI,UAAQ;AAAA,QAChD,MAAM,IAAI;AAAA,QACV,OAAO,IAAI;AAAA,QACX,YAAY,IAAI;AAAA,QAChB,MAAM,IAAI;AAAA,QACV,eAAe,IAAI;AAAA,MACrB,EAAE;AAAA,MACF,aAAa,QAAQ,aAAa,IAAI,UAAQ;AAAA,QAC5C,OAAO,IAAI;AAAA,QACX,aAAa,IAAI;AAAA,MACnB,EAAE;AAAA,MACF,QAAQ,QAAQ,QAAQ,IAAI,YAAU;AAAA,QACpC,KAAK,MAAM;AAAA,QACX,SAAS,MAAM;AAAA,MACjB,EAAE;AAAA,IACJ;AAAA,EACF;AACF;;;ACzGA;AADA,SAAS,UAAAC,eAAyB;AAQ3B,IAAM,oBAAN,cAAgC,gBAAgB;AAAA,EACrD,MAAM,QAAQ,MAAsBC,eAAqD;AACvF,QAAI;AACF,YAAM,SAASD,QAAO,OAAO,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGlE,YAAM,eAAe,KAAK,gBAAgB,KAAK,aAAa,SAAS,IACjE,KAAK,aAAa,KAAK,GAAG,IAC1B;AAEJ,YAAM,WAAW,MAAM,OAAO,OAAO,IAAI;AAAA,QACvC,cAAc,KAAK;AAAA,QACnB;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS,KAAK,cAAc,SAAS,IAAI;AAAA,YAC3C,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,cAAc,SAAuC;AAC3D,WAAO;AAAA,MACL,cAAc,QAAQ;AAAA,MACtB,MAAM,QAAQ;AAAA,MACd,UAAU,QAAQ;AAAA,MAClB,OAAO,QAAQ,OAAO,IAAI,WAAS;AAAA,QACjC,aAAa,KAAK;AAAA,QAClB,YAAY,KAAK;AAAA,QACjB,WAAW,KAAK;AAAA,QAChB,YAAY,KAAK;AAAA,QACjB,iBAAiB,KAAK;AAAA,QACtB,iBAAiB,KAAK;AAAA,QACtB,UAAU,KAAK;AAAA,MACjB,EAAE;AAAA,MACF,gBAAgB,QAAQ,gBAAgB,IAAI,YAAU;AAAA,QACpD,OAAO,MAAM;AAAA,QACb,MAAM,MAAM;AAAA,QACZ,eAAe,MAAM;AAAA,QACrB,UAAU,MAAM;AAAA,MAClB,EAAE;AAAA,MACF,cAAc,QAAQ,cAAc,IAAI,YAAU;AAAA,QAChD,OAAO,MAAM;AAAA,QACb,MAAM,MAAM;AAAA,QACZ,eAAe,MAAM;AAAA,QACrB,eAAe,MAAM;AAAA,QACrB,UAAU,MAAM;AAAA,MAClB,EAAE;AAAA,MACF,WAAW,QAAQ,WAAW,IAAI,cAAY;AAAA,QAC5C,gBAAgB,QAAQ;AAAA,QACxB,MAAM,QAAQ;AAAA,QACd,eAAe,QAAQ;AAAA,QACvB,eAAe,QAAQ;AAAA,QACvB,iBAAiB,QAAQ;AAAA,QACzB,OAAO,QAAQ;AAAA,QACf,MAAM,QAAQ;AAAA,QACd,QAAQ,QAAQ;AAAA,QAChB,YAAY,QAAQ;AAAA,QACpB,SAAS,QAAQ;AAAA,QACjB,aAAa,QAAQ;AAAA,QACrB,UAAU,QAAQ;AAAA,MACpB,EAAE;AAAA,MACF,eAAe,QAAQ,eAAe,IAAI,UAAQ;AAAA,QAChD,MAAM,IAAI;AAAA,QACV,cAAc,IAAI;AAAA,QAClB,OAAO,IAAI;AAAA,QACX,YAAY,IAAI;AAAA,QAChB,QAAQ,IAAI;AAAA,QACZ,UAAU,IAAI;AAAA,QACd,MAAM,IAAI;AAAA,QACV,eAAe,IAAI;AAAA,QACnB,WAAW,IAAI;AAAA,QACf,SAAS,IAAI;AAAA,QACb,SAAS,IAAI;AAAA,QACb,UAAU,IAAI;AAAA,MAChB,EAAE;AAAA,MACF,aAAa,QAAQ,aAAa,IAAI,UAAQ;AAAA,QAC5C,OAAO,IAAI;AAAA,QACX,aAAa,IAAI;AAAA,QACjB,UAAU,IAAI;AAAA,MAChB,EAAE;AAAA,MACF,WAAW,QAAQ,WAAW,IAAI,eAAa;AAAA,QAC7C,MAAM,SAAS;AAAA,QACf,MAAM,SAAS;AAAA,QACf,UAAU,SAAS;AAAA,MACrB,EAAE;AAAA,MACF,QAAQ,QAAQ,QAAQ,IAAI,YAAU;AAAA,QACpC,MAAM,MAAM;AAAA,QACZ,MAAM,MAAM;AAAA,QACZ,eAAe,MAAM;AAAA,QACrB,UAAU,MAAM;AAAA,MAClB,EAAE;AAAA,MACF,WAAW,QAAQ,WAAW,IAAI,eAAa;AAAA,QAC7C,QAAQ,SAAS;AAAA,QACjB,MAAM,SAAS;AAAA,QACf,eAAe,SAAS;AAAA,QACxB,UAAU,SAAS;AAAA,MACrB,EAAE;AAAA,MACF,MAAM,QAAQ,MAAM,IAAI,UAAQ;AAAA,QAC9B,OAAO,IAAI;AAAA,QACX,MAAM,IAAI;AAAA,QACV,eAAe,IAAI;AAAA,QACnB,UAAU,IAAI;AAAA,MAChB,EAAE;AAAA,MACF,aAAa,QAAQ,aAAa,IAAI,iBAAe;AAAA,QACnD,wBAAwB,WAAW;AAAA,QACnC,kBAAkB,WAAW;AAAA,QAC7B,UAAU,WAAW;AAAA,MACvB,EAAE;AAAA,MACF,QAAQ,QAAQ,QAAQ,IAAI,YAAU;AAAA,QACpC,KAAK,MAAM;AAAA,QACX,SAAS,MAAM;AAAA,QACf,UAAU,MAAM;AAAA,MAClB,EAAE;AAAA,IACJ;AAAA,EACF;AACF;;;ACrIA;AADA,SAAS,UAAAC,eAAyB;AAqC3B,IAAM,uBAAN,cAAmC,gBAAgB;AAAA,EACxD,MAAM,QAAQ,MAAyBC,eAAqD;AAC1F,QAAI;AACF,YAAM,SAASD,QAAO,OAAO,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGlE,YAAM,SAAkC,CAAC;AAGzC,UAAI,KAAK,aAAa,KAAK,cAAc,KAAK,cAAc,KAAK,aAAa;AAC5E,eAAO,QAAQ,CAAC;AAAA,UACd,WAAW,KAAK;AAAA,UAChB,YAAY,KAAK;AAAA,UACjB,YAAY,KAAK;AAAA,UACjB,aAAa,KAAK,eAAe,GAAG,KAAK,aAAa,EAAE,IAAI,KAAK,cAAc,EAAE,GAAG,KAAK;AAAA,QAC3F,CAAC;AAAA,MACH;AAGA,UAAI,KAAK,kBAAkB,KAAK,eAAe,SAAS,GAAG;AACzD,eAAO,iBAAiB,KAAK,eAAe,IAAI,YAAU;AAAA,UACxD,OAAO,MAAM;AAAA,UACb,MAAM,MAAM,QAAQ;AAAA,QACtB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,gBAAgB,KAAK,aAAa,SAAS,GAAG;AACrD,eAAO,eAAe,KAAK,aAAa,IAAI,YAAU;AAAA,UACpD,OAAO,MAAM;AAAA,UACb,MAAM,MAAM,QAAQ;AAAA,QACtB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,aAAa,KAAK,UAAU,SAAS,GAAG;AAC/C,eAAO,YAAY,KAAK,UAAU,IAAI,cAAY;AAAA,UAChD,eAAe,QAAQ;AAAA,UACvB,MAAM,QAAQ;AAAA,UACd,QAAQ,QAAQ;AAAA,UAChB,YAAY,QAAQ;AAAA,UACpB,SAAS,QAAQ;AAAA,UACjB,MAAM,QAAQ,QAAQ;AAAA,QACxB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,iBAAiB,KAAK,cAAc,SAAS,GAAG;AACvD,eAAO,gBAAgB,KAAK,cAAc,IAAI,UAAQ;AAAA,UACpD,MAAM,IAAI;AAAA,UACV,OAAO,IAAI;AAAA,UACX,YAAY,IAAI;AAAA,UAChB,MAAM,IAAI,QAAQ;AAAA,QACpB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,eAAe,KAAK,YAAY,SAAS,GAAG;AACnD,eAAO,cAAc,KAAK;AAAA,MAC5B,WAAW,KAAK,OAAO;AAErB,eAAO,cAAc,CAAC;AAAA,UACpB,OAAO,KAAK;AAAA,UACZ,aAAa;AAAA,QACf,CAAC;AAAA,MACH;AAEA,YAAM,WAAW,MAAM,OAAO,OAAO,cAAc;AAAA,QACjD,aAAa;AAAA,QACb,cAAc;AAAA,MAChB,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS;AAAA,gBACP,cAAc,SAAS,KAAK;AAAA,gBAC5B,MAAM,SAAS,KAAK;AAAA,gBACpB,GAAG,KAAK,sBAAsB,SAAS,IAAI;AAAA,cAC7C;AAAA,YACF,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,sBAAsB,SAAuC;AACnE,WAAO;AAAA,MACL,OAAO,QAAQ;AAAA,MACf,gBAAgB,QAAQ;AAAA,MACxB,cAAc,QAAQ;AAAA,MACtB,WAAW,QAAQ;AAAA,MACnB,eAAe,QAAQ;AAAA,MACvB,aAAa,QAAQ;AAAA,IACvB;AAAA,EACF;AACF;;;AC3IA;AADA,SAAS,UAAAC,eAAyB;AAsC3B,IAAM,uBAAN,cAAmC,gBAAgB;AAAA,EACxD,MAAM,QAAQ,MAAyBC,eAAqD;AAC1F,QAAI;AACF,YAAM,SAASD,QAAO,OAAO,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGlE,YAAM,kBAAkB,MAAM,OAAO,OAAO,IAAI;AAAA,QAC9C,cAAc,KAAK;AAAA,QACnB,cAAc;AAAA,MAChB,CAAC;AAGD,YAAM,SAAkC;AAAA,QACtC,MAAM,gBAAgB,KAAK;AAAA,QAC3B,cAAc,KAAK;AAAA,MACrB;AAGA,UAAI,KAAK,mBAAmB,SAAS,OAAO,GAAG;AAC7C,eAAO,QAAQ,CAAC;AAAA,UACd,WAAW,KAAK;AAAA,UAChB,YAAY,KAAK;AAAA,UACjB,YAAY,KAAK;AAAA,UACjB,aAAa,KAAK,eAAe,GAAG,KAAK,aAAa,EAAE,IAAI,KAAK,cAAc,EAAE,GAAG,KAAK;AAAA,QAC3F,CAAC;AAAA,MACH;AAGA,UAAI,KAAK,mBAAmB,SAAS,gBAAgB,KAAK,KAAK,gBAAgB;AAC7E,eAAO,iBAAiB,KAAK,eAAe,IAAI,YAAU;AAAA,UACxD,OAAO,MAAM;AAAA,UACb,MAAM,MAAM,QAAQ;AAAA,QACtB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,mBAAmB,SAAS,cAAc,KAAK,KAAK,cAAc;AACzE,eAAO,eAAe,KAAK,aAAa,IAAI,YAAU;AAAA,UACpD,OAAO,MAAM;AAAA,UACb,MAAM,MAAM,QAAQ;AAAA,QACtB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,mBAAmB,SAAS,WAAW,KAAK,KAAK,WAAW;AACnE,eAAO,YAAY,KAAK,UAAU,IAAI,cAAY;AAAA,UAChD,eAAe,QAAQ;AAAA,UACvB,MAAM,QAAQ;AAAA,UACd,QAAQ,QAAQ;AAAA,UAChB,YAAY,QAAQ;AAAA,UACpB,SAAS,QAAQ;AAAA,UACjB,MAAM,QAAQ,QAAQ;AAAA,QACxB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,mBAAmB,SAAS,eAAe,KAAK,KAAK,eAAe;AAC3E,eAAO,gBAAgB,KAAK,cAAc,IAAI,UAAQ;AAAA,UACpD,MAAM,IAAI;AAAA,UACV,OAAO,IAAI;AAAA,UACX,YAAY,IAAI;AAAA,UAChB,MAAM,IAAI,QAAQ;AAAA,QACpB,EAAE;AAAA,MACJ;AAGA,UAAI,KAAK,mBAAmB,SAAS,aAAa,KAAK,KAAK,aAAa;AACvE,eAAO,cAAc,KAAK;AAAA,MAC5B;AAEA,YAAM,WAAW,MAAM,OAAO,OAAO,cAAc;AAAA,QACjD,cAAc,KAAK;AAAA,QACnB,oBAAoB,KAAK,mBAAmB,KAAK,GAAG;AAAA,QACpD,aAAa;AAAA,QACb,cAAc;AAAA,MAChB,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS;AAAA,gBACP,cAAc,SAAS,KAAK;AAAA,gBAC5B,MAAM,SAAS,KAAK;AAAA,gBACpB,GAAG,KAAK,sBAAsB,SAAS,IAAI;AAAA,cAC7C;AAAA,YACF,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,sBAAsB,SAAuC;AACnE,WAAO;AAAA,MACL,OAAO,QAAQ;AAAA,MACf,gBAAgB,QAAQ;AAAA,MACxB,cAAc,QAAQ;AAAA,MACtB,WAAW,QAAQ;AAAA,MACnB,eAAe,QAAQ;AAAA,MACvB,aAAa,QAAQ;AAAA,IACvB;AAAA,EACF;AACF;;;ACjJA;AADA,SAAS,UAAAC,eAAc;AAOhB,IAAM,uBAAN,cAAmC,gBAAgB;AAAA,EACxD,MAAM,QAAQ,MAAyBC,eAAqD;AAC1F,QAAI;AACF,YAAM,SAASD,QAAO,OAAO,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAElE,YAAM,OAAO,OAAO,cAAc;AAAA,QAChC,cAAc,KAAK;AAAA,MACrB,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS,WAAW,KAAK,YAAY;AAAA,YACvC,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;AC/BA;AADA,SAAS,UAAAC,eAAwB;AAW1B,IAAM,oBAAN,cAAgC,gBAAgB;AAAA,EACrD,MAAM,QAAQ,MAAsBC,eAAqD;AACvF,QAAI;AACF,YAAM,QAAQD,QAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,SAAuD;AAAA,QAC3D,QAAQ;AAAA,QACR,YAAY,KAAK,cAAc;AAAA,QAC/B,kBAAkB,KAAK,oBAAoB;AAAA,MAC7C;AAGA,UAAI,KAAK,OAAO;AACd,eAAO,IAAI,KAAK;AAAA,MAClB;AAEA,UAAI,KAAK,WAAW;AAClB,eAAO,YAAY,KAAK;AAAA,MAC1B;AAEA,UAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC7C,eAAO,WAAW,KAAK;AAAA,MACzB;AAGA,YAAM,WAAW,MAAM,MAAM,MAAM,SAAS,KAAK,MAAM;AAEvD,YAAM,WAAW,SAAS,KAAK,YAAY,CAAC;AAG5C,YAAM,iBAAiB,MAAM,QAAQ;AAAA,QACnC,SAAS,MAAM,GAAG,EAAE,EAAE,IAAI,OAAO,YAAY;AAC3C,cAAI;AACF,kBAAM,UAAU,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,cAC7C,QAAQ;AAAA,cACR,IAAI,QAAQ;AAAA,cACZ,QAAQ;AAAA,cACR,iBAAiB,CAAC,QAAQ,MAAM,WAAW,MAAM;AAAA,YACnD,CAAC;AAED,mBAAO,KAAK,sBAAsB,QAAQ,IAAI;AAAA,UAChD,SAAS,OAAO;AACd,oBAAQ,MAAM,0BAA0B,QAAQ,EAAE,KAAK,KAAK;AAC5D,mBAAO,EAAE,IAAI,QAAQ,IAAI,OAAO,0BAA0B;AAAA,UAC5D;AAAA,QACF,CAAC;AAAA,MACH;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,UAAU;AAAA,cACV,oBAAoB,SAAS,KAAK;AAAA,cAClC,eAAe,SAAS,KAAK,iBAAiB;AAAA,cAC9C,eAAe,SAAS;AAAA,YAC1B,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,sBAAsB,SAAuC;AACnE,UAAM,UAAU,QAAQ,SAAS,WAAW,CAAC;AAC7C,UAAM,YAAY,CAAC,SAAiB,QAAQ,KAAK,OAAK,EAAE,SAAS,IAAI,GAAG,SAAS;AAEjF,WAAO;AAAA,MACL,IAAI,QAAQ;AAAA,MACZ,UAAU,QAAQ;AAAA,MAClB,SAAS,UAAU,SAAS;AAAA,MAC5B,MAAM,UAAU,MAAM;AAAA,MACtB,IAAI,UAAU,IAAI;AAAA,MAClB,MAAM,UAAU,MAAM;AAAA,MACtB,SAAS,QAAQ;AAAA,MACjB,UAAU,QAAQ,YAAY,CAAC;AAAA,MAC/B,UAAU,QAAQ,UAAU,SAAS,QAAQ,KAAK;AAAA,MAClD,aAAa,QAAQ,UAAU,SAAS,WAAW,KAAK;AAAA,MACxD,WAAW,QAAQ,UAAU,SAAS,SAAS,KAAK;AAAA,MACpD,gBAAgB,KAAK,eAAe,QAAQ,OAAO;AAAA,IACrD;AAAA,EACF;AAAA,EAEQ,eAAe,SAAgD;AACrE,QAAI,CAAC,QAAS,QAAO;AAGrB,QAAI,QAAQ,YAAY,QAAQ,SAAS,SAAS,GAAG;AACnD,aAAO;AAAA,IACT;AAGA,QAAI,QAAQ,OAAO;AACjB,aAAO,QAAQ,MAAM,KAAK,UAAQ,KAAK,eAAe,IAAI,CAAC;AAAA,IAC7D;AAEA,WAAO;AAAA,EACT;AACF;;;ACjHA;AADA,SAAS,UAAAC,eAAwB;AAS1B,IAAM,kBAAN,cAA8B,gBAAgB;AAAA,EACnD,MAAM,QAAQ,MAAoBC,eAAqD;AACrF,QAAI;AACF,YAAM,QAAQD,QAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,WAAW,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,QAC9C,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,QACT,QAAQ,KAAK,UAAU;AAAA,MACzB,CAAC;AAED,YAAM,UAAU,SAAS;AAGzB,UAAI,KAAK,eAAe,SAAS,QAAQ,UAAU,SAAS,QAAQ,GAAG;AACrE,cAAM,MAAM,MAAM,SAAS,OAAO;AAAA,UAChC,QAAQ;AAAA,UACR,IAAI,KAAK;AAAA,UACT,aAAa;AAAA,YACX,gBAAgB,CAAC,QAAQ;AAAA,UAC3B;AAAA,QACF,CAAC;AAAA,MACH;AAGA,YAAM,mBAAmB,KAAK,WAAW,aACrC,KAAK,sBAAsB,OAAO,IAClC,KAAK,kBAAkB,OAAO;AAElC,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU,kBAAkB,MAAM,CAAC;AAAA,UAChD;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,sBAAsB,SAAuC;AACnE,UAAM,UAAU,QAAQ,SAAS,WAAW,CAAC;AAC7C,UAAM,YAAY,CAAC,SAAiB,QAAQ,KAAK,OAAK,EAAE,SAAS,IAAI,GAAG,SAAS;AAEjF,WAAO;AAAA,MACL,IAAI,QAAQ;AAAA,MACZ,UAAU,QAAQ;AAAA,MAClB,SAAS,UAAU,SAAS;AAAA,MAC5B,MAAM,UAAU,MAAM;AAAA,MACtB,IAAI,UAAU,IAAI;AAAA,MAClB,IAAI,UAAU,IAAI;AAAA,MAClB,KAAK,UAAU,KAAK;AAAA,MACpB,MAAM,UAAU,MAAM;AAAA,MACtB,SAAS,QAAQ;AAAA,MACjB,UAAU,QAAQ,YAAY,CAAC;AAAA,MAC/B,cAAc,QAAQ;AAAA,MACtB,WAAW,QAAQ;AAAA,IACrB;AAAA,EACF;AAAA,EAEQ,kBAAkB,SAAuC;AAC/D,UAAM,UAAU,QAAQ,SAAS,WAAW,CAAC;AAC7C,UAAM,YAAY,CAAC,SAAiB,QAAQ,KAAK,OAAK,EAAE,SAAS,IAAI,GAAG,SAAS;AAEjF,WAAO;AAAA,MACL,IAAI,QAAQ;AAAA,MACZ,UAAU,QAAQ;AAAA,MAClB,UAAU,QAAQ,YAAY,CAAC;AAAA,MAC/B,SAAS,QAAQ;AAAA,MACjB,WAAW,QAAQ;AAAA,MACnB,cAAc,QAAQ;AAAA,MACtB,cAAc,QAAQ;AAAA,MACtB,SAAS;AAAA,QACP,SAAS,UAAU,SAAS;AAAA,QAC5B,MAAM,UAAU,MAAM;AAAA,QACtB,IAAI,UAAU,IAAI;AAAA,QAClB,IAAI,UAAU,IAAI;AAAA,QAClB,KAAK,UAAU,KAAK;AAAA,QACpB,MAAM,UAAU,MAAM;AAAA,QACtB,WAAW,UAAU,YAAY;AAAA,QACjC,WAAW,UAAU,aAAa;AAAA,QAClC,YAAY,UAAU,YAAY;AAAA,MACpC;AAAA,MACA,MAAM,KAAK,YAAY,QAAQ,OAAO;AAAA,MACtC,aAAa,KAAK,mBAAmB,QAAQ,OAAO;AAAA,MACpD,UAAU,QAAQ,UAAU,SAAS,QAAQ,KAAK;AAAA,MAClD,aAAa,QAAQ,UAAU,SAAS,WAAW,KAAK;AAAA,MACxD,WAAW,QAAQ,UAAU,SAAS,SAAS,KAAK;AAAA,MACpD,SAAS,QAAQ,UAAU,SAAS,OAAO,KAAK;AAAA,IAClD;AAAA,EACF;AAAA,EAEQ,YAAY,SAAyE;AAC3F,QAAI,CAAC,QAAS,QAAO,CAAC;AAEtB,UAAM,SAA2C,CAAC;AAGlD,QAAI,QAAQ,MAAM,MAAM;AACtB,YAAM,UAAU,OAAO,KAAK,QAAQ,KAAK,MAAM,QAAQ,EAAE,SAAS,OAAO;AACzE,UAAI,QAAQ,aAAa,cAAc;AACrC,eAAO,OAAO;AAAA,MAChB,WAAW,QAAQ,aAAa,aAAa;AAC3C,eAAO,OAAO;AAAA,MAChB;AAAA,IACF;AAGA,QAAI,QAAQ,OAAO;AACjB,iBAAW,QAAQ,QAAQ,OAAO;AAChC,YAAI,KAAK,aAAa,gBAAgB,KAAK,MAAM,MAAM;AACrD,iBAAO,OAAO,OAAO,KAAK,KAAK,KAAK,MAAM,QAAQ,EAAE,SAAS,OAAO;AAAA,QACtE,WAAW,KAAK,aAAa,eAAe,KAAK,MAAM,MAAM;AAC3D,iBAAO,OAAO,OAAO,KAAK,KAAK,KAAK,MAAM,QAAQ,EAAE,SAAS,OAAO;AAAA,QACtE,WAAW,KAAK,UAAU,WAAW,YAAY,GAAG;AAElD,gBAAM,aAAa,KAAK,YAAY,IAAI;AACxC,cAAI,WAAW,KAAM,QAAO,OAAO,WAAW;AAC9C,cAAI,WAAW,KAAM,QAAO,OAAO,WAAW;AAAA,QAChD;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,mBAAmB,SAA8C;AACvE,QAAI,CAAC,QAAS,QAAO,CAAC;AAEtB,UAAM,cAAqB,CAAC;AAE5B,UAAM,4BAA4B,CAAC,SAAsC;AACvE,UAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC7C,oBAAY,KAAK;AAAA,UACf,UAAU,KAAK;AAAA,UACf,UAAU,KAAK;AAAA,UACf,MAAM,KAAK,MAAM,QAAQ;AAAA,UACzB,cAAc,KAAK,MAAM;AAAA,QAC3B,CAAC;AAAA,MACH;AAEA,UAAI,KAAK,OAAO;AACd,aAAK,MAAM,QAAQ,yBAAyB;AAAA,MAC9C;AAAA,IACF;AAEA,8BAA0B,OAAO;AACjC,WAAO;AAAA,EACT;AACF;;;ACjKA;AADA,SAAS,UAAAC,eAAwB;AAc1B,IAAM,mBAAN,cAA+B,gBAAgB;AAAA,EACpD,MAAM,QAAQ,MAAqBC,eAAqD;AACtF,QAAI;AACF,YAAM,QAAQD,QAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,UAAU,MAAM,MAAM,MAAM,WAAW,EAAE,QAAQ,KAAK,CAAC;AAC7D,YAAM,YAAY,QAAQ,KAAK;AAG/B,YAAM,UAAU,KAAK;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK,UAAU;AAAA,QACf,KAAK;AAAA,MACP;AAGA,YAAM,cAAuC;AAAA,QAC3C,KAAK;AAAA,MACP;AAGA,UAAI,KAAK,UAAU;AACjB,oBAAY,WAAW,KAAK;AAAA,MAC9B;AAGA,YAAM,WAAW,MAAM,MAAM,MAAM,SAAS,KAAK;AAAA,QAC/C,QAAQ;AAAA,QACR;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,WAAW,SAAS,KAAK;AAAA,cACzB,UAAU,SAAS,KAAK;AAAA,cACxB,UAAU,SAAS,KAAK;AAAA,YAC1B,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,cACN,MACA,IACA,SACA,MACA,IACA,KACA,SAAkB,OAClB,kBACQ;AACR,UAAM,WAAW,cAAc,KAAK,IAAI;AACxC,UAAM,cAAc,MAAM,QAAQ,EAAE,IAAI,GAAG,KAAK,IAAI,IAAI;AAExD,QAAI,eAAe;AAAA,MACjB,SAAS,IAAI;AAAA,MACb,OAAO,WAAW;AAAA,MAClB,YAAY,OAAO;AAAA,MACnB;AAAA,IACF;AAGA,QAAI,IAAI;AACN,YAAM,cAAc,MAAM,QAAQ,EAAE,IAAI,GAAG,KAAK,IAAI,IAAI;AACxD,mBAAa,KAAK,OAAO,WAAW,EAAE;AAAA,IACxC;AAGA,QAAI,KAAK;AACP,YAAM,eAAe,MAAM,QAAQ,GAAG,IAAI,IAAI,KAAK,IAAI,IAAI;AAC3D,mBAAa,KAAK,QAAQ,YAAY,EAAE;AAAA,IAC1C;AAGA,QAAI,kBAAkB;AACpB,mBAAa,KAAK,gBAAgB,gBAAgB,EAAE;AACpD,mBAAa,KAAK,eAAe,gBAAgB,EAAE;AAAA,IACrD;AAGA,QAAI,QAAQ;AACV,mBAAa,KAAK,kDAAkD,QAAQ,GAAG;AAC/E,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,EAAE;AACjC,mBAAa,KAAK,yCAAyC;AAC3D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,WAAW,IAAI,CAAC;AACvC,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,EAAE;AACjC,mBAAa,KAAK,wCAAwC;AAC1D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,IAAI;AACtB,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,IAAI;AAAA,IACrC,OAAO;AACL,mBAAa,KAAK,yCAAyC;AAC3D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,IAAI;AAAA,IACxB;AAEA,UAAM,UAAU,aAAa,KAAK,MAAM;AAGxC,UAAM,iBAAiB,OAAO,KAAK,OAAO,EACvC,SAAS,QAAQ,EACjB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,EAAE;AAEpB,WAAO;AAAA,EACT;AAAA,EAEQ,WAAW,MAAsB;AAEvC,WAAO,KACJ,QAAQ,gBAAgB,IAAI,EAC5B,QAAQ,WAAW,MAAM,EACzB,QAAQ,YAAY,EAAE,EACtB,QAAQ,WAAW,GAAG,EACtB,QAAQ,UAAU,GAAG,EACrB,QAAQ,SAAS,GAAG,EACpB,QAAQ,SAAS,GAAG,EACpB,QAAQ,WAAW,GAAG,EACtB,QAAQ,UAAU,GAAG,EACrB,KAAK;AAAA,EACV;AACF;;;AC1JA;AADA,SAAS,UAAAC,gBAAwB;;;ACoB1B,IAAM,uBAAN,MAA2B;AAAA;AAAA;AAAA;AAAA,EAIhC,OAAO,SAAS,OAAiC;AAC/C,UAAM,YAAqC;AAAA,MACzC,CAAC,cAAc,cAAc;AAAA,MAC7B,CAAC,QAAQ,QAAQ;AAAA,MACjB,CAAC,mBAAmB,oBAAoB;AAAA,MACxC,CAAC,WAAW,WAAW;AAAA,IACzB;AAEA,eAAW,CAAC,OAAO,KAAK,KAAK,WAAW;AACtC,UAAI,MAAM,KAAiC,KAAK,MAAM,KAAiC,GAAG;AACxF,cAAM,IAAI,MAAM,sCAAsC,KAAK,QAAQ,KAAK,EAAE;AAAA,MAC5E;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,MAAM,OAA0C;AAErD,SAAK,SAAS,KAAK;AAEnB,UAAM,cAAwB,CAAC,GAAI,MAAM,eAAe,CAAC,CAAE;AAC3D,UAAM,iBAA2B,CAAC,GAAI,MAAM,kBAAkB,CAAC,CAAE;AAGjE,QAAI,MAAM,YAAY;AACpB,qBAAe,KAAK,QAAQ;AAAA,IAC9B;AACA,QAAI,MAAM,cAAc;AACtB,kBAAY,KAAK,QAAQ;AAAA,IAC3B;AACA,QAAI,MAAM,MAAM;AACd,kBAAY,KAAK,SAAS;AAAA,IAC5B;AACA,QAAI,MAAM,QAAQ;AAChB,qBAAe,KAAK,SAAS;AAAA,IAC/B;AACA,QAAI,MAAM,iBAAiB;AACzB,kBAAY,KAAK,WAAW;AAAA,IAC9B;AACA,QAAI,MAAM,oBAAoB;AAC5B,qBAAe,KAAK,WAAW;AAAA,IACjC;AACA,QAAI,MAAM,SAAS;AACjB,qBAAe,KAAK,OAAO;AAAA,IAC7B;AACA,QAAI,MAAM,WAAW;AACnB,kBAAY,KAAK,OAAO;AAAA,IAC1B;AAGA,UAAM,oBAAoB,CAAC,GAAG,IAAI,IAAI,WAAW,CAAC;AAClD,UAAM,uBAAuB,CAAC,GAAG,IAAI,IAAI,cAAc,CAAC;AAGxD,UAAM,mBAAmB,kBAAkB,OAAO,QAAM,CAAC,qBAAqB,SAAS,EAAE,CAAC;AAC1F,UAAM,sBAAsB,qBAAqB,OAAO,QAAM,CAAC,kBAAkB,SAAS,EAAE,CAAC;AAE7F,WAAO;AAAA,MACL,aAAa;AAAA,MACb,gBAAgB;AAAA,IAClB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAO,gBAAgB,eAAyB,UAAkC;AAChF,UAAM,YAAY,cAAc,SAAS,OAAO;AAChD,UAAM,WAAW,cAAc,SAAS,MAAM;AAG9C,QAAI,aAAa,UAAU;AAEzB,YAAM,gBAAgB,SAAS,eAAe,SAAS,OAAO;AAC9D,YAAM,eAAe,SAAS,eAAe,SAAS,MAAM;AAG5D,UAAI,iBAAiB,cAAc;AACjC,eAAO;AAAA,MACT;AAGA,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AACF;;;ADxGO,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQC,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMD,cAAa,CAAC;AAGhE,UAAI,KAAK,aAAa;AACpB,cAAM,MAAM,MAAM,SAAS,MAAM;AAAA,UAC/B,QAAQ;AAAA,UACR,IAAI,KAAK;AAAA,QACX,CAAC;AAED,eAAO;AAAA,UACL,SAAS;AAAA,YACP;AAAA,cACE,MAAM;AAAA,cACN,MAAM,KAAK,UAAU;AAAA,gBACnB,SAAS;AAAA,gBACT,WAAW,KAAK;AAAA,gBAChB,QAAQ;AAAA,cACV,GAAG,MAAM,CAAC;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAEA,UAAI,KAAK,iBAAiB;AACxB,cAAM,MAAM,MAAM,SAAS,QAAQ;AAAA,UACjC,QAAQ;AAAA,UACR,IAAI,KAAK;AAAA,QACX,CAAC;AAED,eAAO;AAAA,UACL,SAAS;AAAA,YACP;AAAA,cACE,MAAM;AAAA,cACN,MAAM,KAAK,UAAU;AAAA,gBACnB,SAAS;AAAA,gBACT,WAAW,KAAK;AAAA,gBAChB,QAAQ;AAAA,cACV,GAAG,MAAM,CAAC;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAGA,YAAM,WAAW,qBAAqB,MAAM,IAAI;AAGhD,UAAI,SAAS,YAAY,WAAW,KAAK,SAAS,eAAe,WAAW,GAAG;AAC7E,eAAO;AAAA,UACL,SAAS;AAAA,YACP;AAAA,cACE,MAAM;AAAA,cACN,MAAM,KAAK,UAAU;AAAA,gBACnB,SAAS;AAAA,gBACT,WAAW,KAAK;AAAA,gBAChB,SAAS;AAAA,cACX,GAAG,MAAM,CAAC;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAGA,YAAM,WAAW,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,QAC9C,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,QACT,QAAQ;AAAA,MACV,CAAC;AAED,YAAM,gBAAgB,SAAS,KAAK,YAAY,CAAC;AAEjD,UAAI,CAAC,qBAAqB,gBAAgB,eAAe,QAAQ,GAAG;AAClE,eAAO;AAAA,UACL,SAAS;AAAA,YACP;AAAA,cACE,MAAM;AAAA,cACN,MAAM,KAAK,UAAU;AAAA,gBACnB,SAAS;AAAA,gBACT,WAAW,KAAK;AAAA,gBAChB,OAAO;AAAA,gBACP;AAAA,cACF,GAAG,MAAM,CAAC;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAEA,cAAQ,IAAI,sCAAsC;AAAA,QAChD,WAAW,KAAK;AAAA,QAChB,aAAa,SAAS;AAAA,QACtB,gBAAgB,SAAS;AAAA,MAC3B,CAAC;AAED,YAAM,WAAW,MAAM,MAAM,MAAM,SAAS,OAAO;AAAA,QACjD,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,QACT,aAAa;AAAA,UACX,aAAa,SAAS;AAAA,UACtB,gBAAgB,SAAS;AAAA,QAC3B;AAAA,MACF,CAAC;AAED,cAAQ,IAAI,+BAA+B,SAAS,QAAQ,SAAS,UAAU;AAG/E,YAAM,IAAI,QAAQ,CAAAE,aAAW,WAAWA,UAAS,GAAG,CAAC;AAErD,YAAM,YAAY,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,QAC/C,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,QACT,QAAQ;AAAA,MACV,CAAC;AAED,YAAM,cAAc,UAAU,KAAK,YAAY,CAAC;AAGhD,YAAM,gBAAgB,SAAS,YAAY;AAAA,QAAM,WAC/C,YAAY,SAAS,KAAK;AAAA,MAC5B;AACA,YAAM,kBAAkB,SAAS,eAAe;AAAA,QAAM,WACpD,CAAC,YAAY,SAAS,KAAK;AAAA,MAC7B;AAEA,YAAM,WAAW,iBAAiB;AAElC,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,WAAW,SAAS,KAAK;AAAA,cACzB,UAAU,SAAS,KAAK;AAAA,cACxB,UAAU;AAAA,cACV,aAAa,SAAS;AAAA,cACtB,eAAe,SAAS;AAAA,cACxB;AAAA,cACA,SAAS,WAAW,SAAY;AAAA,YAClC,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAY;AACnB,cAAQ,MAAM,gCAAgC;AAAA,QAC5C,SAAS,MAAM;AAAA,QACf,MAAM,MAAM;AAAA,QACZ,QAAQ,MAAM;AAAA,QACd,UAAU,MAAM,UAAU;AAAA,MAC5B,CAAC;AACD,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;AErKA;AADA,SAAS,UAAAC,gBAAc;AAQhB,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAEhE,UAAI,KAAK,WAAW;AAElB,cAAM,MAAM,MAAM,SAAS,OAAO;AAAA,UAChC,QAAQ;AAAA,UACR,IAAI,KAAK;AAAA,QACX,CAAC;AAED,eAAO;AAAA,UACL,SAAS;AAAA,YACP;AAAA,cACE,MAAM;AAAA,cACN,MAAM,KAAK,UAAU;AAAA,gBACnB,SAAS;AAAA,gBACT,WAAW,KAAK;AAAA,gBAChB,QAAQ;AAAA,gBACR,SAAS;AAAA,cACX,GAAG,MAAM,CAAC;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF,OAAO;AAEL,cAAM,MAAM,MAAM,SAAS,MAAM;AAAA,UAC/B,QAAQ;AAAA,UACR,IAAI,KAAK;AAAA,QACX,CAAC;AAED,eAAO;AAAA,UACL,SAAS;AAAA,YACP;AAAA,cACE,MAAM;AAAA,cACN,MAAM,KAAK,UAAU;AAAA,gBACnB,SAAS;AAAA,gBACT,WAAW,KAAK;AAAA,gBAChB,QAAQ;AAAA,gBACR,MAAM;AAAA,cACR,GAAG,MAAM,CAAC;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;AC1DA;AADA,SAAS,UAAAC,gBAAwB;AAc1B,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,UAAU,MAAM,MAAM,MAAM,WAAW,EAAE,QAAQ,KAAK,CAAC;AAC7D,YAAM,YAAY,QAAQ,KAAK;AAG/B,YAAM,UAAU,KAAK;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK,UAAU;AAAA,QACf,KAAK;AAAA,MACP;AAGA,YAAM,cAAqC;AAAA,QACzC,SAAS;AAAA,UACP,KAAK;AAAA,UACL,UAAU,KAAK;AAAA,QACjB;AAAA,MACF;AAEA,YAAM,WAAW,MAAM,MAAM,MAAM,OAAO,OAAO;AAAA,QAC/C,QAAQ;AAAA,QACR;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS,SAAS,KAAK;AAAA,cACvB,WAAW,SAAS,KAAK,SAAS;AAAA,cAClC,UAAU,SAAS,KAAK,SAAS;AAAA,YACnC,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,cACN,MACA,IACA,SACA,MACA,IACA,KACA,SAAkB,OAClB,kBACQ;AACR,UAAM,WAAW,cAAc,KAAK,IAAI;AACxC,UAAM,cAAc,MAAM,QAAQ,EAAE,IAAI,GAAG,KAAK,IAAI,IAAI;AAExD,QAAI,eAAe;AAAA,MACjB,SAAS,IAAI;AAAA,MACb,OAAO,WAAW;AAAA,MAClB,YAAY,OAAO;AAAA,MACnB;AAAA,IACF;AAGA,QAAI,IAAI;AACN,YAAM,cAAc,MAAM,QAAQ,EAAE,IAAI,GAAG,KAAK,IAAI,IAAI;AACxD,mBAAa,KAAK,OAAO,WAAW,EAAE;AAAA,IACxC;AAGA,QAAI,KAAK;AACP,YAAM,eAAe,MAAM,QAAQ,GAAG,IAAI,IAAI,KAAK,IAAI,IAAI;AAC3D,mBAAa,KAAK,QAAQ,YAAY,EAAE;AAAA,IAC1C;AAGA,QAAI,kBAAkB;AACpB,mBAAa,KAAK,gBAAgB,gBAAgB,EAAE;AACpD,mBAAa,KAAK,eAAe,gBAAgB,EAAE;AAAA,IACrD;AAGA,QAAI,QAAQ;AACV,mBAAa,KAAK,kDAAkD,QAAQ,GAAG;AAC/E,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,EAAE;AACjC,mBAAa,KAAK,yCAAyC;AAC3D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,WAAW,IAAI,CAAC;AACvC,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,EAAE;AACjC,mBAAa,KAAK,wCAAwC;AAC1D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,IAAI;AACtB,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,IAAI;AAAA,IACrC,OAAO;AACL,mBAAa,KAAK,yCAAyC;AAC3D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,IAAI;AAAA,IACxB;AAEA,UAAM,UAAU,aAAa,KAAK,MAAM;AAGxC,UAAM,iBAAiB,OAAO,KAAK,OAAO,EACvC,SAAS,QAAQ,EACjB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,EAAE;AAEpB,WAAO;AAAA,EACT;AAAA,EAEQ,WAAW,MAAsB;AAEvC,WAAO,KACJ,QAAQ,gBAAgB,IAAI,EAC5B,QAAQ,WAAW,MAAM,EACzB,QAAQ,YAAY,EAAE,EACtB,QAAQ,WAAW,GAAG,EACtB,QAAQ,UAAU,GAAG,EACrB,QAAQ,SAAS,GAAG,EACpB,QAAQ,SAAS,GAAG,EACpB,QAAQ,WAAW,GAAG,EACtB,QAAQ,UAAU,GAAG,EACrB,KAAK;AAAA,EACV;AACF;;;ACvJA;AADA,SAAS,UAAAC,gBAAwB;AAe1B,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,UAAU,MAAM,MAAM,MAAM,WAAW,EAAE,QAAQ,KAAK,CAAC;AAC7D,YAAM,YAAY,QAAQ,KAAK;AAG/B,YAAM,UAAU,KAAK;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK,UAAU;AAAA,QACf,KAAK;AAAA,MACP;AAGA,YAAM,cAAqC;AAAA,QACzC,SAAS;AAAA,UACP,KAAK;AAAA,UACL,UAAU,KAAK;AAAA,QACjB;AAAA,MACF;AAEA,YAAM,WAAW,MAAM,MAAM,MAAM,OAAO,OAAO;AAAA,QAC/C,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,QACT;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS,SAAS,KAAK;AAAA,cACvB,WAAW,SAAS,KAAK,SAAS;AAAA,cAClC,UAAU,SAAS,KAAK,SAAS;AAAA,YACnC,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,cACN,MACA,IACA,SACA,MACA,IACA,KACA,SAAkB,OAClB,kBACQ;AACR,UAAM,WAAW,cAAc,KAAK,IAAI;AACxC,UAAM,cAAc,MAAM,QAAQ,EAAE,IAAI,GAAG,KAAK,IAAI,IAAI;AAExD,QAAI,eAAe;AAAA,MACjB,SAAS,IAAI;AAAA,MACb,OAAO,WAAW;AAAA,MAClB,YAAY,OAAO;AAAA,MACnB;AAAA,IACF;AAGA,QAAI,IAAI;AACN,YAAM,cAAc,MAAM,QAAQ,EAAE,IAAI,GAAG,KAAK,IAAI,IAAI;AACxD,mBAAa,KAAK,OAAO,WAAW,EAAE;AAAA,IACxC;AAGA,QAAI,KAAK;AACP,YAAM,eAAe,MAAM,QAAQ,GAAG,IAAI,IAAI,KAAK,IAAI,IAAI;AAC3D,mBAAa,KAAK,QAAQ,YAAY,EAAE;AAAA,IAC1C;AAGA,QAAI,kBAAkB;AACpB,mBAAa,KAAK,gBAAgB,gBAAgB,EAAE;AACpD,mBAAa,KAAK,eAAe,gBAAgB,EAAE;AAAA,IACrD;AAGA,QAAI,QAAQ;AACV,mBAAa,KAAK,kDAAkD,QAAQ,GAAG;AAC/E,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,EAAE;AACjC,mBAAa,KAAK,yCAAyC;AAC3D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,WAAW,IAAI,CAAC;AACvC,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,EAAE;AACjC,mBAAa,KAAK,wCAAwC;AAC1D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,IAAI;AACtB,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,KAAK,QAAQ,IAAI;AAAA,IACrC,OAAO;AACL,mBAAa,KAAK,yCAAyC;AAC3D,mBAAa,KAAK,EAAE;AACpB,mBAAa,KAAK,IAAI;AAAA,IACxB;AAEA,UAAM,UAAU,aAAa,KAAK,MAAM;AAGxC,UAAM,iBAAiB,OAAO,KAAK,OAAO,EACvC,SAAS,QAAQ,EACjB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,EAAE;AAEpB,WAAO;AAAA,EACT;AAAA,EAEQ,WAAW,MAAsB;AAEvC,WAAO,KACJ,QAAQ,gBAAgB,IAAI,EAC5B,QAAQ,WAAW,MAAM,EACzB,QAAQ,YAAY,EAAE,EACtB,QAAQ,WAAW,GAAG,EACtB,QAAQ,UAAU,GAAG,EACrB,QAAQ,SAAS,GAAG,EACpB,QAAQ,SAAS,GAAG,EACpB,QAAQ,WAAW,GAAG,EACtB,QAAQ,UAAU,GAAG,EACrB,KAAK;AAAA,EACV;AACF;;;ACzJA;AADA,SAAS,UAAAC,gBAAc;AAOhB,IAAM,mBAAN,cAA+B,gBAAgB;AAAA,EACpD,MAAM,QAAQ,MAAqBC,eAAqD;AACtF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,WAAW,MAAM,MAAM,MAAM,OAAO,KAAK;AAAA,QAC7C,QAAQ;AAAA,QACR,aAAa;AAAA,UACX,IAAI,KAAK;AAAA,QACX;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,WAAW,SAAS,KAAK;AAAA,cACzB,UAAU,SAAS,KAAK;AAAA,cACxB,UAAU,SAAS,KAAK;AAAA,YAC1B,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;ACrCA;AADA,SAAS,UAAAC,gBAAc;AAGhB,IAAM,oBAAN,cAAgC,gBAAgB;AAAA,EACrD,MAAM,QAAQ,MAAWC,eAAqD;AAC5E,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,WAAW,MAAM,MAAM,MAAM,OAAO,KAAK;AAAA,QAC7C,QAAQ;AAAA,MACV,CAAC;AAED,YAAM,SAAS,SAAS,KAAK,UAAU,CAAC;AAGxC,YAAM,eAAe,OAAO,OAAO,WAAS,MAAM,SAAS,QAAQ;AACnE,YAAM,aAAa,OAAO,OAAO,WAAS,MAAM,SAAS,MAAM;AAG/D,YAAM,kBAAkB;AAAA,QACtB,cAAc,aAAa,IAAI,KAAK,WAAW;AAAA,QAC/C,YAAY,WAAW,IAAI,KAAK,WAAW;AAAA,QAC3C,YAAY,OAAO;AAAA,QACnB,aAAa,aAAa;AAAA,QAC1B,WAAW,WAAW;AAAA,MACxB;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU,iBAAiB,MAAM,CAAC;AAAA,UAC/C;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEQ,YAAY,OAAiB;AACnC,WAAO;AAAA,MACL,IAAI,MAAM;AAAA,MACV,MAAM,MAAM;AAAA,MACZ,MAAM,MAAM;AAAA,MACZ,uBAAuB,MAAM;AAAA,MAC7B,qBAAqB,MAAM;AAAA,MAC3B,OAAO,MAAM,QAAQ;AAAA,QACnB,WAAW,MAAM,MAAM;AAAA,QACvB,iBAAiB,MAAM,MAAM;AAAA,MAC/B,IAAI;AAAA,MACJ,eAAe,MAAM;AAAA,MACrB,gBAAgB,MAAM;AAAA,MACtB,cAAc,MAAM;AAAA,MACpB,eAAe,MAAM;AAAA,IACvB;AAAA,EACF;AACF;;;AC1DA;AADA,SAAS,UAAAC,gBAAwB;AAW1B,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,cAAqC;AAAA,QACzC,MAAM,KAAK;AAAA,QACX,uBAAuB,KAAK,yBAAyB;AAAA,QACrD,qBAAqB,KAAK,uBAAuB;AAAA,MACnD;AAGA,UAAI,KAAK,mBAAmB,KAAK,WAAW;AAC1C,oBAAY,QAAQ;AAAA,UAClB,iBAAiB,KAAK;AAAA,UACtB,WAAW,KAAK;AAAA,QAClB;AAAA,MACF;AAGA,YAAM,WAAW,MAAM,MAAM,MAAM,OAAO,OAAO;AAAA,QAC/C,QAAQ;AAAA,QACR;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,OAAO;AAAA,gBACL,IAAI,SAAS,KAAK;AAAA,gBAClB,MAAM,SAAS,KAAK;AAAA,gBACpB,MAAM,SAAS,KAAK;AAAA,gBACpB,uBAAuB,SAAS,KAAK;AAAA,gBACrC,qBAAqB,SAAS,KAAK;AAAA,gBACnC,OAAO,SAAS,KAAK;AAAA,cACvB;AAAA,YACF,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;AC3DA;AADA,SAAS,UAAAC,gBAAwB;AAY1B,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,cAAqC,CAAC;AAE5C,UAAI,KAAK,MAAM;AACb,oBAAY,OAAO,KAAK;AAAA,MAC1B;AAEA,UAAI,KAAK,uBAAuB;AAC9B,oBAAY,wBAAwB,KAAK;AAAA,MAC3C;AAEA,UAAI,KAAK,qBAAqB;AAC5B,oBAAY,sBAAsB,KAAK;AAAA,MACzC;AAGA,UAAI,KAAK,mBAAmB,KAAK,WAAW;AAC1C,oBAAY,QAAQ;AAAA,UAClB,iBAAiB,KAAK;AAAA,UACtB,WAAW,KAAK;AAAA,QAClB;AAAA,MACF;AAGA,YAAM,WAAW,MAAM,MAAM,MAAM,OAAO,MAAM;AAAA,QAC9C,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,QACT;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,OAAO;AAAA,gBACL,IAAI,SAAS,KAAK;AAAA,gBAClB,MAAM,SAAS,KAAK;AAAA,gBACpB,MAAM,SAAS,KAAK;AAAA,gBACpB,uBAAuB,SAAS,KAAK;AAAA,gBACrC,qBAAqB,SAAS,KAAK;AAAA,gBACnC,OAAO,SAAS,KAAK;AAAA,gBACrB,eAAe,SAAS,KAAK;AAAA,gBAC7B,gBAAgB,SAAS,KAAK;AAAA,gBAC9B,cAAc,SAAS,KAAK;AAAA,gBAC5B,eAAe,SAAS,KAAK;AAAA,cAC/B;AAAA,YACF,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;ACzEA;AADA,SAAS,UAAAC,gBAAc;AAOhB,IAAM,qBAAN,cAAiC,gBAAgB;AAAA,EACtD,MAAM,QAAQ,MAAuBC,eAAqD;AACxF,QAAI;AACF,YAAM,QAAQD,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMC,cAAa,CAAC;AAGhE,YAAM,MAAM,MAAM,OAAO,OAAO;AAAA,QAC9B,QAAQ;AAAA,QACR,IAAI,KAAK;AAAA,MACX,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS,SAAS,KAAK,OAAO;AAAA,cAC9B,SAAS;AAAA,YACX,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AACF;;;AClCA;AADA,SAAS,UAAAC,gBAAwB;;;ACQ1B,IAAM,mBAAN,MAAM,kBAAiB;AAAA,EAC5B,OAAwB,YAAY;AAAA;AAAA,EACpC,OAAwB,YAAY;AAAA;AAAA,EACpC,OAAwB,qBAAqB;AAAA,EAC7C,OAAwB,sBAAsB;AAAA;AAAA,EAEtC,eAAe,kBAAiB;AAAA,EAChC,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,EAM5B,OAAO,qBAAqB,SAA6B;AACvD,UAAM,OAAsB,CAAC;AAE7B,QAAI,CAAC,QAAS,QAAO;AAGrB,UAAM,YAAY,CAAC,SAAqC;AAEtD,YAAM,YAAY,KAAK,YAAY;AACnC,UAAI,QAAQ,SAAS,EAAG,QAAO,QAAQ,SAAS;AAGhD,UAAI,QAAQ,IAAI,EAAG,QAAO,QAAQ,IAAI;AAGtC,iBAAW,OAAO,SAAS;AACzB,YAAI,IAAI,YAAY,MAAM,WAAW;AACnC,iBAAO,QAAQ,GAAG;AAAA,QACpB;AAAA,MACF;AAEA,aAAO;AAAA,IACT;AAEA,UAAM,QAAQ,UAAU,mBAAmB;AAC3C,UAAM,YAAY,UAAU,uBAAuB;AACnD,UAAM,QAAQ,UAAU,mBAAmB;AAE3C,QAAI,MAAO,MAAK,QAAQ,SAAS,KAAK;AACtC,QAAI,UAAW,MAAK,YAAY,SAAS,SAAS;AAClD,QAAI,MAAO,MAAK,QAAQ,SAAS,KAAK;AAEtC,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,eAA8B,UAAmB,OAAe;AAC7E,QAAI,SAAS;AACX,WAAK;AAEL,WAAK,eAAe,KAAK;AAAA,QACvB,KAAK,eAAe,KAAK,IAAI,kBAAiB,oBAAoB,KAAK,iBAAiB;AAAA,QACxF,kBAAiB;AAAA,MACnB;AACA,aAAO,KAAK;AAAA,IACd;AAGA,SAAK,oBAAoB;AAGzB,QAAI,cAAc,SAAS,cAAc,cAAc,QAAW;AAChE,YAAM,iBAAiB,IAAK,cAAc,YAAY,cAAc;AAGpE,UAAI,iBAAkB,IAAI,kBAAiB,qBAAsB;AAE/D,cAAM,cAAc,KAAK,iBAAiB,OAAO;AACjD,aAAK,eAAe,KAAK;AAAA,UACvB,kBAAiB,YAAY,cAAc;AAAA,UAC3C,kBAAiB;AAAA,QACnB;AAAA,MACF,OAAO;AAEL,aAAK,eAAe,kBAAiB;AAAA,MACvC;AAAA,IACF;AAEA,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAsB;AAC1B,QAAI,KAAK,eAAe,GAAG;AACzB,YAAM,IAAI,QAAQ,CAAAC,aAAW,WAAWA,UAAS,KAAK,YAAY,CAAC;AAAA,IACrE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,YAA6B;AACrC,QAAI,YAAY;AAEd,YAAM,UAAU,SAAS,UAAU;AACnC,UAAI,CAAC,MAAM,OAAO,GAAG;AACnB,aAAK,eAAe,UAAU;AAAA,MAChC,OAAO;AAEL,cAAM,YAAY,IAAI,KAAK,UAAU,EAAE,QAAQ;AAC/C,YAAI,CAAC,MAAM,SAAS,GAAG;AACrB,eAAK,eAAe,KAAK,IAAI,GAAG,YAAY,KAAK,IAAI,CAAC;AAAA,QACxD;AAAA,MACF;AAAA,IACF,OAAO;AAEL,WAAK;AACL,WAAK,eAAe,KAAK;AAAA,QACvB,MAAO,KAAK,IAAI,kBAAiB,oBAAoB,KAAK,iBAAiB;AAAA,QAC3E,kBAAiB;AAAA,MACnB;AAAA,IACF;AAEA,WAAO,KAAK;AAAA,EACd;AACF;;;AD/GO,IAAM,2BAAN,MAAM,kCAAiC,gBAAgB;AAAA,EAC5D,OAAwB,aAAa;AAAA;AAAA,EACrC,OAAwB,wBAAwB;AAAA;AAAA,EAEhD,MAAM,QAAQ,MAA6BC,eAAqD;AAC9F,QAAI;AAEF,UAAI,CAAC,KAAK,cAAc,KAAK,WAAW,WAAW,GAAG;AACpD,eAAO;AAAA,UACL,SAAS,CAAC;AAAA,YACR,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS;AAAA,cACT,cAAc;AAAA,YAChB,GAAG,MAAM,CAAC;AAAA,UACZ,CAAC;AAAA,QACH;AAAA,MACF;AAEA,YAAM,QAAQC,SAAO,MAAM,EAAE,SAAS,MAAM,MAAMD,cAAa,CAAC;AAGhE,UAAI,KAAK,aAAa;AACpB,eAAO,KAAK,iBAAiB,OAAO,KAAK,UAAU;AAAA,MACrD;AAGA,YAAM,WAAW,qBAAqB,MAAM,IAAI;AAGhD,UAAI,SAAS,YAAY,WAAW,KAAK,SAAS,eAAe,WAAW,GAAG;AAC7E,eAAO;AAAA,UACL,SAAS,CAAC;AAAA,YACR,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,SAAS;AAAA,cACT,cAAc,KAAK,WAAW;AAAA,YAChC,GAAG,MAAM,CAAC;AAAA,UACZ,CAAC;AAAA,QACH;AAAA,MACF;AAEA,cAAQ,IAAI,2CAA2C;AAAA,QACrD,eAAe,KAAK,WAAW;AAAA,QAC/B,aAAa,SAAS;AAAA,QACtB,gBAAgB,SAAS;AAAA,MAC3B,CAAC;AAGD,YAAM,UAAU,MAAM,KAAK;AAAA,QACzB;AAAA,QACA,KAAK;AAAA,QACL;AAAA,MACF;AAGA,YAAM,aAAa,QAAQ,OAAO,OAAK,EAAE,OAAO;AAChD,YAAM,SAAS,QAAQ,OAAO,OAAK,CAAC,EAAE,OAAO;AAE7C,cAAQ,IAAI,sCAAsC;AAAA,QAChD,OAAO,KAAK,WAAW;AAAA,QACvB,YAAY,WAAW;AAAA,QACvB,QAAQ,OAAO;AAAA,MACjB,CAAC;AAED,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU;AAAA,YACnB,SAAS,OAAO,WAAW;AAAA,YAC3B,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,OAAO,KAAK,WAAW;AAAA,cACvB,YAAY,WAAW;AAAA,cACvB,QAAQ,OAAO;AAAA,YACjB;AAAA,YACA,SAAS;AAAA,cACP,eAAe,WAAW,IAAI,OAAK,EAAE,EAAE;AAAA,cACvC,kBAAkB,OAAO,IAAI,QAAM;AAAA,gBACjC,IAAI,EAAE;AAAA,gBACN,QAAQ,EAAE,SAAS,EAAE,iBAAiB;AAAA,cACxC,EAAE;AAAA,cACF,aAAa,SAAS;AAAA,cACtB,eAAe,SAAS;AAAA,YAC1B;AAAA,UACF,GAAG,MAAM,CAAC;AAAA,QACZ,CAAC;AAAA,MACH;AAAA,IACF,SAAS,OAAY;AACnB,cAAQ,MAAM,oCAAoC;AAAA,QAChD,SAAS,MAAM;AAAA,QACf,MAAM,MAAM;AAAA,QACZ,QAAQ,MAAM;AAAA,QACd,UAAU,MAAM,UAAU;AAAA,MAC5B,CAAC;AACD,WAAK,qBAAqB,KAAK;AAC/B,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAc,iBACZ,OACA,YACyB;AACzB,QAAI;AAEF,YAAM,SAAS,KAAK,WAAW,YAAY,GAAI;AAE/C,iBAAW,SAAS,QAAQ;AAC1B,cAAM,MAAM,MAAM,SAAS,YAAY;AAAA,UACrC,QAAQ;AAAA,UACR,aAAa;AAAA,YACX,KAAK;AAAA,UACP;AAAA,QACF,CAAC;AAAA,MACH;AAEA,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU;AAAA,YACnB,SAAS;AAAA,YACT,QAAQ;AAAA,YACR,cAAc,WAAW;AAAA,YACzB;AAAA,UACF,GAAG,MAAM,CAAC;AAAA,QACZ,CAAC;AAAA,MACH;AAAA,IACF,SAAS,OAAY;AAEnB,cAAQ,MAAM,+CAA+C,KAAK;AAClE,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAc,gCACZ,OACA,YACA,UACgC;AAChC,UAAM,cAAc,IAAI,iBAAiB;AACzC,UAAM,SAAS,KAAK,WAAW,YAAY,0BAAyB,UAAU;AAC9E,UAAM,aAAoC,CAAC;AAE3C,aAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACtC,YAAM,QAAQ,OAAO,CAAC;AACtB,YAAM,aAAa,IAAI;AACvB,YAAM,cAAc,OAAO;AAE3B,cAAQ,IAAI,wCAAwC,UAAU,IAAI,WAAW,KAAK,MAAM,MAAM,YAAY;AAG1G,UAAI,IAAI,GAAG;AACT,cAAM,YAAY,KAAK;AAAA,MACzB;AAEA,UAAI;AAEF,cAAM,WAAW,MAAM,MAAM,MAAM,SAAS,YAAY;AAAA,UACtD,QAAQ;AAAA,UACR,aAAa;AAAA,YACX,KAAK;AAAA,YACL,aAAa,SAAS;AAAA,YACtB,gBAAgB,SAAS;AAAA,UAC3B;AAAA,QACF,CAAC;AAGD,cAAM,gBAAgB,iBAAiB,qBAAqB,SAAS,OAAO;AAC5E,gBAAQ,IAAI,wCAAwC,aAAa;AACjE,oBAAY,eAAe,aAAa;AAGxC,cAAM,eAAe,MAAM,KAAK,mBAAmB,OAAO,OAAO,QAAQ;AACzE,mBAAW,KAAK,GAAG,YAAY;AAG/B,cAAM,WAAW,aAAa,OAAO,OAAK,CAAC,EAAE,OAAO;AACpD,YAAI,SAAS,SAAS,GAAG;AACvB,kBAAQ,IAAI,gCAAgC,SAAS,MAAM,+BAA+B;AAE1F,qBAAW,UAAU,UAAU;AAC7B,kBAAM,cAAc,MAAM,KAAK;AAAA,cAC7B;AAAA,cACA,OAAO;AAAA,cACP;AAAA,cACA;AAAA,YACF;AAGA,kBAAM,QAAQ,WAAW,UAAU,OAAK,EAAE,OAAO,OAAO,EAAE;AAC1D,gBAAI,UAAU,IAAI;AAChB,yBAAW,KAAK,IAAI;AAAA,YACtB;AAAA,UACF;AAAA,QACF;AAAA,MAEF,SAAS,OAAY;AACnB,gBAAQ,MAAM,6BAA6B,UAAU,YAAY,KAAK;AAGtE,YAAI,MAAM,SAAS,KAAK;AACtB,gBAAM,aAAa,MAAM,UAAU,UAAU,aAAa;AAC1D,gBAAM,QAAQ,YAAY,UAAU,UAAU;AAC9C,kBAAQ,IAAI,6CAA6C,KAAK,IAAI;AAClE,gBAAM,YAAY,KAAK;AAGvB;AACA;AAAA,QACF;AAGA,cAAM,QAAQ,QAAM;AAClB,qBAAW,KAAK;AAAA,YACd;AAAA,YACA,SAAS;AAAA,YACT,OAAO,MAAM,WAAW;AAAA,UAC1B,CAAC;AAAA,QACH,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,mBACZ,OACA,YACA,UACgC;AAEhC,UAAM,iBAAiB,WAAW;AAAA,MAAI,QACpC,KAAK,4BAA4B,OAAO,IAAI,QAAQ;AAAA,IACtD;AAGA,UAAM,UAAiC,CAAC;AACxC,UAAM,QAAQ,0BAAyB;AAEvC,aAAS,IAAI,GAAG,IAAI,eAAe,QAAQ,KAAK,OAAO;AACrD,YAAM,QAAQ,eAAe,MAAM,GAAG,IAAI,KAAK;AAC/C,YAAM,eAAe,MAAM,QAAQ,IAAI,KAAK;AAC5C,cAAQ,KAAK,GAAG,YAAY;AAAA,IAC9B;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,4BACZ,OACA,WACA,UAC8B;AAC9B,QAAI;AACF,YAAM,UAAU,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,QAC7C,QAAQ;AAAA,QACR,IAAI;AAAA,QACJ,QAAQ;AAAA,MACV,CAAC;AAED,YAAM,gBAAgB,QAAQ,KAAK,YAAY,CAAC;AAGhD,YAAM,gBAAgB,SAAS,YAAY;AAAA,QAAM,WAC/C,cAAc,SAAS,KAAK;AAAA,MAC9B;AACA,YAAM,kBAAkB,SAAS,eAAe;AAAA,QAAM,WACpD,CAAC,cAAc,SAAS,KAAK;AAAA,MAC/B;AAEA,YAAM,UAAU,iBAAiB;AAEjC,aAAO;AAAA,QACL,IAAI;AAAA,QACJ;AAAA,QACA,YAAY;AAAA,QACZ,OAAO,UAAU,SAAY;AAAA,MAC/B;AAAA,IACF,SAAS,OAAY;AACnB,aAAO;AAAA,QACL,IAAI;AAAA,QACJ,SAAS;AAAA,QACT,OAAO,wBAAwB,MAAM,OAAO;AAAA,MAC9C;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAc,uBACZ,OACA,WACA,UACA,aAC8B;AAC9B,QAAI;AAEF,YAAM,WAAW,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,QAC9C,QAAQ;AAAA,QACR,IAAI;AAAA,QACJ,QAAQ;AAAA,MACV,CAAC;AAED,YAAM,gBAAgB,SAAS,KAAK,YAAY,CAAC;AAGjD,UAAI,CAAC,qBAAqB,gBAAgB,eAAe,QAAQ,GAAG;AAClE,eAAO;AAAA,UACL,IAAI;AAAA,UACJ,SAAS;AAAA,UACT,WAAW;AAAA,UACX,eAAe;AAAA,QACjB;AAAA,MACF;AAGA,YAAM,MAAM,MAAM,SAAS,OAAO;AAAA,QAChC,QAAQ;AAAA,QACR,IAAI;AAAA,QACJ,aAAa;AAAA,UACX,aAAa,SAAS;AAAA,UACtB,gBAAgB,SAAS;AAAA,QAC3B;AAAA,MACF,CAAC;AAGD,YAAM,IAAI,QAAQ,CAAAE,aAAW,WAAWA,UAAS,GAAG,CAAC;AAGrD,YAAM,YAAY,MAAM,MAAM,MAAM,SAAS,IAAI;AAAA,QAC/C,QAAQ;AAAA,QACR,IAAI;AAAA,QACJ,QAAQ;AAAA,MACV,CAAC;AAED,YAAM,cAAc,UAAU,KAAK,YAAY,CAAC;AAGhD,YAAM,gBAAgB,SAAS,YAAY;AAAA,QAAM,WAC/C,YAAY,SAAS,KAAK;AAAA,MAC5B;AACA,YAAM,kBAAkB,SAAS,eAAe;AAAA,QAAM,WACpD,CAAC,YAAY,SAAS,KAAK;AAAA,MAC7B;AAEA,YAAM,UAAU,iBAAiB;AAEjC,aAAO;AAAA,QACL,IAAI;AAAA,QACJ;AAAA,QACA,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,OAAO,UAAU,SAAY;AAAA,MAC/B;AAAA,IAEF,SAAS,OAAY;AAEnB,UAAI,MAAM,SAAS,KAAK;AACtB,cAAM,aAAa,MAAM,UAAU,UAAU,aAAa;AAC1D,oBAAY,UAAU,UAAU;AAAA,MAClC;AAEA,aAAO;AAAA,QACL,IAAI;AAAA,QACJ,SAAS;AAAA,QACT,OAAO,4BAA4B,MAAM,OAAO;AAAA,MAClD;AAAA,IACF;AAAA,EACF;AAAA,EAEQ,WAAc,OAAY,MAAqB;AACrD,UAAM,SAAgB,CAAC;AACvB,aAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK,MAAM;AAC3C,aAAO,KAAK,MAAM,MAAM,GAAG,IAAI,IAAI,CAAC;AAAA,IACtC;AACA,WAAO;AAAA,EACT;AACF;;;AzBzWA,eAAsB,eAAe,SAA6CC,eAA4B;AAC1G,QAAM,EAAE,MAAM,WAAW,KAAK,IAAI,QAAQ;AAE1C,MAAI;AACA,UAAM,UAAU,WAAW,IAAI;AAC/B,WAAO,MAAM,QAAQ,QAAQ,MAAMA,aAAY;AAAA,EACnD,SAAS,OAAgB;AACrB,YAAQ,MAAM,yBAAyB,IAAI,MAAM,KAAK;AAEtD,UAAM;AAAA,EACV;AACJ;AAEA,IAAM,aAA8C;AAAA;AAAA,EAEhD,kBAAkB,IAAI,qBAAqB;AAAA,EAC3C,eAAe,IAAI,kBAAkB;AAAA,EACrC,iBAAiB,IAAI,oBAAoB;AAAA,EACzC,eAAe,IAAI,kBAAkB;AAAA,EACrC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,qBAAqB;AAAA;AAAA,EAEzC,iBAAiB,IAAI,oBAAoB;AAAA,EACzC,eAAe,IAAI,kBAAkB;AAAA,EACrC,kBAAkB,IAAI,qBAAqB;AAAA,EAC3C,kBAAkB,IAAI,qBAAqB;AAAA,EAC3C,kBAAkB,IAAI,qBAAqB;AAAA;AAAA,EAE3C,eAAe,IAAI,kBAAkB;AAAA,EACrC,aAAa,IAAI,gBAAgB;AAAA,EACjC,cAAc,IAAI,iBAAiB;AAAA,EACnC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,cAAc,IAAI,iBAAiB;AAAA,EACnC,eAAe,IAAI,kBAAkB;AAAA,EACrC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,gBAAgB,IAAI,mBAAmB;AAAA,EACvC,uBAAuB,IAAI,yBAAyB;AACxD;AAEA,SAAS,WAAW,UAAmC;AACnD,QAAM,UAAU,WAAW,QAAQ;AACnC,MAAI,CAAC,SAAS;AACV,UAAM,IAAI,MAAM,iBAAiB,QAAQ,EAAE;AAAA,EAC/C;AACA,SAAO;AACX;;;AL9EA,IAAM,MAAM,QAAQ;AACpB,IAAI,IAAI,QAAQ,KAAK,CAAC;AAEtB,IAAI;AACJ,IAAI;AAGJ,eAAe,aAAa;AAC1B,MAAI;AACF,mBAAe,MAAM,uBAAuB;AAC5C,mBAAe,IAAI,aAAa,YAAY;AAE5C,UAAM,cAAc,MAAM,aAAa,eAAe;AACtD,QAAI,CAAC,aAAa;AAChB,YAAM,IAAI,MAAM,2DAA2D;AAAA,IAC7E;AACA,YAAQ,IAAI,0BAA0B;AAAA,EACxC,SAAS,OAAO;AACd,YAAQ,MAAM,+BAA+B,KAAK;AAClD,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF;AAGA,IAAI,IAAI,WAAW,CAAC,KAAK,QAAQ;AAC/B,MAAI,KAAK,EAAE,QAAQ,KAAK,CAAC;AAC3B,CAAC;AAGD,IAAI,KAAK,iBAAiB,OAAO,KAAK,QAAQ;AAC5C,MAAI;AACF,UAAM,EAAE,SAAS,QAAQ,OAAO,IAAI,IAAI;AAGxC,UAAM,cAAsC;AAAA,MAC1C,YAAY;AAAA,MACZ,eAAe;AAAA,MACf,gBAAgB;AAAA,MAChB,gBAAgB;AAAA,MAChB,gBAAgB;AAAA,MAChB,kBAAkB;AAAA,IACpB;AAGA,UAAM,wBAAwB,CAAC,gBAAgB,aAAa;AAE5D,UAAM,WAAW,YAAY,MAAM,KAAK;AAGxC,UAAM,aAAa;AAAA,MACjB,QAAQ;AAAA,MACR,QAAQ;AAAA,QACN,MAAM;AAAA,QACN,WAAW,UAAU,CAAC;AAAA,MACxB;AAAA,IACF;AAGA,UAAM,SAAS,MAAM,eAAe,YAAY,YAAY;AAI5D,QAAI,aAAa,kBAAkB,QAAQ;AACzC,UAAI;AACF,cAAM,EAAE,sBAAAC,sBAAqB,IAAI,MAAM;AACvC,cAAM,EAAE,8BAAAC,8BAA6B,IAAI,MAAM;AAC/C,cAAM,UAAU,IAAID,sBAAqB;AAGzC,cAAM,YAAYC,8BAA6B,UAAU,MAAM;AAC/D,YAAI,UAAU,SAAS;AAGrB,gBAAM,UAAU,MAAM,QAAQ,cAAc,cAAc,UAAU,IAAI;AAGxE,iBAAO,MAAM;AAEb,gBAAM,eAAsB,CAAC;AAC7B,cAAI,QAAQ,WAAW;AACrB,uBAAW,cAAc,QAAQ,WAAW;AAC1C,oBAAM,eAAe,QAAQ,UAAU,UAAU;AACjD,kBAAI,aAAa,MAAM;AACrB,6BAAa,KAAK,GAAG,aAAa,IAAI;AAAA,cACxC;AAAA,YACF;AAAA,UACF;AACA,iBAAO,OAAO;AAAA,QAChB;AAAA,MACF,SAAS,GAAG;AAEV,gBAAQ,MAAM,oCAAoC,CAAC;AAAA,MACrD;AAAA,IACF;AAGA,QAAI,aAAa,iBAAiB,QAAQ;AACxC,UAAI;AACF,cAAM,EAAE,mBAAAC,mBAAkB,IAAI,MAAM;AACpC,cAAM,EAAE,2BAAAC,2BAA0B,IAAI,MAAM;AAC5C,cAAM,UAAU,IAAID,mBAAkB;AAGtC,cAAM,YAAYC,2BAA0B,UAAU,MAAM;AAC5D,YAAI,UAAU,SAAS;AAGrB,gBAAM,YAAY,MAAM,QAAQ,YAAY,cAAc,UAAU,KAAK,YAAY;AAAA,YACnF,SAAS,UAAU,KAAK;AAAA,YACxB,SAAS,UAAU,KAAK;AAAA,UAC1B,CAAC;AAGD,iBAAO,MAAM;AACb,iBAAO,SAAS;AAAA,QAClB;AAAA,MACF,SAAS,GAAG;AAEV,gBAAQ,MAAM,kCAAkC,CAAC;AAAA,MACnD;AAAA,IACF;AAKA,QAAI,aAAa,kBAAkB,QAAQ;AACzC,UAAI;AAEF,YAAI,UAAyB;AAC7B,YAAI,OAAO,WAAW,MAAM,QAAQ,OAAO,OAAO,GAAG;AACnD,qBAAW,QAAQ,OAAO,SAAS;AACjC,gBAAI,KAAK,SAAS,UAAU,KAAK,MAAM;AAErC,oBAAM,QAAQ,KAAK,KAAK,MAAM,aAAa;AAC3C,kBAAI,OAAO;AACT,0BAAU,MAAM,CAAC;AACjB;AAAA,cACF;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAGA,YAAI,SAAS;AACX,gBAAM,EAAE,QAAAC,SAAO,IAAI,MAAM,OAAO,YAAY;AAC5C,gBAAM,WAAWA,SAAO,SAAS,EAAE,SAAS,MAAM,MAAM,aAAa,CAAC;AACtE,gBAAM,EAAE,4BAAAC,4BAA2B,IAAI,MAAM;AAC7C,gBAAM,YAAYA,4BAA2B,UAAU,MAAM;AAE7D,cAAI,UAAU,SAAS;AACrB,gBAAI;AACF,oBAAM,gBAAgB,MAAM,SAAS,OAAO,IAAI;AAAA,gBAC9C,YAAY,UAAU,KAAK;AAAA,gBAC3B;AAAA,cACF,CAAC;AAGD,oBAAM,YAAa,cAAsB;AACzC,kBAAI,WAAW;AACb,uBAAO,MAAM;AACb,uBAAO,QAAQ;AAAA,cACjB;AAAA,YACF,SAAS,YAAY;AACnB,sBAAQ,MAAM,iCAAiC,UAAU;AAAA,YAC3D;AAAA,UACF;AAAA,QACF;AAAA,MACF,SAAS,GAAG;AAEV,gBAAQ,MAAM,iCAAiC,CAAC;AAAA,MAClD;AAAA,IACF;AAEA,QAAI,KAAK,MAAM;AAAA,EACjB,SAAS,OAAY;AACnB,YAAQ,MAAM,2BAA2B,KAAK;AAC9C,QAAI,OAAO,GAAG,EAAE,KAAK;AAAA,MACnB,OAAO,MAAM,WAAW;AAAA,MACxB,SAAS,CAAC;AAAA,IACZ,CAAC;AAAA,EACH;AACF,CAAC;AAGD,IAAM,OAAO,QAAQ,IAAI,QAAQ;AACjC,eAAe,cAAc;AAC3B,QAAM,WAAW;AACjB,MAAI,OAAO,MAAM,MAAM;AACrB,YAAQ,IAAI,+CAA+C,IAAI,EAAE;AACjE,YAAQ,IAAI,8BAA8B,IAAI,eAAe;AAAA,EAC/D,CAAC;AACH;AAEA,YAAY,EAAE,MAAM,QAAQ,KAAK;",
  "names": ["GaxiosError", "resolve", "oauth2Client", "oauth2Client", "oauth2Client", "fs", "path", "oauth2Client", "oauth2Client", "oauth2Client", "oauth2Client", "oauth2Client", "resolve", "oauth2Client", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "resolve", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "oauth2Client", "google", "resolve", "oauth2Client", "google", "resolve", "oauth2Client", "FreeBusyEventHandler", "FreeBusyEventArgumentsSchema", "ListEventsHandler", "ListEventsArgumentsSchema", "google", "CreateEventArgumentsSchema"]
}
